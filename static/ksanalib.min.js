!function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return i(n?n:e)},l,l.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){"use strict";function r(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===t[e-2]?2:"="===t[e-1]?1:0}function i(t){return 3*t.length/4-r(t)}function o(t){var e,n,i,o,s,a,u=t.length;s=r(t),a=new f(3*u/4-s),i=s>0?u-4:u;var c=0;for(e=0,n=0;i>e;e+=4,n+=3)o=l[t.charCodeAt(e)]<<18|l[t.charCodeAt(e+1)]<<12|l[t.charCodeAt(e+2)]<<6|l[t.charCodeAt(e+3)],a[c++]=o>>16&255,a[c++]=o>>8&255,a[c++]=255&o;return 2===s?(o=l[t.charCodeAt(e)]<<2|l[t.charCodeAt(e+1)]>>4,a[c++]=255&o):1===s&&(o=l[t.charCodeAt(e)]<<10|l[t.charCodeAt(e+1)]<<4|l[t.charCodeAt(e+2)]>>2,a[c++]=o>>8&255,a[c++]=255&o),a}function s(t){return c[t>>18&63]+c[t>>12&63]+c[t>>6&63]+c[63&t]}function a(t,e,n){for(var r,i=[],o=e;n>o;o+=3)r=(t[o]<<16)+(t[o+1]<<8)+t[o+2],i.push(s(r));return i.join("")}function u(t){for(var e,n=t.length,r=n%3,i="",o=[],s=16383,u=0,l=n-r;l>u;u+=s)o.push(a(t,u,u+s>l?l:u+s));return 1===r?(e=t[n-1],i+=c[e>>2],i+=c[e<<4&63],i+="=="):2===r&&(e=(t[n-2]<<8)+t[n-1],i+=c[e>>10],i+=c[e>>4&63],i+=c[e<<2&63],i+="="),o.push(i),o.join("")}n.byteLength=i,n.toByteArray=o,n.fromByteArray=u;for(var c=[],l=[],f="undefined"!=typeof Uint8Array?Uint8Array:Array,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p=0,g=h.length;g>p;++p)c[p]=h[p],l[h.charCodeAt(p)]=p;l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},{}],2:[function(t,e,n){"use strict";function r(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()}catch(e){return!1}}function i(t){if(t>W)throw new RangeError("Invalid typed array length");var e=new Uint8Array(t);return e.__proto__=o.prototype,e}function o(t,e,n){if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return c(t)}return s(t,e,n)}function s(t,e,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return t instanceof ArrayBuffer?h(t,e,n):"string"==typeof t?l(t,e):p(t)}function a(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(0>t)throw new RangeError('"size" argument must not be negative')}function u(t,e,n){return a(t),0>=t?i(t):void 0!==e?"string"==typeof n?i(t).fill(e,n):i(t).fill(e):i(t)}function c(t){return a(t),i(0>t?0:0|g(t))}function l(t,e){if(("string"!=typeof e||""===e)&&(e="utf8"),!o.isEncoding(e))throw new TypeError('"encoding" must be a valid string encoding');var n=0|v(t,e),r=i(n),s=r.write(t,e);return s!==n&&(r=r.slice(0,s)),r}function f(t){for(var e=t.length<0?0:0|g(t.length),n=i(e),r=0;e>r;r+=1)n[r]=255&t[r];return n}function h(t,e,n){if(0>e||t.byteLength<e)throw new RangeError("'offset' is out of bounds");if(t.byteLength<e+(n||0))throw new RangeError("'length' is out of bounds");var r;return r=void 0===e&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,e):new Uint8Array(t,e,n),r.__proto__=o.prototype,r}function p(t){if(o.isBuffer(t)){var e=0|g(t.length),n=i(e);return 0===n.length?n:(t.copy(n,0,0,e),n)}if(t){if(q(t)||"length"in t)return"number"!=typeof t.length||Y(t.length)?i(0):f(t);if("Buffer"===t.type&&Array.isArray(t.data))return f(t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function g(t){if(t>=W)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+W.toString(16)+" bytes");return 0|t}function d(t){return+t!=t&&(t=0),o.alloc(+t)}function v(t,e){if(o.isBuffer(t))return t.length;if(q(t)||t instanceof ArrayBuffer)return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return j(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return V(t).length;default:if(r)return j(t).length;e=(""+e).toLowerCase(),r=!0}}function m(t,e,n){var r=!1;if((void 0===e||0>e)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),0>=n)return"";if(n>>>=0,e>>>=0,e>=n)return"";for(t||(t="utf8");;)switch(t){case"hex":return S(this,e,n);case"utf8":case"utf-8":return P(this,e,n);case"ascii":return _(this,e,n);case"latin1":case"binary":return O(this,e,n);case"base64":return C(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function b(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function y(t,e,n,r,i){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:-2147483648>n&&(n=-2147483648),n=+n,Y(n)&&(n=i?0:t.length-1),0>n&&(n=t.length+n),n>=t.length){if(i)return-1;n=t.length-1}else if(0>n){if(!i)return-1;n=0}if("string"==typeof e&&(e=o.from(e,r)),o.isBuffer(e))return 0===e.length?-1:E(t,e,n,r,i);if("number"==typeof e)return e=255&e,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):E(t,[e],n,r,i);throw new TypeError("val must be string, number or Buffer")}function E(t,e,n,r,i){function o(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}var s=1,a=t.length,u=e.length;if(void 0!==r&&(r=String(r).toLowerCase(),"ucs2"===r||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;s=2,a/=2,u/=2,n/=2}var c;if(i){var l=-1;for(c=n;a>c;c++)if(o(t,c)===o(e,-1===l?0:c-l)){if(-1===l&&(l=c),c-l+1===u)return l*s}else-1!==l&&(c-=c-l),l=-1}else for(n+u>a&&(n=a-u),c=n;c>=0;c--){for(var f=!0,h=0;u>h;h++)if(o(t,c+h)!==o(e,h)){f=!1;break}if(f)return c}return-1}function k(t,e,n,r){n=Number(n)||0;var i=t.length-n;r?(r=Number(r),r>i&&(r=i)):r=i;var o=e.length;if(o%2!==0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;r>s;++s){var a=parseInt(e.substr(2*s,2),16);if(Y(a))return s;t[n+s]=a}return s}function A(t,e,n,r){return H(j(e,t.length-n),t,n,r)}function T(t,e,n,r){return H(G(e),t,n,r)}function F(t,e,n,r){return T(t,e,n,r)}function w(t,e,n,r){return H(V(e),t,n,r)}function x(t,e,n,r){return H(K(e,t.length-n),t,n,r)}function C(t,e,n){return J.fromByteArray(0===e&&n===t.length?t:t.slice(e,n))}function P(t,e,n){n=Math.min(t.length,n);for(var r=[],i=e;n>i;){var o=t[i],s=null,a=o>239?4:o>223?3:o>191?2:1;if(n>=i+a){var u,c,l,f;switch(a){case 1:128>o&&(s=o);break;case 2:u=t[i+1],128===(192&u)&&(f=(31&o)<<6|63&u,f>127&&(s=f));break;case 3:u=t[i+1],c=t[i+2],128===(192&u)&&128===(192&c)&&(f=(15&o)<<12|(63&u)<<6|63&c,f>2047&&(55296>f||f>57343)&&(s=f));break;case 4:u=t[i+1],c=t[i+2],l=t[i+3],128===(192&u)&&128===(192&c)&&128===(192&l)&&(f=(15&o)<<18|(63&u)<<12|(63&c)<<6|63&l,f>65535&&1114112>f&&(s=f))}}null===s?(s=65533,a=1):s>65535&&(s-=65536,r.push(s>>>10&1023|55296),s=56320|1023&s),r.push(s),i+=a}return I(r)}function I(t){var e=t.length;if(Q>=e)return String.fromCharCode.apply(String,t);for(var n="",r=0;e>r;)n+=String.fromCharCode.apply(String,t.slice(r,r+=Q));return n}function _(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;n>i;++i)r+=String.fromCharCode(127&t[i]);return r}function O(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;n>i;++i)r+=String.fromCharCode(t[i]);return r}function S(t,e,n){var r=t.length;(!e||0>e)&&(e=0),(!n||0>n||n>r)&&(n=r);for(var i="",o=e;n>o;++o)i+=M(t[o]);return i}function D(t,e,n){for(var r=t.slice(e,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function B(t,e,n){if(t%1!==0||0>t)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function N(t,e,n,r,i,s){if(!o.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||s>e)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function R(t,e,n,r){if(n+r>t.length)throw new RangeError("Index out of range");if(0>n)throw new RangeError("Index out of range")}function L(t,e,n,r,i){return e=+e,n>>>=0,i||R(t,e,n,4,3.4028234663852886e38,-3.4028234663852886e38),X.write(t,e,n,r,23,4),n+4}function z(t,e,n,r,i){return e=+e,n>>>=0,i||R(t,e,n,8,1.7976931348623157e308,-1.7976931348623157e308),X.write(t,e,n,r,52,8),n+8}function U(t){if(t=t.trim().replace(Z,""),t.length<2)return"";for(;t.length%4!==0;)t+="=";return t}function M(t){return 16>t?"0"+t.toString(16):t.toString(16)}function j(t,e){e=e||1/0;for(var n,r=t.length,i=null,o=[],s=0;r>s;++s){if(n=t.charCodeAt(s),n>55295&&57344>n){if(!i){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(e-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(56320>n){(e-=3)>-1&&o.push(239,191,189),i=n;continue}n=(i-55296<<10|n-56320)+65536}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,128>n){if((e-=1)<0)break;o.push(n)}else if(2048>n){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(65536>n){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(1114112>n))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function G(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}function K(t,e){for(var n,r,i,o=[],s=0;s<t.length&&!((e-=2)<0);++s)n=t.charCodeAt(s),r=n>>8,i=n%256,o.push(i),o.push(r);return o}function V(t){return J.toByteArray(U(t))}function H(t,e,n,r){for(var i=0;r>i&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}function q(t){return"function"==typeof ArrayBuffer.isView&&ArrayBuffer.isView(t)}function Y(t){return t!==t}var J=t("base64-js"),X=t("ieee754");n.Buffer=o,n.SlowBuffer=d,n.INSPECT_MAX_BYTES=50;var W=2147483647;n.kMaxLength=W,o.TYPED_ARRAY_SUPPORT=r(),o.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),"undefined"!=typeof Symbol&&Symbol.species&&o[Symbol.species]===o&&Object.defineProperty(o,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),o.poolSize=8192,o.from=function(t,e,n){return s(t,e,n)},o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array,o.alloc=function(t,e,n){return u(t,e,n)},o.allocUnsafe=function(t){return c(t)},o.allocUnsafeSlow=function(t){return c(t)},o.isBuffer=function(t){return null!=t&&t._isBuffer===!0},o.compare=function(t,e){if(!o.isBuffer(t)||!o.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,i=0,s=Math.min(n,r);s>i;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return r>n?-1:n>r?1:0},o.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return o.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=o.allocUnsafe(e),i=0;for(n=0;n<t.length;++n){var s=t[n];if(!o.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},o.byteLength=v,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;t>e;e+=2)b(this,e,e+1);return this},o.prototype.swap32=function(){var t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;t>e;e+=4)b(this,e,e+3),b(this,e+1,e+2);return this},o.prototype.swap64=function(){var t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;t>e;e+=8)b(this,e,e+7),b(this,e+1,e+6),b(this,e+2,e+5),b(this,e+3,e+4);return this},o.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?P(this,0,t):m.apply(this,arguments)},o.prototype.equals=function(t){if(!o.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t?!0:0===o.compare(this,t)},o.prototype.inspect=function(){var t="",e=n.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,e).match(/.{2}/g).join(" "),this.length>e&&(t+=" ... ")),"<Buffer "+t+">"},o.prototype.compare=function(t,e,n,r,i){if(!o.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),0>e||n>t.length||0>r||i>this.length)throw new RangeError("out of range index");if(r>=i&&e>=n)return 0;if(r>=i)return-1;if(e>=n)return 1;if(e>>>=0,n>>>=0,r>>>=0,i>>>=0,this===t)return 0;for(var s=i-r,a=n-e,u=Math.min(s,a),c=this.slice(r,i),l=t.slice(e,n),f=0;u>f;++f)if(c[f]!==l[f]){s=c[f],a=l[f];break}return a>s?-1:s>a?1:0},o.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},o.prototype.indexOf=function(t,e,n){return y(this,t,e,n,!0)},o.prototype.lastIndexOf=function(t,e,n){return y(this,t,e,n,!1)},o.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-e;if((void 0===n||n>i)&&(n=i),t.length>0&&(0>n||0>e)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return k(this,t,e,n);case"utf8":case"utf-8":return A(this,t,e,n);case"ascii":return T(this,t,e,n);case"latin1":case"binary":return F(this,t,e,n);case"base64":return w(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Q=4096;o.prototype.slice=function(t,e){var n=this.length;t=~~t,e=void 0===e?n:~~e,0>t?(t+=n,0>t&&(t=0)):t>n&&(t=n),0>e?(e+=n,0>e&&(e=0)):e>n&&(e=n),t>e&&(e=t);var r=this.subarray(t,e);return r.__proto__=o.prototype,r},o.prototype.readUIntLE=function(t,e,n){t>>>=0,e>>>=0,n||B(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return r},o.prototype.readUIntBE=function(t,e,n){t>>>=0,e>>>=0,n||B(t,e,this.length);for(var r=this[t+--e],i=1;e>0&&(i*=256);)r+=this[t+--e]*i;return r},o.prototype.readUInt8=function(t,e){return t>>>=0,e||B(t,1,this.length),this[t]},o.prototype.readUInt16LE=function(t,e){return t>>>=0,e||B(t,2,this.length),this[t]|this[t+1]<<8},o.prototype.readUInt16BE=function(t,e){return t>>>=0,e||B(t,2,this.length),this[t]<<8|this[t+1]},o.prototype.readUInt32LE=function(t,e){return t>>>=0,e||B(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},o.prototype.readUInt32BE=function(t,e){return t>>>=0,e||B(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},o.prototype.readIntLE=function(t,e,n){t>>>=0,e>>>=0,n||B(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*e)),r},o.prototype.readIntBE=function(t,e,n){t>>>=0,e>>>=0,n||B(t,e,this.length);for(var r=e,i=1,o=this[t+--r];r>0&&(i*=256);)o+=this[t+--r]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*e)),o},o.prototype.readInt8=function(t,e){return t>>>=0,e||B(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},o.prototype.readInt16LE=function(t,e){t>>>=0,e||B(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt16BE=function(t,e){t>>>=0,e||B(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt32LE=function(t,e){return t>>>=0,e||B(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},o.prototype.readInt32BE=function(t,e){return t>>>=0,e||B(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},o.prototype.readFloatLE=function(t,e){return t>>>=0,e||B(t,4,this.length),X.read(this,t,!0,23,4)},o.prototype.readFloatBE=function(t,e){return t>>>=0,e||B(t,4,this.length),X.read(this,t,!1,23,4)},o.prototype.readDoubleLE=function(t,e){return t>>>=0,e||B(t,8,this.length),X.read(this,t,!0,52,8)},o.prototype.readDoubleBE=function(t,e){return t>>>=0,e||B(t,8,this.length),X.read(this,t,!1,52,8)},o.prototype.writeUIntLE=function(t,e,n,r){if(t=+t,e>>>=0,n>>>=0,!r){var i=Math.pow(2,8*n)-1;N(this,t,e,n,i,0)}var o=1,s=0;for(this[e]=255&t;++s<n&&(o*=256);)this[e+s]=t/o&255;return e+n},o.prototype.writeUIntBE=function(t,e,n,r){if(t=+t,e>>>=0,n>>>=0,!r){var i=Math.pow(2,8*n)-1;N(this,t,e,n,i,0)}var o=n-1,s=1;for(this[e+o]=255&t;--o>=0&&(s*=256);)this[e+o]=t/s&255;return e+n},o.prototype.writeUInt8=function(t,e,n){return t=+t,e>>>=0,n||N(this,t,e,1,255,0),this[e]=255&t,e+1},o.prototype.writeUInt16LE=function(t,e,n){return t=+t,e>>>=0,n||N(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},o.prototype.writeUInt16BE=function(t,e,n){return t=+t,e>>>=0,n||N(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},o.prototype.writeUInt32LE=function(t,e,n){return t=+t,e>>>=0,n||N(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},o.prototype.writeUInt32BE=function(t,e,n){return t=+t,e>>>=0,n||N(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},o.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e>>>=0,!r){var i=Math.pow(2,8*n-1);N(this,t,e,n,i-1,-i)}var o=0,s=1,a=0;for(this[e]=255&t;++o<n&&(s*=256);)0>t&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+n},o.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e>>>=0,!r){var i=Math.pow(2,8*n-1);N(this,t,e,n,i-1,-i)}var o=n-1,s=1,a=0;for(this[e+o]=255&t;--o>=0&&(s*=256);)0>t&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+n},o.prototype.writeInt8=function(t,e,n){return t=+t,e>>>=0,n||N(this,t,e,1,127,-128),0>t&&(t=255+t+1),this[e]=255&t,e+1},o.prototype.writeInt16LE=function(t,e,n){return t=+t,e>>>=0,n||N(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},o.prototype.writeInt16BE=function(t,e,n){return t=+t,e>>>=0,n||N(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},o.prototype.writeInt32LE=function(t,e,n){return t=+t,e>>>=0,n||N(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},o.prototype.writeInt32BE=function(t,e,n){return t=+t,e>>>=0,n||N(this,t,e,4,2147483647,-2147483648),0>t&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},o.prototype.writeFloatLE=function(t,e,n){return L(this,t,e,!0,n)},o.prototype.writeFloatBE=function(t,e,n){return L(this,t,e,!1,n)},o.prototype.writeDoubleLE=function(t,e,n){return z(this,t,e,!0,n)},o.prototype.writeDoubleBE=function(t,e,n){return z(this,t,e,!1,n)},o.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&n>r&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(0>e)throw new RangeError("targetStart out of bounds");if(0>n||n>=this.length)throw new RangeError("sourceStart out of bounds");if(0>r)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var i,o=r-n;if(this===t&&e>n&&r>e)for(i=o-1;i>=0;--i)t[i+e]=this[i+n];else if(1e3>o)for(i=0;o>i;++i)t[i+e]=this[i+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},o.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var i=t.charCodeAt(0);256>i&&(t=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!o.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t=255&t);if(0>e||this.length<e||this.length<n)throw new RangeError("Out of range index");if(e>=n)return this;e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0);var s;if("number"==typeof t)for(s=e;n>s;++s)this[s]=t;else{var a=o.isBuffer(t)?t:new o(t,r),u=a.length;for(s=0;n-e>s;++s)this[s+e]=a[s%u]}return this};var Z=/[^+\/0-9A-Za-z-_]/g},{"base64-js":1,ieee754:3}],3:[function(t,e,n){n.read=function(t,e,n,r,i){var o,s,a=8*i-r-1,u=(1<<a)-1,c=u>>1,l=-7,f=n?i-1:0,h=n?-1:1,p=t[e+f];for(f+=h,o=p&(1<<-l)-1,p>>=-l,l+=a;l>0;o=256*o+t[e+f],f+=h,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=r;l>0;s=256*s+t[e+f],f+=h,l-=8);if(0===o)o=1-c;else{if(o===u)return s?0/0:(p?-1:1)*(1/0);s+=Math.pow(2,r),o-=c}return(p?-1:1)*s*Math.pow(2,o-r)},n.write=function(t,e,n,r,i,o){var s,a,u,c=8*o-i-1,l=(1<<c)-1,f=l>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,g=r?1:-1,d=0>e||0===e&&0>1/e?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=l):(s=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-s))<1&&(s--,u*=2),e+=s+f>=1?h/u:h*Math.pow(2,1-f),e*u>=2&&(s++,u/=2),s+f>=l?(a=0,s=l):s+f>=1?(a=(e*u-1)*Math.pow(2,i),s+=f):(a=e*Math.pow(2,f-1)*Math.pow(2,i),s=0));i>=8;t[n+p]=255&a,p+=g,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;t[n+p]=255&s,p+=g,s/=256,c-=8);t[n+p-g]|=128*d}},{}],4:[function(t,e,n){!function(e){function n(t,r){if(!(this instanceof n))return new n(t,r);var o=this;i(o),o.q=o.c="",o.bufferCheckPosition=e.MAX_BUFFER_LENGTH,o.opt=r||{},o.opt.lowercase=o.opt.lowercase||o.opt.lowercasetags,o.looseCase=o.opt.lowercase?"toLowerCase":"toUpperCase",o.tags=[],o.closed=o.closedRoot=o.sawRoot=!1,o.tag=o.error=null,o.strict=!!t,o.noscript=!(!t&&!o.opt.noscript),o.state=H.BEGIN,o.strictEntities=o.opt.strictEntities,o.ENTITIES=Object.create(o.strictEntities?e.XML_ENTITIES:e.ENTITIES),o.attribList=[],o.opt.xmlns&&(o.ns=Object.create(M)),o.trackPosition=o.opt.position!==!1,o.trackPosition&&(o.position=o.line=o.column=0),p(o,"onready")}function r(t){for(var n=Math.max(e.MAX_BUFFER_LENGTH,10),r=0,i=0,o=I.length;o>i;i++){var s=t[I[i]].length;if(s>n)switch(I[i]){case"textNode":d(t);break;case"cdata":g(t,"oncdata",t.cdata),t.cdata="";break;case"script":g(t,"onscript",t.script),t.script="";break;default:m(t,"Max buffer length exceeded: "+I[i])}r=Math.max(r,s)}var a=e.MAX_BUFFER_LENGTH-r;t.bufferCheckPosition=a+t.position}function i(t){for(var e=0,n=I.length;n>e;e++)t[I[e]]=""}function o(t){d(t),""!==t.cdata&&(g(t,"oncdata",t.cdata),t.cdata=""),""!==t.script&&(g(t,"onscript",t.script),t.script="")}function s(t,e){return new a(t,e)}function a(t,e){if(!(this instanceof a))return new a(t,e);_.apply(this),this._parser=new n(t,e),this.writable=!0,this.readable=!0;var r=this;this._parser.onend=function(){r.emit("end")},this._parser.onerror=function(t){r.emit("error",t),r._parser.error=null},this._decoder=null,S.forEach(function(t){Object.defineProperty(r,"on"+t,{get:function(){return r._parser["on"+t]},set:function(e){return e?void r.on(t,e):(r.removeAllListeners(t),r._parser["on"+t]=e,e)},enumerable:!0,configurable:!1})})}function u(t){return t.split("").reduce(function(t,e){return t[e]=!0,t},{})}function c(t,e){return t.test(e)}function l(t,e){return t[e]}function f(t,e){return!c(t,e)}function h(t,e){return!l(t,e)}function p(t,e,n){t[e]&&t[e](n)}function g(t,e,n){t.textNode&&d(t),p(t,e,n)}function d(t){t.textNode=v(t.opt,t.textNode),t.textNode&&p(t,"ontext",t.textNode),t.textNode=""}function v(t,e){return t.trim&&(e=e.trim()),t.normalize&&(e=e.replace(/\s+/g," ")),e}function m(t,e){return d(t),t.trackPosition&&(e+="\nLine: "+t.line+"\nColumn: "+t.column+"\nChar: "+t.c),e=new Error(e),t.error=e,p(t,"onerror",e),t}function b(t){return t.sawRoot&&!t.closedRoot&&y(t,"Unclosed root tag"),t.state!==H.BEGIN&&t.state!==H.BEGIN_WHITESPACE&&t.state!==H.TEXT&&m(t,"Unexpected end"),d(t),t.c="",t.closed=!0,p(t,"onend"),n.call(t,t.strict,t.opt),t}function y(t,e){if("object"!=typeof t||!(t instanceof n))throw new Error("bad call to strictFail");t.strict&&m(t,e)}function E(t){t.strict||(t.tagName=t.tagName[t.looseCase]());var e=t.tags[t.tags.length-1]||t,n=t.tag={name:t.tagName,attributes:{}};t.opt.xmlns&&(n.ns=e.ns),t.attribList.length=0,g(t,"onopentagstart",n)}function k(t,e){var n=t.indexOf(":"),r=0>n?["",t]:t.split(":"),i=r[0],o=r[1];return e&&"xmlns"===t&&(i="xmlns",o=""),{prefix:i,local:o}}function A(t){if(t.strict||(t.attribName=t.attribName[t.looseCase]()),-1!==t.attribList.indexOf(t.attribName)||t.tag.attributes.hasOwnProperty(t.attribName))return void(t.attribName=t.attribValue="");if(t.opt.xmlns){var e=k(t.attribName,!0),n=e.prefix,r=e.local;if("xmlns"===n)if("xml"===r&&t.attribValue!==z)y(t,"xml: prefix must be bound to "+z+"\nActual: "+t.attribValue);else if("xmlns"===r&&t.attribValue!==U)y(t,"xmlns: prefix must be bound to "+U+"\nActual: "+t.attribValue);else{var i=t.tag,o=t.tags[t.tags.length-1]||t;i.ns===o.ns&&(i.ns=Object.create(o.ns)),i.ns[r]=t.attribValue}t.attribList.push([t.attribName,t.attribValue])}else t.tag.attributes[t.attribName]=t.attribValue,g(t,"onattribute",{name:t.attribName,value:t.attribValue});t.attribName=t.attribValue=""}function T(t,e){if(t.opt.xmlns){var n=t.tag,r=k(t.tagName);n.prefix=r.prefix,n.local=r.local,n.uri=n.ns[r.prefix]||"",n.prefix&&!n.uri&&(y(t,"Unbound namespace prefix: "+JSON.stringify(t.tagName)),n.uri=r.prefix);var i=t.tags[t.tags.length-1]||t;n.ns&&i.ns!==n.ns&&Object.keys(n.ns).forEach(function(e){g(t,"onopennamespace",{prefix:e,uri:n.ns[e]})});for(var o=0,s=t.attribList.length;s>o;o++){var a=t.attribList[o],u=a[0],c=a[1],l=k(u,!0),f=l.prefix,h=l.local,p=""===f?"":n.ns[f]||"",d={name:u,value:c,prefix:f,local:h,uri:p};f&&"xmlns"!==f&&!p&&(y(t,"Unbound namespace prefix: "+JSON.stringify(f)),d.uri=f),t.tag.attributes[u]=d,g(t,"onattribute",d)}t.attribList.length=0}t.tag.isSelfClosing=!!e,t.sawRoot=!0,t.tags.push(t.tag),g(t,"onopentag",t.tag),e||(t.state=t.noscript||"script"!==t.tagName.toLowerCase()?H.TEXT:H.SCRIPT,t.tag=null,t.tagName=""),t.attribName=t.attribValue="",t.attribList.length=0}function F(t){if(!t.tagName)return y(t,"Weird empty close tag."),t.textNode+="</>",void(t.state=H.TEXT);if(t.script){if("script"!==t.tagName)return t.script+="</"+t.tagName+">",t.tagName="",void(t.state=H.SCRIPT);g(t,"onscript",t.script),t.script=""}var e=t.tags.length,n=t.tagName;t.strict||(n=n[t.looseCase]());for(var r=n;e--;){var i=t.tags[e];if(i.name===r)break;y(t,"Unexpected close tag")}if(0>e)return y(t,"Unmatched closing tag: "+t.tagName),t.textNode+="</"+t.tagName+">",void(t.state=H.TEXT);t.tagName=n;for(var o=t.tags.length;o-->e;){var s=t.tag=t.tags.pop();t.tagName=t.tag.name,g(t,"onclosetag",t.tagName);var a={};for(var u in s.ns)a[u]=s.ns[u];var c=t.tags[t.tags.length-1]||t;t.opt.xmlns&&s.ns!==c.ns&&Object.keys(s.ns).forEach(function(e){var n=s.ns[e];g(t,"onclosenamespace",{prefix:e,uri:n})})}0===e&&(t.closedRoot=!0),t.tagName=t.attribValue=t.attribName="",t.attribList.length=0,t.state=H.TEXT}function w(t){var e,n=t.entity,r=n.toLowerCase(),i="";return t.ENTITIES[n]?t.ENTITIES[n]:t.ENTITIES[r]?t.ENTITIES[r]:(n=r,"#"===n.charAt(0)&&("x"===n.charAt(1)?(n=n.slice(2),e=parseInt(n,16),i=e.toString(16)):(n=n.slice(1),e=parseInt(n,10),i=e.toString(10))),n=n.replace(/^0+/,""),i.toLowerCase()!==n?(y(t,"Invalid character entity"),"&"+t.entity+";"):String.fromCodePoint(e))}function x(t,e){"<"===e?(t.state=H.OPEN_WAKA,t.startTagPosition=t.position):h(D,e)&&(y(t,"Non-whitespace before first tag."),t.textNode=e,t.state=H.TEXT)}function C(t,e){var n="";return e<t.length&&(n=t.charAt(e)),n}function P(t){var e=this;if(this.error)throw this.error;if(e.closed)return m(e,"Cannot write after close. Assign an onready handler.");if(null===t)return b(e);"object"==typeof t&&(t=t.toString());for(var n=0,i="";;){if(i=C(t,n++),e.c=i,!i)break;switch(e.trackPosition&&(e.position++,"\n"===i?(e.line++,e.column=0):e.column++),e.state){case H.BEGIN:if(e.state=H.BEGIN_WHITESPACE,"\ufeff"===i)continue;x(e,i);continue;case H.BEGIN_WHITESPACE:x(e,i);continue;case H.TEXT:if(e.sawRoot&&!e.closedRoot){for(var o=n-1;i&&"<"!==i&&"&"!==i;)i=C(t,n++),i&&e.trackPosition&&(e.position++,"\n"===i?(e.line++,e.column=0):e.column++);e.textNode+=t.substring(o,n-1)}"<"!==i||e.sawRoot&&e.closedRoot&&!e.strict?(!h(D,i)||e.sawRoot&&!e.closedRoot||y(e,"Text data outside of root node."),"&"===i?e.state=H.TEXT_ENTITY:e.textNode+=i):(e.state=H.OPEN_WAKA,e.startTagPosition=e.position);continue;case H.SCRIPT:"<"===i?e.state=H.SCRIPT_ENDING:e.script+=i;continue;case H.SCRIPT_ENDING:"/"===i?e.state=H.CLOSE_TAG:(e.script+="<"+i,e.state=H.SCRIPT);continue;case H.OPEN_WAKA:if("!"===i)e.state=H.SGML_DECL,e.sgmlDecl="";else if(l(D,i));else if(c(j,i))e.state=H.OPEN_TAG,e.tagName=i;else if("/"===i)e.state=H.CLOSE_TAG,e.tagName="";else if("?"===i)e.state=H.PROC_INST,e.procInstName=e.procInstBody="";else{if(y(e,"Unencoded <"),e.startTagPosition+1<e.position){var s=e.position-e.startTagPosition;i=new Array(s).join(" ")+i}e.textNode+="<"+i,e.state=H.TEXT}continue;case H.SGML_DECL:(e.sgmlDecl+i).toUpperCase()===R?(g(e,"onopencdata"),e.state=H.CDATA,e.sgmlDecl="",e.cdata=""):e.sgmlDecl+i==="--"?(e.state=H.COMMENT,e.comment="",e.sgmlDecl=""):(e.sgmlDecl+i).toUpperCase()===L?(e.state=H.DOCTYPE,(e.doctype||e.sawRoot)&&y(e,"Inappropriately located doctype declaration"),e.doctype="",e.sgmlDecl=""):">"===i?(g(e,"onsgmldeclaration",e.sgmlDecl),e.sgmlDecl="",e.state=H.TEXT):l(B,i)?(e.state=H.SGML_DECL_QUOTED,e.sgmlDecl+=i):e.sgmlDecl+=i;continue;case H.SGML_DECL_QUOTED:i===e.q&&(e.state=H.SGML_DECL,e.q=""),e.sgmlDecl+=i;continue;case H.DOCTYPE:">"===i?(e.state=H.TEXT,g(e,"ondoctype",e.doctype),e.doctype=!0):(e.doctype+=i,"["===i?e.state=H.DOCTYPE_DTD:l(B,i)&&(e.state=H.DOCTYPE_QUOTED,e.q=i));continue;case H.DOCTYPE_QUOTED:e.doctype+=i,i===e.q&&(e.q="",e.state=H.DOCTYPE);continue;case H.DOCTYPE_DTD:e.doctype+=i,"]"===i?e.state=H.DOCTYPE:l(B,i)&&(e.state=H.DOCTYPE_DTD_QUOTED,e.q=i);continue;case H.DOCTYPE_DTD_QUOTED:e.doctype+=i,i===e.q&&(e.state=H.DOCTYPE_DTD,e.q="");continue;case H.COMMENT:"-"===i?e.state=H.COMMENT_ENDING:e.comment+=i;continue;case H.COMMENT_ENDING:"-"===i?(e.state=H.COMMENT_ENDED,e.comment=v(e.opt,e.comment),e.comment&&g(e,"oncomment",e.comment),e.comment=""):(e.comment+="-"+i,e.state=H.COMMENT);continue;case H.COMMENT_ENDED:">"!==i?(y(e,"Malformed comment"),e.comment+="--"+i,e.state=H.COMMENT):e.state=H.TEXT;continue;case H.CDATA:"]"===i?e.state=H.CDATA_ENDING:e.cdata+=i;continue;case H.CDATA_ENDING:"]"===i?e.state=H.CDATA_ENDING_2:(e.cdata+="]"+i,e.state=H.CDATA);continue;case H.CDATA_ENDING_2:">"===i?(e.cdata&&g(e,"oncdata",e.cdata),g(e,"onclosecdata"),e.cdata="",e.state=H.TEXT):"]"===i?e.cdata+="]":(e.cdata+="]]"+i,e.state=H.CDATA);continue;case H.PROC_INST:"?"===i?e.state=H.PROC_INST_ENDING:l(D,i)?e.state=H.PROC_INST_BODY:e.procInstName+=i;continue;case H.PROC_INST_BODY:if(!e.procInstBody&&l(D,i))continue;"?"===i?e.state=H.PROC_INST_ENDING:e.procInstBody+=i;continue;case H.PROC_INST_ENDING:">"===i?(g(e,"onprocessinginstruction",{name:e.procInstName,body:e.procInstBody}),e.procInstName=e.procInstBody="",e.state=H.TEXT):(e.procInstBody+="?"+i,e.state=H.PROC_INST_BODY);continue;case H.OPEN_TAG:c(G,i)?e.tagName+=i:(E(e),">"===i?T(e):"/"===i?e.state=H.OPEN_TAG_SLASH:(h(D,i)&&y(e,"Invalid character in tag name"),e.state=H.ATTRIB));continue;case H.OPEN_TAG_SLASH:">"===i?(T(e,!0),F(e)):(y(e,"Forward-slash in opening tag not followed by >"),e.state=H.ATTRIB);continue;case H.ATTRIB:if(l(D,i))continue;">"===i?T(e):"/"===i?e.state=H.OPEN_TAG_SLASH:c(j,i)?(e.attribName=i,e.attribValue="",e.state=H.ATTRIB_NAME):y(e,"Invalid attribute name");continue;case H.ATTRIB_NAME:"="===i?e.state=H.ATTRIB_VALUE:">"===i?(y(e,"Attribute without value"),e.attribValue=e.attribName,A(e),T(e)):l(D,i)?e.state=H.ATTRIB_NAME_SAW_WHITE:c(G,i)?e.attribName+=i:y(e,"Invalid attribute name");

continue;case H.ATTRIB_NAME_SAW_WHITE:if("="===i)e.state=H.ATTRIB_VALUE;else{if(l(D,i))continue;y(e,"Attribute without value"),e.tag.attributes[e.attribName]="",e.attribValue="",g(e,"onattribute",{name:e.attribName,value:""}),e.attribName="",">"===i?T(e):c(j,i)?(e.attribName=i,e.state=H.ATTRIB_NAME):(y(e,"Invalid attribute name"),e.state=H.ATTRIB)}continue;case H.ATTRIB_VALUE:if(l(D,i))continue;l(B,i)?(e.q=i,e.state=H.ATTRIB_VALUE_QUOTED):(y(e,"Unquoted attribute value"),e.state=H.ATTRIB_VALUE_UNQUOTED,e.attribValue=i);continue;case H.ATTRIB_VALUE_QUOTED:if(i!==e.q){"&"===i?e.state=H.ATTRIB_VALUE_ENTITY_Q:e.attribValue+=i;continue}A(e),e.q="",e.state=H.ATTRIB_VALUE_CLOSED;continue;case H.ATTRIB_VALUE_CLOSED:l(D,i)?e.state=H.ATTRIB:">"===i?T(e):"/"===i?e.state=H.OPEN_TAG_SLASH:c(j,i)?(y(e,"No whitespace between attributes"),e.attribName=i,e.attribValue="",e.state=H.ATTRIB_NAME):y(e,"Invalid attribute name");continue;case H.ATTRIB_VALUE_UNQUOTED:if(h(N,i)){"&"===i?e.state=H.ATTRIB_VALUE_ENTITY_U:e.attribValue+=i;continue}A(e),">"===i?T(e):e.state=H.ATTRIB;continue;case H.CLOSE_TAG:if(e.tagName)">"===i?F(e):c(G,i)?e.tagName+=i:e.script?(e.script+="</"+e.tagName,e.tagName="",e.state=H.SCRIPT):(h(D,i)&&y(e,"Invalid tagname in closing tag"),e.state=H.CLOSE_TAG_SAW_WHITE);else{if(l(D,i))continue;f(j,i)?e.script?(e.script+="</"+i,e.state=H.SCRIPT):y(e,"Invalid tagname in closing tag."):e.tagName=i}continue;case H.CLOSE_TAG_SAW_WHITE:if(l(D,i))continue;">"===i?F(e):y(e,"Invalid characters in closing tag");continue;case H.TEXT_ENTITY:case H.ATTRIB_VALUE_ENTITY_Q:case H.ATTRIB_VALUE_ENTITY_U:var a,u;switch(e.state){case H.TEXT_ENTITY:a=H.TEXT,u="textNode";break;case H.ATTRIB_VALUE_ENTITY_Q:a=H.ATTRIB_VALUE_QUOTED,u="attribValue";break;case H.ATTRIB_VALUE_ENTITY_U:a=H.ATTRIB_VALUE_UNQUOTED,u="attribValue"}";"===i?(e[u]+=w(e),e.entity="",e.state=a):c(e.entity.length?V:K,i)?e.entity+=i:(y(e,"Invalid character in entity name"),e[u]+="&"+e.entity+i,e.entity="",e.state=a);continue;default:throw new Error(e,"Unknown state: "+e.state)}}return e.position>=e.bufferCheckPosition&&r(e),e}e.parser=function(t,e){return new n(t,e)},e.SAXParser=n,e.SAXStream=a,e.createStream=s,e.MAX_BUFFER_LENGTH=65536;var I=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(t){function e(){}e.prototype=t;var n=new e;return n}),Object.keys||(Object.keys=function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e}),n.prototype={end:function(){b(this)},write:P,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){o(this)}};var _;try{_=t("stream").Stream}catch(O){_=function(){}}var S=e.EVENTS.filter(function(t){return"error"!==t&&"end"!==t});a.prototype=Object.create(_.prototype,{constructor:{value:a}}),a.prototype.write=function(e){if("function"==typeof Buffer&&"function"==typeof Buffer.isBuffer&&Buffer.isBuffer(e)){if(!this._decoder){var n=t("string_decoder").StringDecoder;this._decoder=new n("utf8")}e=this._decoder.write(e)}return this._parser.write(e.toString()),this.emit("data",e),!0},a.prototype.end=function(t){return t&&t.length&&this.write(t),this._parser.end(),!0},a.prototype.on=function(t,e){var n=this;return n._parser["on"+t]||-1===S.indexOf(t)||(n._parser["on"+t]=function(){var e=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);e.splice(0,0,t),n.emit.apply(n,e)}),_.prototype.on.call(n,t,e)};var D="\r\n	 ",B="'\"",N=D+">",R="[CDATA[",L="DOCTYPE",z="http://www.w3.org/XML/1998/namespace",U="http://www.w3.org/2000/xmlns/",M={xml:z,xmlns:U};D=u(D);var j=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,G=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,K=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,V=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;B=u(B),N=u(N);var H=0;e.STATE={BEGIN:H++,BEGIN_WHITESPACE:H++,TEXT:H++,TEXT_ENTITY:H++,OPEN_WAKA:H++,SGML_DECL:H++,SGML_DECL_QUOTED:H++,DOCTYPE:H++,DOCTYPE_QUOTED:H++,DOCTYPE_DTD:H++,DOCTYPE_DTD_QUOTED:H++,COMMENT_STARTING:H++,COMMENT:H++,COMMENT_ENDING:H++,COMMENT_ENDED:H++,CDATA:H++,CDATA_ENDING:H++,CDATA_ENDING_2:H++,PROC_INST:H++,PROC_INST_BODY:H++,PROC_INST_ENDING:H++,OPEN_TAG:H++,OPEN_TAG_SLASH:H++,ATTRIB:H++,ATTRIB_NAME:H++,ATTRIB_NAME_SAW_WHITE:H++,ATTRIB_VALUE:H++,ATTRIB_VALUE_QUOTED:H++,ATTRIB_VALUE_CLOSED:H++,ATTRIB_VALUE_UNQUOTED:H++,ATTRIB_VALUE_ENTITY_Q:H++,ATTRIB_VALUE_ENTITY_U:H++,CLOSE_TAG:H++,CLOSE_TAG_SAW_WHITE:H++,SCRIPT:H++,SCRIPT_ENDING:H++},e.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,"int":8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach(function(t){var n=e.ENTITIES[t],r="number"==typeof n?String.fromCharCode(n):n;e.ENTITIES[t]=r});for(var q in e.STATE)e.STATE[e.STATE[q]]=q;H=e.STATE,String.fromCodePoint||!function(){var t=String.fromCharCode,e=Math.floor,n=function(){var n,r,i=16384,o=[],s=-1,a=arguments.length;if(!a)return"";for(var u="";++s<a;){var c=Number(arguments[s]);if(!isFinite(c)||0>c||c>1114111||e(c)!==c)throw RangeError("Invalid code point: "+c);65535>=c?o.push(c):(c-=65536,n=(c>>10)+55296,r=c%1024+56320,o.push(n,r)),(s+1===a||o.length>i)&&(u+=t.apply(null,o),o.length=0)}return u};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:n,configurable:!0,writable:!0}):String.fromCodePoint=n}()}("undefined"==typeof n?this.sax={}:n)},{stream:void 0,string_decoder:void 0}],5:[function(t){"undefined"!=typeof global?(global.KsanaCorpusBuilder=t("ksana-corpus-builder"),global.KsanaCorpus=t("ksana-corpus"),global.KsanaCorpusSearch=t("ksana-corpus-search"),global.KsanaCorpusROM=t("ksana-corpus-rom")):"undefined"!=typeof window&&(window.KsanaCorpusBuilder=t("ksana-corpus-builder"),window.KsanaCorpus=t("ksana-corpus"),window.KsanaCorpusSearch=t("ksana-corpus-search"),window.KsanaCorpusROM=t("ksana-corpus-rom"))},{"ksana-corpus":58,"ksana-corpus-builder":19,"ksana-corpus-rom":32,"ksana-corpus-search":42}],6:[function(t,e){const n=function(t){this.putGlobalField("anchor",t)},r=function(t){const e=t.attributes.name||t.attributes.n;e&&n.call(this,e)};e.exports={a:r,addAnchor:n}},{}],7:[function(t,e){var n=0;const r=function(t){const e=t.attributes.id||t.attributes.n;if(e){var r=e.split(/[\.p]/),i=parseInt(2==r.length?r[1]:r[0],10);1===i?this.addBook():i!==n+1&&this.log("error","wrong page number "+i+", prev:"+n+",line:"+(this.parser.line()+1)+",file:"+this.filename),this._pb=i,this._pbline=0;const o=this.makeKPos(this.bookCount,i-1,0,0);this.setPos(o,this.tPos),n=i}};var i=0;const o=function(t,e,n,r,i,o){if(e){var s=this.substring(i,o);!s&&t.attributes.t&&(s=s),this.putArticle(s,n,r);const a=this.makeRange(n,this.kPos);this.kPos>n&&this.putArticleField("rend","article",a)}},s=function(t,e){e||this.putEmptyArticleField("p")},a=function(t){const e=t.attributes.from;e?this.putArticleField("origin",e):console.error("origin missing from attribute")},u=function(t,e,n,r,i,o){if(e){var s=this.content.substring(i,o);!s&&t.attributes.t&&(s=s),this.putGroup(s,n,r)}},c=function(t,e,n){if(e){const r=this.makeRange(n,this.kPos);this.putArticleField("rend","tag",r)}},l=function(){};e.exports={p:s,pb:r,article:o,group:u,category:l,origin:a,tag:c,maxArticle:function(){return i}}},{}],8:[function(t,e){const n={jpeg:!0,png:!0,svg:!0},r=function(e,r,i){if(r){var o=(this.opts.path||"")+(e.attributes.n||e.attributes.f),s=e.attributes.n||e.attributes.f,a="",u=s.lastIndexOf("."),c=s.substr(u+1);if(u=s.lastIndexOf("/"),u>-1&&(s=s.substr(u+1)),"jpg"==c&&(c="jpeg"),!n[c])return void this.log("warn","unsupported image type "+c);if(this.opts.images&&this.opts.images[s]){const l=t("buffer/").Buffer;var a=this.opts.images[s];const f=a.match&&a.match(/data.+?base64,/);a=f?a.substr(f[0].length):new l(a).toString("svg"==c?"utf8":"base64")}if(!a){const h=t("fs");if(h&&h.existsSync&&h.existsSync(o)){const l=t("buffer").Buffer,p=h.readFileSync(o);a=new l(p).toString("base64")}}if(!a)return void this.log("warn","cannot find imagefile "+o);var g=this.makeRange(i-1,this.kPos);i==this.kPos&&(g=i),this.putArticleField(c,a,g)}};e.exports=r},{buffer:void 0,"buffer/":2,fs:void 0}],9:[function(t,e){const n=function(e){var n="";if(this.opts.images&&this.opts.images[e]){n=this.opts.images[e];const r=n.match&&0==n.indexOf(/data.+,/);n=r?n.substr(r[0].length):new Buffer(n).toString("utf8")}else{const i="svg/"+e,o=t("fs");o.existsSync(i)&&(n=o.readFileSync(i,"utf8"))}return n=n.replace(/[^ ]+?\.svg/,e)};e.exports=n},{fs:void 0}],10:[function(t,e){const n=t("./loadsvg");var r={};const i=function(t,e){if(!e){const i=t.attributes.n;if(r[i]){const o=r[i];this.putArticleField("footnote",i+"	"+o),o.replace(/\{svg\|(.+?),([\s\S]+?)\|svg\}/g,function(t,e){const r=n.call(this,e+".svg");r?this.putArticleField("footnotesvg",r):this.log("error","cannot load "+e)}.bind(this)),delete r[i]}else this.log("error","footnote "+i+" notfound")}},o=function(t){r=t},s=function(){return r},a=function(t,e){if(!e){const n=t.attributes.n;if(u[n])throw"note ptr exists"+n;u[t.attributes.n]=this.kPos}};var u={};const c=function(t,e,n,r,i,o){if(e){const s=(this.substring(i,o),t.attributes.n);if(!s)return void this.log("warn","釋 without n",this.stringify(this.kPos));const a=this.substring(i,o);if(ptrpos=u[s],!ptrpos)throw"no such ptr "+s;this.putArticleField("note",s+"	"+a,ptrpos)}},l=function(t,e,n){return e?void 0:t.attributes.t?void this.putArticleField("rubynote",t.attributes.t,n):void this.log("warning","missing attribute t at"+this.stringify(n))};e.exports={ptr:a,def:c,footnote:i,setFootnotes:o,getFootnotes:s,rubynote:l}},{"./loadsvg":9}],11:[function(t,e){const n=t("./loadsvg"),r=function(t,e,r){if(e){const i=t.attributes.url||t.attributes.src||t.attributes.n;var o=n.call(this,i);o?this.putArticleField("svg",o,this.makeRange(r,this.kPos)):this.log("error","cannot load "+i)}};e.exports=r},{"./loadsvg":9}],12:[function(t,e){var n=[],r={"檔":!0},i={"頁":!0,"段":!0,"註":!0,"釋":!0,RM:!0,RN:!0,P:!0,PB:!0,"圖":!0,IMAGE:!0,IMG:!0,"圖文字":!0};const o=function(t){if(i[t.name])return n;var e=t.attributes.t,o=t.attributes.l,s=!1,a=[];if(e){"."==e[e.length-1]&&(e=e.substr(0,e.length-1),s=!0),a=e.split(",");const u=n.indexOf(t.name);u>-1?n.length=u+1:n=[t.name],a.length&&(n=n.concat(a))}if(o&&(a=a.concat(o.split(","))),a)for(var c=0;c<a.length;c++)r[a[c]]=!0;const l=n.indexOf(t.name);return-1==l&&!r[t.name],n};e.exports=o},{}],13:[function(t,e){const n=function(t,e){for(var n,r=0;n=t[r];r++)if(n.name.indexOf("-corpus.json")>0){{var i=new FileReader;this.filename=n.name}return i.onload=function(t){try{const r=JSON.parse(t.target.result);e(0,r)}catch(t){e(n.name+" "+t.message)}},void i.readAsText(n,"UTF-8")}e&&e("Missing corpus configuration json.",null)},r=function(t){return t.match(/\.json$/)&&!t.match(/-corpus.json$/)},i=function(t){return t.match(/\.jpg/)||t.match(/\.png/)||t.match(/\.jepg/)||t.match(/\.svg/)},o=function(t,e){n.call(this,t,function(n,o){if(n)return void e(n);const s=[],a=[];for(var u,c=0;u=t[c];c++)s.push([u.name,c]);s.sort(function(t,e){return t[0]>e[0]?1:t[0]<e[0]?-1:0});const l=s.map(function(t){return t[0]}),f=s.map(function(t){return t[1]});if(o.files){for(var u,c=0;u=o.files[c];c++){const h=l.indexOf(u);if(!(h>-1))return void e("file "+u+" not found in folder");a.push(t[f[h]])}const p=a.map(function(t){return t.name});for(var c=0;c<l.length;c++){const g=l[c];if((r(g)||i(g))&&-1==p.indexOf(g)){const h=l.indexOf(g);a.unshift(t[f[h]])}}}else for(var c=0;c<f.length;c++)a.push(t[f[c]]);e(0,a,o)})},s=function(t,e,n){if(!t)return void this.log("error","external fields not specified in -corpus json");try{const r=JSON.parse(n);for(var i in t)t[i]==e&&(t[i]=r)}catch(o){this.log("error",o.message)}},a=function(t,e,n){try{const r=JSON.parse(n);for(var i in t)t[i]==e&&(t[i]=r)}catch(o){this.log("error",o.message)}},u=function(t,e,n){if(t instanceof Array){var r={};for(var i in t){var o=t[i],s=o.lastIndexOf("/");s>-1&&(o=o.substr(s+1)),r[o]=!1}t=r}return t[e]=n,t},c=function(t,e){var n=0,i=0,o=0,c=[];const l=function(t,e,n){this.onFileStart&&this.onFileStart.call(this,e,i),this.parser.addContent.call(this,t,e,n),this.onFileEnd&&this.onFileEnd.call(this,e,i),i++},f=this;f.opts.images||(f.opts.images={});for(var h,p=0;h=t[p];p++){var g=null;const d=h.name.lastIndexOf("."),v=h.name.substr(d+1);if(h.type.match("text/"))g="text";else if(r(h.name))g="json";else{if("jpg"!=v&&"jpeg"!=v&&"png"!=v&&"svg"!=v)continue;g="img"}n++;var m=!1;c.push(function(t,e){return function(){if(t.empty)return void tasks.shift();var n=new FileReader,r=f.filename=t.name;n.onload=function(t,e,n,r){return function(t){"text"==r?(m&&n.external&&(f.parser.loadExternals&&f.parser.loadExternals(f,n.external),m=!1),content=t.target.result.replace(/\r?\n/g,"\n").trim(),o+=content.length,l.call(f,content,e,n)):"json"==r?(n.external&&(m=!0,s.call(f,n.external,e,t.target.result)),n.afields&&a.call(f,n.afields,e,t.target.result),n.kfields&&a.call(f,n.kfields,e,t.target.result),n.gfields&&a.call(f,n.gfields,e,t.target.result),n.fields&&a.call(f,n.fields,e,t.target.result)):"img"==r&&(m=!0,n.images=u.call(f,n.images,e,t.target.result)),c.shift()()}}(t,r,f.opts,e);const i=r.lastIndexOf("."),h=r.substr(i+1);"img"==e&&"svg"!==h?n.readAsDataURL(t):n.readAsText(t,f.opts.encoding||"UTF-8")}}(h,g))}c.push(function(){setTimeout(function(){e(0,f,o)},1)}),c.shift()({__empty:!0})};e.exports={addBrowserFiles:c,prepareHTMLFile:o}},{}],14:[function(t,e){const n=function(t){const e=t.shift(),n=e.type;for(var r=0;r<t.length;r++){var i=t[r];"string"==typeof t[r]&&(i=t[r].split("	"));const o=i.shift(),s=this.parseRange(o),a=s.start==s.end?s.start:s.range,u=this.findArticle(a);u>=0&&this.putArticleField(n,i.join("	"),a,u)}},r=t("ksana-corpus/textutil"),i=function(t){var e={};for(var n in t){for(var i=t[n],o=0;o<i.length;o++){var s=i[o];"string"==typeof i[o]&&(s=i[o].split("	"));var a=i[o][0],u=r.parseRange(a,this.addressPattern),c=u.start==u.end?u.start:u.range;i[o][0]=c}i.sort(function(t,e){return t[0]-e[0]});for(var o=0;o<i.length;o++){var c=i[o][0],l=this.findArticle(c);l>=0?(e[l]||(e[l]={}),e[l][n]||(e[l][n]={pos:[],value:[]}),e[l][n].pos.push(c),e[l][n].value.push(i[o][1])):console.log("cannot find article",c)}}return e},o=function(t){var e={};for(var n in t){{t[n].sort(function(t,e){return t[0]==e[0]?0:t[0]>e[0]?1:-1})}for(var i=!1,o=!1,s=[],a=[],u=[],c=0;c<t[n].length;c++)if(u.push(t[n][c][0]),s.push(t[n][c][1]),t[n][c][1]&&(i=!0),t[n][c][2]){var l=r.parseRange(t[n][2],this.addressPattern),f=l.start==l.end?l.start:l.range;a.push(f),i=!0}e[n]={key:u},i&&(e[n].value=s),o&&(e[n].kpos=a)}return e},s=function(t){var e={};for(var n in t){for(var i=t[n],o=0;o<i.length;o++){var s=i[o];"string"==typeof i[o]&&(s=i[o].split("	"));var a=i[o][0],u=r.parseRange(a,this.addressPattern),c=u.start==u.end?u.start:u.range;i[o][0]=c}i.sort(function(t,e){return t[0]-e[0]});for(var l=[],f=[],o=0;o<i.length;o++)l.push(i[o][0]),f.push(i[o][1]);e[n]={pos:l,value:f}}return e};e.exports={importExternalMarkup:n,importAFields:i,importKFields:o,importFields:s}},{"ksana-corpus/textutil":63}],15:[function(t,e){const n=t("ksana-corpus").openCorpus;var r=0,i={},o=[],s=function(t){i[t]||(i[t]=0,r++),i[t]++},a=function(t){for(var e=t.join(),n=0;n<e.length;){var r=e.charCodeAt(n),i=e.charCodeAt(n+1);r>=19968&&40959>r&&(o[r-19968]||(o[r-19968]=0),o[r-19968]++,i>19968&&40959>i&&s(e[n]+e[n+1])),n++}},u=function(t){for(var e=0,n=0;n<t.length;n++){var r=Math.floor(100*n/t.length);r>e&&(process.stdout.write(r+"% [0G"),e=r),a(t[n])}},c=function(t){return o[t.charCodeAt(0)-19968]+o[t.charCodeAt(1)-19968]},l=function(t){var e=o.reduce(function(t,e){return t+e},0);console.log("token length",e);var n=t.reduce(function(t,e){return t+e[1]},0);console.log("bigram length",n),console.log("overhead",n/e)},f=function(e){console.log("bigramcount",r);var n=[];for(var s in i){var a=c(s),u=i[s]/a;n.push([s,i[s],o[s.charCodeAt(0)-19968],o[s.charCodeAt(1)-19968],u])}console.log("sorting"),n.sort(function(t,e){return e[1]-t[1]}),n=n.filter(function(t){return t[1]>e.minoccur}),console.log("writing"),t("fs").writeFileSync("bigrams.txt",n.join("\n"),"utf8"),l(n),n=n.map(function(t){return t[0]}),t("fs").writeFileSync("bigrams.js",'module.exports="'+n.join(" ")+'"',"utf8")},h=function(t,e){n(t,function(t,n){n.get(["texts"],{recursive:!0},function(t){console.log("loaded"),console.time("bigram"),u(t),console.timeEnd("bigram"),console.time("summary"),f({minoccur:e.minoccur||1e3}),console.timeEnd("summary")})})};e.exports=h},{fs:void 0,"ksana-corpus":58}],16:[function(t,e){const n=function(t,e,n,r,i,o){if(e){const s=this.substring(i,o).replace(/<.+?>/g,"");this.putArticle(s,n,r);const a=this.makeRange(n,this.kPos);this.putArticleField("rend","article",a)}},r=function(t,e,n,r,i,o){if(e){const s=this.substring(i,o).replace(/<.+?>/g,"");this.putGroup(s,n)}},i=function(t){const e=t.attributes.n;if(e&&-1!=e.indexOf(".")){var n=e.split(".");const r=n[0],i=n[1];var o=parseInt(r,10),s=parseInt(i,10);if(isNaN(o)&&(o=parseInt(r.substr(1),10)),1>o)throw console.log("negative page number, ",t.name,"n=",t.attributes.n),"negative page number";if(this.emitLine(),this._pb!==r&&1===o?this.addBook():1!=s&&s-this._pbline>1&&console.log("Gap at page ",o,"line ",s,",previous line",this._pbline),isNaN(o))throw"error page number "+r;if(this.bookCount){const a=this.makeKPos(this.bookCount,o-1,s-1,0);if(-1==a)throw"error lb "+t.attributes.n;this.newLine(a)}this._pb=r,this._pbline=s}};var o,s=[];const a=function(){this.putField("toc",s,o),this.putField("tocrange",this.kPos,o)},u=function(t,e){e?this._divdepth--:this._divdepth++};var c;const l=function(t,e,r,i,a,u){if(e){const l=this._divdepth;1==l&&(s.length&&(this.putField("toc",s,o),this.putField("tocrange",c.kpos,o),s=[]),o=r,this.opts.topDIVAsArticle&&n.call(this,t,e,r,i,a,u));var h=this.substring(a,u);h=h.replace(/<orig>.*?<\/orig>/g,"").replace(/<sic>.*?<\/sic>/g,""),h=h.replace(/<.+?>/g,"");const p=this.makeRange(r,this.kPos);var g=l;t.attributes.n&&(g+="\n"+t.attributes.n),this.putArticleField("head",g,p),c={depth:l,text:h,kpos:r},s.push(f(c))}},f=t("./tree").encodeTreeItem,h=function(t,e,n,r,i,o){if(e){var s=t.attributes.target||t.attributes.to;if(s||(s=this.substring(i,o)),!s)return;this.putArticleField("link",s,this.makeRange(n,this.kPos))}},p=function(t,e,n){this.putArticleField("pu",t.attributes.n,n)};e.exports={lb:i,article:n,articlegroup:r,link:h,pu:p,div:u,head:l,head_finalize:a}},{"./tree":30}],17:[function(t,e){const n=t("./tags"),r=/\d+\.(\d+)([abcd]?)/,i=/(\d+)([abcd]?)/,o=t("../tree").encodeTreeItem;var s={},a=0,u=[];const c=function(){u.length&&(this.putField("toc",u,a),this.putField("tocrange",s.kpos,a),u=[])},l=function(t){const e=n.tagType(t[0]);if(e==n.TT_HEAD){const r=t.substr(1),i=parseInt(r);t=t.substr(1);const a=isNaN(i)?r:t.substr(i.toString().length).trim();s={depth:i,text:a,kpos:this.kPos},u.push(o(s))}else if(e==n.TT_ARTICLE){var c=!1;t=t.substr(1),n.tagType(t[0])==n.TT_ARTICLE&&(c=!0,t=t.substr(1)),c?p.call(this,t):h.call(this,t)}},f=function(t){const e=n.tagType(t[0]);if(e==n.TT_PB){const o=t.substr(1);var s=o.match(r);if(s||(s=o.match(i)),!s)return void this.log("error","wrong pb "+o+" previous:"+this.stringify(this.kPos));var a=parseInt(s[1],10)-1;if(this.addressPattern.column){{s[2]||"a"}a=a*this.addressPattern.column+(parseInt(s[2],36)-10)}this._pbline=0,this._pb=a+1,0==a&&this.addBook();const u=this.makeKPos(this.bookCount,this._pb-1,this._pbline,0);return this.newLine(u),!0}e==n.TT_P&&this.putEmptyArticleField("p")},h=function(t){this.putArticle(t)},p=function(t){c.call(this),a=this.kPos,this.putGroup(t)},g=function(){c.call(this)};e.exports={addTag:f,addLineTag:l,addArticle:h,addGroup:p,closeTree:c,finalize:g}},{"../tree":30,"./tags":18}],18:[function(t,e){const n=1,r=4,i=5,o=100,s=101,a={"~":n,"#":s,"%":r,"^":o,"/":i},u=function(t){return a[t]},c=function(t){return t==o||t==s};e.exports={tagType:u,isLineTag:c,TT_HEAD:s,TT_ARTICLE:o,TT_P:i,TT_PB:n,TT_PTR:r,TT_HEAD:s}},{}],19:[function(t,e){const n=t("ksana-corpus/ksanapos"),r=t("ksana-corpus/textutil"),i=t("./romable"),o=t("ksana-corpus/tokenizer"),s=t("ksana-corpus").regcor,a=t("./genbigram"),u=20170523,c=t("./inverted").createInverted,l=t("./externalmarkup").importExternalMarkup,f=o.createTokenizer,h=t("./reverselink").importLinks,p={xml:t("./parsexml"),htll:t("./parsehtll"),accelon3:t("./parseaccelon3"),pre:t("./parsepre")},g=/^[a-z]+[\da-z_]*$/,d=function(t){const e=t.match(g);if(!e)throw console.log("corpus id regex:",g),"invalid corpus id "+t;return!0},v=function(e){if(e=e||{},e.id=(e.id||e.name||"").trim(),!e.id)throw"missing corpus id";d(e.id);var a=e.bits?n.buildAddressPattern(e.bits,e.column):s[e.id]?s[e.id]:s["default"],g=n.makeKPos([1,0,0,0],a),v=0,b=!1,y=0,E=-1,k=0,A=0,T=[],F=e.tokenizerVersion||2,w=f(e.tokenizerVersion);w.TokenTypes.PUNC;var x=o.concreteToken,C=i({addressPattern:a}),P=null,I=!1,_={},O=[],S=[],D=0;const B=function(n){if(I)throw"cannot add file "+n+" after finalized";return t("fs").existsSync(n)?(this.onFileStart&&this.onFileStart.call(this,n,k),this.parser.addFile.call(this,n,e),this.emitLine(),this.onFileEnd&&this.onFileEnd.call(this,n,k),void k++):void(-1==n.indexOf("#")&&this.log("error","file not found",n))},N=function(t,e,n){n=n||{},this.parser.setHandlers(this,t,e,n),this.onBookStart=n.bookStart,this.onBookEnd=n.bookEnd,this.onFileStart=n.fileStart,this.onFileEnd=n.fileEnd,this.onToken=n.onToken,this.onFinalize=n.finalize},R=function(t,e,n){if(n=n||this.kPos,"article"==t)throw"use putArticle";C.putField(t,e,n)},L=function(t,e,n,r){r=r||this.kPos,"undefined"==typeof n&&(n=""),C.putKField(t,e,n,r)},z=function(t,e,n){n=n||this.kPos,C.putKField(t,e,"",n)},U=function(t,e,n){n=n||this.kPos,C.putGField(t,e,n)},M=function(t,e){e=e||this.kPos,C.putField(t,null,e)},j=function(t,e,n,r){n=n||this.kPos,C.putAField(t,e,n,r)},G=function(t,e,n){e=e||this.kPos,C.putAField(t,null,e,n)},K=function(t,e,i){e=e||this.kPos;const o=r.bookOf.call(this,e,this.addressPattern),s=r.bookOf.call(this,D);o>s&&(e=n.bookStartPos(e,this.addressPattern)),C.putArticle(t,e),P&&P.putArticle(i),D=e},V=function(t,e,n){e=e||this.kPos,n=n||this.tPos,C.putGField("group",t,e),P&&P.putGroup(n)},H=function(t){_[t]||(_[t]={}),_[t][this.articleCount-1]=!0},q=function(t){x[t[2]]&&(v==this.addressPattern.maxchar&&this.log("error","exceed max char "+this.filename+" line:"+this.parser.line()),v++),T.push(t)},Y=function(t){if(t&&t.length&&b)for(var e=0;e<t.length;e++)q.call(this,t[e])},J=function(t){const e=w.tokenize(t);this.addTokens(e)},X=function(){A&&(this.emitLine(),this.onBookEnd&&this.onBookEnd.call(this,A)),P&&P.putBookPos.call(this,A),A++,this.onBookStart&&this.onBookStart.call(this,A)},W=function(t,e,r,i,o){return o=o||a,n.makeKPos([t,e,r,i],o)},Q=function(t,e,r){return r=r||a,n.makeRange(t,e,r)},Z=function(t){var e=n.unpack(t,a);return e[2]++,e[3]=0,n.makeKPos(e,a)},$=function(t){g=t,v=0,E=t},tt=function(t){for(var e=t.map(function(t){return t[0]}).join("");"\n"==e[0];)e=e.substr(1);for(;"\n"==e[e.length-1];)e=e.substr(0,e.length-1);return e},et=function(){if(T.length){const t=tt(T);if(v>a.maxchar){var e=n.stringify(this.kPos,a);S.push([this.kPos,e,t]),lineKCount=a.maxchar}C.putLine.call(this,t,g),y+=t.length,P&&P.putTokens(T),T=[]}},nt=function(t){if(!(isNaN(t)||1>t)){if(E>t){var r=n.stringify(t,a),i=n.stringify(E,a);if(!e.randomPage)throw this.log("error",this.parser.line()),"line kpos must be larger the previous one. kpos:"+r+"prev "+i;O.push([t,r,E,i])}else this.emitLine(),P&&P.putLinePos.call(this,t);$(t)}},rt=function(t){const e=n.unpack(t,this.addressPattern);return e[2]++,e[3]=0,n.makeKPos(e,this.addressPattern)},it=function(){b=!0},ot=function(){this.emitLine(),b=!1,this.bookcount&&this.onBookEnd&&this.onBookEnd.call(this)},st=function(){for(var t in _)_[t]=Object.keys(_[t]).map(function(t){return parseInt(t,10)})},at=function(){var t={date:(new Date).toString()};return t.versions={tokenizer:F,builder:u},t.bits=a.bits,t.id=e.id||"unknown",e.article&&(t.article=e.article),a.column&&(t.column=a.column),e.language&&(t.language=e.language),e.articleFields&&(t.articleFields=e.articleFields),e.removePunc&&(t.removePunc=e.removePunc),e.title&&(t.title=e.title),e.groupPrefix&&(t.groupPrefix=e.groupPrefix),e.groupColumn&&(t.groupColumn=e.groupColumn),e.displayOptions&&(t.displayOptions=e.displayOptions),st(),e.linkTo?t.linkTo=Object.assign({},_,e.linkTo):Object.keys(_).length&&(t.linkTo=_),t.endpos=g+v,P&&(t.endtpos=P.tPos()),t},ut=function(n,r){b&&ot.call(this),this.onFinalize&&this.onFinalize.call(this),dt.parser.finalize&&dt.parser.finalize(dt,e),I=!0;const i=at.call(this);var o=null;const s={fields:e.fields,afields:e.afields,kfields:e.kfields,gfields:e.gfields};try{o=C.buildROM(i,P,s)}catch(a){return void this.log("ERROR",a)}"undefined"!=typeof window&&console.log(o);var u=5*y+(e.extrasize||0);return 1e6>u&&(u=1e6),n||"undefined"==typeof Window?(t("./outputkdb").write(n,o,u,r),{rom:o,filename:n}):{rom:o,url:t("./outputkdb").writeToBlob(o,u,r)}},ct=function(t){return n.stringify(t,a)},lt=function(t,e){var n=a;return e&&(n=s[e]),n?r.parseRange(t,n):(this.log("ERROR","unknown corpus "+e),0)},ft=t("./handlers");var ht=function(){var t=Array.prototype.slice.call(arguments);"error"==t[0]?(t.shift(),console.error.apply(null,t)):"warn"==t[0]?console.warn.apply(null,t):console.log.apply(null,t)};const pt=function(t){this.log=t,this.parser.setLog&&this.parser.setLog(t),n.setLog&&n.setLog(t),C.setLog&&C.setLog(t)},gt=function(t,e){return this.content.substring(t,e)},dt={tokenizer:w,substring:gt,emitLine:et,setHandlers:N,nextLine:Z,importLinks:h,markBilink:H,addFile:B,addText:J,addToken:q,addTokens:Y,addBook:X,addBrowserFiles:m,putField:R,putGlobalField:U,putEmptyField:M,putKeyField:L,putEmptyKeyField:z,putArticle:K,putArticleField:j,putEmptyArticleField:G,putGroup:V,parseRange:lt,handlers:ft,setPos:$,newLine:nt,nextLineStart:rt,stringify:ct,findArticle:C.findArticle,log:ht,setLog:pt,importExternalMarkup:l,makeKPos:W,makeRange:Q,start:it,romable:C,stop:ot,writeKDB:ut,openhandlers:{},closehandlers:{},otherhandlers:{}};if(Object.defineProperty(dt,"kPos",{get:function(){return g+v}}),Object.defineProperty(dt,"lineTokenCount",{get:function(){return v}}),Object.defineProperty(dt,"kPosH",{get:function(){return n.stringify(g+v,a)}}),Object.defineProperty(dt,"articleCount",{get:function(){return C.articleCount()}}),Object.defineProperty(dt,"fileCount",{get:function(){return k}}),Object.defineProperty(dt,"bookCount",{get:function(){return A}}),Object.defineProperty(dt,"addressPattern",{get:function(){return a}}),Object.defineProperty(dt,"started",{get:function(){return b}}),Object.defineProperty(dt,"disorderPages",{get:function(){return O}}),Object.defineProperty(dt,"longLines",{get:function(){return S}}),Object.defineProperty(dt,"id",{get:function(){return e.id}}),Object.defineProperty(dt,"opts",{get:function(){return e}}),P&&Object.defineProperty(dt,"tPos",{get:P.tPos}),P&&Object.defineProperty(dt,"totalPosting",{get:P.totalPosting}),e.inputFormat=e.inputFormat||"pre",dt.parser=p[e.inputFormat],!dt.parser)throw"unsupported input format "+e.inputFormat;dt.parser.initialize&&dt.parser.initialize(dt,e),dt._pb=0,dt._pbline=0;const vt=e.external&&"object"==typeof e.external.bigrams?e.external.bigrams:null;return P=e.textOnly?null:c({tokenizer:w,tokenizerVersion:F,addressPattern:a,bigrams:vt,removePunc:e.removePunc}),b="undefined"!=typeof e.autoStart?e.autoStart:!0,dt.newLine(g),dt},m=t("./browserfile").addBrowserFiles,b=t("./browserfile").prepareHTMLFile,y=function(t,e,n){b(t,function(t,r,i){if(t)return void n(t);const o=v(i);e&&o.setLog(e),o.setHandlers(),m.call(o,r,n)})},E=function(e,n){const r=t("fs");if(!r.existsSync|e)return void n(e+" not found");const i=r.readFileSync(e);var o=null;try{o=JSON.parse(i)}catch(s){return void n(s.message||s)}const a=e.match(/([^\/\\ ]+)-corpus\.json/);if(!a)return void n("invalid corpus json name:",e);corpusid=a[1];const u=t("path").dirname(e)+"/";o.path=u;const c=v(o);o.id||(o.id=corpusid);var l=[];o.files?l=o.files:(l=r.readdirSync(u),l=l.filter(function(t){return".xml"==t.substr(t.length-4)})),l.forEach(function(t){c.addFile(u+t)}),c.writeKDB(corpusid+".cor",function(t,e){n(0,t,e)})},k=function(t,e,r,i,o){return"string"==typeof o&&(o=s[o]),n.makeKPos([t,e,r,i],o)};e.exports={createCorpus:v,createCorpusFromJSON:E,createWebCorpus:y,makeKPos:k,genBigram:a}},{"./browserfile":13,"./externalmarkup":14,"./genbigram":15,"./handlers":16,"./inverted":20,"./outputkdb":23,"./parseaccelon3":24,"./parsehtll":25,"./parsepre":26,"./parsexml":27,"./reverselink":28,"./romable":29,fs:void 0,"ksana-corpus":58,"ksana-corpus/ksanapos":60,"ksana-corpus/textutil":63,"ksana-corpus/tokenizer":65,path:void 0}],20:[function(t,e){const n=t("ksana-corpus/diacritics").normalize,r=function(t){
const e=function(t){m[t]=k,k+=1e3},r=function(t){const e=Math.pow(2,addressPattern.charbits),n=Math.pow(2,addressPattern.rangebits);if(idx=Math.floor(t%n/e),book=Math.floor(t/n),!v[book]&&(v[book]=[],0!==idx))for(var r=idx;r>0;)v[book][--r]=k;v[book][idx]=k},o=function(t,e){d[t]||(d[t]=[]),d[t].push(e)},s=function(t,e){if(e==f.SPACE)return void(E=null);if(e!==f.PUNC||!p){if(e==f.LATIN&&"string"==typeof t&&(t=n(t).toLowerCase()),e==f.PUNC||e==f.NUMBER)return E=null,void k++;if("string"==typeof t)h&&h[E+t]&&(o(E+t,k-1),A++),o(t,k),A++;else for(var r=0;r<t.length;r++)h[E+t[r]]&&(A++,o(E+t[r],k-1)),o(t[r],k),A++;k++,E=t}},a=function(t){for(i=0;i<t.length;i++){const e=t[i][2];s(t[i][0],e)}},u=function(t){t=t||k,b.push(t),k+=500},c=function(t){t=t||k,y.push(t)},l=function(){var t=[],e=[];for(var n in d)t.push([n,d[n]]);t.sort(function(t,e){return t[0]==e[0]?0:t[0]>e[0]?1:-1});for(var r=0;r<t.length;r++)e.push(t[r][1].length);var i=t.map(function(t){return t[0]}),o=t.map(function(t){return t[1]});d={};const s={tokens:i,postings:o,article2tpos:b,line2tpos:v,book2tpos:m,posting_length:e};return y.length&&(s.group2tpos=y),s},f=t.tokenizer.TokenTypes;var h,p,g={},d={},v={},m=[],b=[],y=[],E=null,k=1,A=0;return h=t.bigrams||null,addressPattern=t.addressPattern,g.tokenizer=t.tokenizer,g.tPos=function(){return k},g.totalPosting=function(){return A},g.putBookPos=e,g.putToken=s,g.putTokens=a,g.putArticle=u,g.putGroup=c,g.finalize=l,g.putLinePos=r,p=!!t.removePunc,g};e.exports={createInverted:r}},{"ksana-corpus/diacritics":51}],21:[function(t,e){var n={uint8:"1",int32:"4",utf8:"8",ucs2:"2",bool:"^",blob:"&",utf8arr:"*",ucs2arr:"@",vint:"`",pint:"~",array:"",object:""},r=[],i=function(t,e){if(!t||0===t.length)return[];var n=[],i=0,o=0,s=0,a=0;do{if(s=t[i]||a,e&&(s-=a),0>s)throw console.log(t),console.trace("negative value at",i,"prev:",a,"now:",t[i],"key:",r),"negetive";for(n[o++]=s%128,s=Math.floor(s/128);s>0;)n[o++]=s%128|128,s=Math.floor(s/128);a=t[i]||a,i++}while(i<t.length);return n};const o=t("buffer/").Buffer;var s=function(t){t=t||{},t.size=t.size||134217728;var e=new o(t.size),i=0,s=function(t,n){return e.write(t,n,t.length,"utf8"),n+t.length>i&&(i=n+t.length),t.length},a=function(t,n){return e.writeUInt8(Math.floor(t/4294967296),n),e.writeUInt32BE(4294967295&t,n+1),n+5>i&&(i=n+5),5},u=function(t,r,s){if(s=s||"ucs2",""==t)throw"cannot write null string";if("utf8"===s)e.write(n.utf8,r,1,"utf8");else{if("ucs2"!==s)throw"unsupported encoding "+s;e.write(n.ucs2,r,1,"utf8")}var a=o.byteLength(t,s);return e.write(t,r+1,a,s),r+a+1>i&&(i=r+a+1),a+1},c=function(t,s,a){if(a=a||"ucs2","utf8"===a)e.write(n.utf8arr,s,1,"utf8");else{if("ucs2"!==a)throw"unsupported encoding "+a;e.write(n.ucs2arr,s,1,"utf8")}var u=t.join("\x00"),c=o.byteLength(u,a);if(0===c)throw"empty string array "+JSON.stringify(r);return e.write(u,s+1,c,a),s+c+1>i&&(i=s+c+1),c+1},l=function(t,r){return e.write(n.int32,r,1,"utf8"),e.writeInt32BE(t,r+1),r+5>i&&(i=r+5),5},f=function(t,r){return e.write(n.uint8,r,1,"utf8"),e.writeUInt8(t,r+1),r+2>i&&(i=r+2),2},h=function(t,r){return e.write(n.bool,r,1,"utf8"),e.writeUInt8(Number(t),r+1),r+2>i&&(i=r+2),2},p=function(t,r){e.write(n.blob,r,1,"utf8"),t.copy(e,r+1);var o=t.length+1;return r+o>i&&(i=r+o),o},g=function(t,n,o){if(1===o)var s=e.writeUInt8;else{if(4!==o)throw"unsupported integer size";var s=e.writeInt32BE}if(!t.length)throw'empty fixed array"'+JSON.stringify(r)+'"';for(var a=0;a<t.length;a++)try{s.apply(e,[t[a],a*o+n])}catch(u){throw u}var c=o*t.length;return n+c>i&&(i=n+c),c};return this.writeI32=l,this.writeBool=h,this.writeBlob=p,this.writeUI8=f,this.writeString=u,this.writeSignature=s,this.writeOffset=a,this.writeStringArray=c,this.writeFixedArray=g,Object.defineProperty(this,"buf",{get:function(){return e}}),this},a=function(e){e=e||{};var o=new s(e),a=0,u={},c=function(t){var e=i(t,!1);o.writeFixedArray(e,a,1),a+=e.length},l=function(t){c([t])},f=function(t){var e=i(t,!0);o.writeFixedArray(e,a,1),a+=e.length},h=function(t,e){var r=a;a+=o.writeSignature(n.vint,a),c(t);var i=a-r;return k(e,i),i},p=function(t,e){var r=a;a+=o.writeSignature(n.pint,a),f(t);var i=a-r;return k(e,i),i},g=function(t,e){var n=o.writeUI8(t,a);return a+=n,k(e,n),n},d=function(t,e){var n=o.writeBool(t,a);return a+=n,k(e,n),n},v=function(t,e){var n=o.writeI32(t,a);return a+=n,k(e,n),n},m=function(t,e,n){n=n||C;var r=o.writeString(t,a,n);return a+=r,k(e,r),r},b=function(t,e,n){n=n||C,r.push(e);try{var i=o.writeStringArray(t,a,n)}catch(s){throw s}return a+=i,k(e,i),r.pop(),i},y=function(t,e){r.push(e);var n=o.writeBlob(t,a);return a+=n,k(e,n),r.pop(),n},E=[],k=function(t,e){var n=E[E.length-1];if(n&&(n.itemslength.push(e),"string"==typeof t)){if(!n.keys)throw"cannot have key in array";n.keys.push(t)}},A=function(t){var e=a,r=t.key||null,i=t.type||n.array;a+=o.writeSignature(i,a),a+=o.writeOffset(0,a);var s={type:i,key:r,start:e,datastart:a,itemslength:[]};i===n.object&&(s.keys=[]),E.push(s)},T=function(t){r.push(t),A({type:n.object,key:t})},F=function(t){r.push(t),A({type:n.array,key:t})},w=function(t,e,n){n.apply(u,[t,e])},x=function(){if(!E.length)throw"empty stack";var t=E.pop();o.writeOffset(a-t.datastart,t.datastart-5);var e=t.itemslength.length;return l(e),c(t.itemslength),t.type===n.object&&(a+=o.writeStringArray(t.keys,a,"utf8")),written=a-t.start,k(t.key,written),r.pop(),written},C="ucs2",P=function(t){return t?void(C=t):C},I=function(t){return t.length<5?S(t):"number"==typeof t[0]&&Math.round(t[0])==t[0]&&t[0]>=0?!0:!1},_=function(t){var e=0,n=1,r=1;if(t.length>t[t.length-1])return!1;if(1==t.length)return!0;var i=t.length;t.length>50&&(i=50);for(var o=1;i>o;o++)if(t[o]<t[o-1])return!1;for(;r<t.length;){if(r=e+n,t[e]>t[n])return!1;e=n,n=r}return!0},O=function(t){return t.normalArray?!1:t.length<5?D(t):"string"==typeof t[0]?!0:!1},S=function(t){for(var e=0;e<t.length;e++)if("number"!=typeof t[e]&&Math.round(t[e])!==t[e])return!1;return!0},D=function(t){for(var e=0;e<t.length;e++)if("string"!=typeof t[e])return!1;return!0},B=function(t,e,n){if(n=n||{},"null"==typeof t||"undefined"==typeof t)throw"cannot save null value of ["+e+"] folders"+JSON.stringify(E);var i=t.constructor.name;if("Object"===i){T(e);for(var s in t)B(t[s],s,n),n.autodelete&&delete t[s];x()}else if("Array"===i)if(I(t))t.sorted||_(t)?w(t,e,p):w(t,e,h);else if(O(t))b(t,e,t.enc);else{F(e);for(var s=0;s<t.length;s++){if(!t[s])throw console.error(t),"array has gap at "+s+" keys"+JSON.stringify(r);B(t[s],s,n),n.autodelete&&delete t[s]}x()}else if("String"===i)m(t,e);else if("Number"===i)t>=0&&256>t?g(t,e):v(t,e);else if("Boolean"===i)d(t,e);else{if("Buffer"!==i)throw"unsupported type "+i+" keys"+JSON.stringify(r);y(t,e)}return o.buf},N=function(){for(;E.length;)x();o.free()},R=function(){return a};Object.defineProperty(u,"size",{get:function(){return a}});var L=function(e,n,r){const i="fs";var s=t(i),a=u.currentsize(),c=0,l=0;("undefined"==typeof r||"function"==typeof n)&&(r=n),n=n||{},batchsize=n.batchsize||16777216,s.existsSync(e)&&s.unlinkSync(e);var f=function(t,e,n,r){return function(i){if(i)throw"write error"+i;n(t,e),l++,r()}},h=function(){if(p>l){var t=batchsize*l,n=t+batchsize;n>a&&(n=a);var i=o.buf.slice(t,n);c+=i.length,s.appendFile(e,i,f(a,c,r,h))}},p=1+Math.floor(u.size/batchsize);h()};return u.free=N,u.saveI32=v,u.saveUI8=g,u.saveBool=d,u.saveString=m,u.saveVInt=h,u.savePInt=p,u.saveInts=w,u.saveBlob=y,u.save=B,u.openArray=F,u.openObject=T,u.stringEncoding=P,u.close=x,u.writeFile=L,u.currentsize=R,u};e.exports=a},{"buffer/":2}],22:[function(t,e){var n="",r=0;const i=function(){const t=this.tagstack.map(function(t){return t.tag.name+"#"+(t.line+1)});return t.join("/")},o=function(){const e=this.filename;var o=e;try{o=t("path").resolve(e)}catch(s){}"/"==o[0]&&(o=o.substr(1));var a=this.error.message.replace(/\n/g," "),u=0;a=a.replace(/(Line: )(\d+) /,function(t,e,n){return u=parseInt(n,10),isNaN(u)?e+n:""}),(n!=e||r!=u)&&(this.log(o+"("+(u+1)+"): "+a+(a.indexOf("close tag")>0?"  "+i.call(this):"")),n=e,r=u)};e.exports=o},{path:void 0}],23:[function(t,e){const n=t("./kdbw"),r=function(t,e,r){var i=n({size:e});const o=i.save(t),s=o.slice(0,i.currentsize()),a=new Blob([s],{type:"application/octet-stream"}),u=URL.createObjectURL(a);return r&&r(u,a.size),u},i=function(t,e,r,i){var o=n({size:r});o.save(e,null),o.writeFile(t,function(e,n){i&&e==n&&i(e,t)})};e.exports={write:i,writeToBlob:r}},{"./kdbw":21}],24:[function(t,e){const n=t("./accelon3handler/format"),r=t("./accelon3handler/note"),i=t("./accelon3handler/tree"),o=t("./accelon3handler/img"),s=t("./tree").encodeTreeItem,a=t("./parsepre");var u={"段":n.p,p:n.p,"頁":n.pb,"註":r.ptr,"釋":r.def,"圖":o};const c={"釋":r.def,"圖":o};var l=null,f=0,h=[],p=0;const g=function(t,e,n){const r=this;onopentag=function(t){"類"==t.name;const e=i.call(r,t),o=e.indexOf(t.name);if(o>-1){if(l)throw"nested Toc "+t.name+" line:"+parser.line;if(n.toc){const s=e.indexOf(n.toc);f=o>s?s:0}l={tag:t.name,kpos:r.kPos,depth:o,subtree:f}}},onclosetag=function(t){if(l&&t.tag.name==l.tag){const e=this.position-t.tag.name.length-3;if(l.text=r.substring(t.position,e),l.subtree){const i=l.depth-(l.subtree||0);r.putArticleField("head",i,r.makeRange(t.kpos,r.kPos)),r.putEmptyArticleField("p",t.kpos),h.push(s(l))}else h.length&&(r.putField("toc",h,p),r.putField("tocrange",l.kpos,p),h=[]),n.toc==l.tag&&(l.depth=0,h.push(s(l))),p=l.kpos;l=null}};const o=Object.assign({},n,{customHead:!0,onopentag:onopentag,onclosetag:onclosetag});a.addContent.call(this,t,e,o)},d=function(t){h.length&&(t.putField("toc",h,p),t.putField("tocrange",t.kPos,p))},v=function(t,e){a.initialize(t,e),t.openhandlers=u,t.closehandlers=c;const r=e.schema||{};r.article&&(t.openhandlers[r.article]=n.article,t.closehandlers[r.article]=n.article),r.category&&(t.openhandlers[r.category]=n.category,t.closehandlers[r.category]=n.category),r.group&&(t.openhandlers[r.group]=n.group,t.closehandlers[r.group]=n.group)},m=function(e,n){const r=t("fs"),i=n.encoding||"utf8";var o=r.readFileSync(e,i);o=o.replace(/\r?\n/g,"\n").trim(),this.filename=e,g.call(this,o,e,n)};e.exports={addFile:m,addContent:g,setLog:a.setLog,initialize:v,setHandlers:a.setHandlers,finalize:d}},{"./accelon3handler/format":7,"./accelon3handler/img":8,"./accelon3handler/note":10,"./accelon3handler/tree":12,"./parsepre":26,"./tree":30,fs:void 0}],25:[function(t,e){var n=console.log;const r=t("./htll/handlers"),i=t("./htll/tags"),o=i.tagType;var s,a=function(e,n){const r=t("fs");console.log(e);n.encoding||"utf8";var i=r.readFileSync(e,"utf8").replace(/\r?\n/g,"\n");this.filename=e,u.call(this,i,e,n)},u=function(t){var e="";const n=this;var s;const a=function(){if(e){const t=n.tokenizer.tokenize(e);for(var r=0;r<t.length;r++){const i=t[r];if("\n"!==i[0])n.addToken(i);else if(n._pb){const o=n.makeKPos(n.bookCount,n._pb-1,n._pbline+1,0);o&&(n.newLine(o,n.tPos),n._pbline++,s=s)}}tokens=[],e=""}};for(var u,c,l=0,f="",s=0;l<t.length;)if(u=t[l],f="",c=o(u))if(a(),i.isLineTag(c)){for(;l<t.length&&"\n"!==u;)f+=u,u=t[++l];"\n"==u&&l++,r.addLineTag.call(this,f)}else{for(f+=u,u=t[++l];l<t.length&&(u>="0"&&"9">=u||"."==u||"_"==u||"-"==u||u>="a"&&"z">=u||u>="A"&&"Z">=u);)f+=u,u=t[++l];const h=r.addTag.call(this,f);h&&"\n"==u&&l++}else e+=u,l++;a()};const c=function(){return s},l=function(t){n=t},f=function(t){r.finalize.call(t)};e.exports={addFile:a,addContent:u,line:c,setLog:l,finalize:f}},{"./htll/handlers":17,"./htll/tags":18,fs:void 0}],26:[function(t,e){const n=t("./accelon3handler/format"),r=t("./accelon3handler/note"),i=t("./accelon3handler/anchor"),o=t("./accelon3handler/img"),s=t("./accelon3handler/svg"),a=t("./reverselink"),u=t("./handlers").link,c=t("./handlers").pu,l=t("./onerror");var f=console.log;const h=t("./tree").encodeTreeItem;var p,g={p:n.p,article:n.article,origin:n.origin,tag:n.tag,a:i.a,anchor:i.a,group:n.group,rubynote:r.rubynote,pb:n.pb,ptr:r.ptr,def:r.def,fn:r.footnote,footnote:r.footnote,fn:r.footnote,link:u,img:o,svg:s,pu:c};const d={def:r.def,article:n.article,group:n.group,tag:n.tag,link:u,img:o,svg:s},v=function(t,e,n,r){t.openhandlers=Object.assign(t.openhandlers,e),t.closehandlers=Object.assign(t.closehandlers,n),t.otherhandlers=Object.assign(t.otherhandlers,r)};var m=null,b=0,y=[];const E=function(e,n,r){r=r||{};const o=t("sax");p=o.parser(!0),p.tagstack=[],p.log=f;var s="",u=0,c=this;c.content=e,p.filename=c.filename;const g=function(){if(s){const t=c.tokenizer.tokenize(s);for(var e=0;e<t.length;e++){const n=t[e];if("\n"!==n[0])this.addToken(n);else if(this._pb){if(0==this.lineTokenCount&&0==this._pbline)continue;const r=this.makeKPos(this.bookCount,this._pb-1,this._pbline+1,0);r&&(this.newLine(r,this.tPos),this._pbline++)}}tokens=[],s=""}};p.ontext=function(t){"<"!=t[0]&&(s+=t)},p.oncdata=function(t){g.call(c),c.putArticleField("cdata",t)},p.onopentag=function(t){g.call(c);const e={tag:t,kpos:c.kPos,tpos:c.tPos,position:this.position,line:this.line};this.tagstack.push(e);const n=c.openhandlers[t.name];if(r.customHead)r.onopentag&&r.onopentag.call(this,t);else{const i=t.name.match(/^[Hh]\d+/);if(i){const o=parseInt(t.name.substr(1),10),s=t.attributes.t||t.attributes.text||"";m={tag:t.name,kpos:c.kPos,text:s,depth:o,position:this.position}}}n&&n.call(c,t)&&(u++,e.capturing=!0)},p.onclosetag=function(t){g.call(c);const e=this.tagstack.pop(),n=e.tag,i=e.kpos,o=e.tpos,s=e.position,u=this.position-t.length-3,l=c.closehandlers[t];if(c.kPos>i&&e.tag.attributes.to&&a.add(c,i,e.tag,"a"),r.rendClass){var f=r.rendClass instanceof Array?r.rendClass.indexOf(t)>-1:r.rendClass[t],p=t;f&&(e.tag.attributes&&Object.keys(e.tag.attributes).length&&(p+="|"+JSON.stringify(e.tag.attributes)),c.putArticleField("rend",p,c.makeRange(i,c.kPos)))}if(l?l.call(c,n,!0,i,o,s,u):c.otherhandlers.onclosetag&&c.otherhandlers.onclosetag.call(c,n,!0,i,o,s,u),r.keyField){var d=!1;if(d="string"==typeof r.keyField?r.keyField==n.name:r.keyField.indexOf(n.name)>-1){const v=c.content.substring(s,u);var p="";const E=Object.keys(n.attributes);1==E.length?p=n.attributes[E[0]]:E.length>1&&(p=JSON.stringify(n.attributes)),c.putKeyField(n.name,v,p)}}if(r.customHead)r.onclosetag&&r.onclosetag.call(this,e);else if(r.toc==t&&(y.length&&(c.putField("toc",y,b),c.putField("tocrange",m.kpos,b),y=[]),b=c.kPos),m&&t==m.tag){var k=m.depth;m.text||(m.text=c.content.substring(m.position,u).replace(/<.+?>/g,""));const A=n.attributes.n;A&&(k+="	"+A);const T=c.makeRange(m.kpos,c.kPos);c.kPos>m.kpos&&c.putArticleField("head",k,T),y.push(h(m))}},p.onprocessinginstruction=function(t){i.addAnchor.call(c,t.name)},p.onerror=l,p.write(e)},k=function(e,n){const r=t("fs"),i=n.encoding||"utf8";var o=r.readFileSync(e,i);o=o.replace(/\r?\n/g,"\n").trim(),this.filename=e,E.call(this,o,e,n)},A=function(){return p.line},T=function(t,e){e.footnotes&&r.setFootnotes(e.footnotes)},F=function(e,n){if(n){const r="fs",i=t(r);var o="";try{for(var s in n)o=e+n[s],i.existsSync(o)&&(n[s]=JSON.parse(i.readFileSync(o,"utf8")))}catch(a){f(o),f(a)}}},w=function(e,n){var i={},o=null;try{const s="fs";o=t(s)}catch(a){}if(o&&o.existsSync){if(n.images){for(var u=0;u<n.images.length;u++){const c=n.path+n.images[u];if(o.existsSync(c)){var l=n.images[u].lastIndexOf("/"),h=c;l>1&&(h=n.images[u].substr(l+1)),i[h]=o.readFileSync(c)}}n.images=i}if(n.external)try{for(var p in n.external){const c=n.path+n.external[p];o.existsSync(c)&&(n.external[p]=JSON.parse(o.readFileSync(c,"utf8")))}if(n.external.footnotes&&r.setFootnotes(n.external.footnotes),n.external.bigrams&&"string"==typeof n.external.bigrams){const v={};n.external.bigrams.split(" ").forEach(function(t){v[t]=!0}),n.external.bigrams=v}}catch(a){f(a)}F(n.path,n.afields),F(n.path,n.fields),F(n.path,n.gfields),F(n.path,n.kfields)}n.toc||(n.toc="article"),e.openhandlers=g,e.closehandlers=d,e._pbline=0,e._pb=0},x=function(t,e){if(e.external&&e.external.footnotes){const n=r.getFootnotes(e.external.footnotes),i=Object.keys(n);i.length&&t.log("warn","unconsumed footnotes:",i.join(",").substring(0,500))}for(var o in e.external){const s=o.indexOf(a.BILINKSEP);if(s>0){const u=o.substr(s+1),c=e.external[o];e.linkTo||(e.linkTo={}),e.linkTo[o]=a.importLinks.call(t,o,c,u)}}y.length&&(t.putField("toc",y,b),t.putField("tocrange",t.kPos,b))},C=function(t){f=t};e.exports={addFile:k,addContent:E,setHandlers:v,line:A,initialize:w,loadExternals:T,finalize:x,setLog:C}},{"./accelon3handler/anchor":6,"./accelon3handler/format":7,"./accelon3handler/img":8,"./accelon3handler/note":10,"./accelon3handler/svg":11,"./handlers":16,"./onerror":22,"./reverselink":28,"./tree":30,fs:void 0,sax:4}],27:[function(t,e){const n=t("sax");var r,i=console.log;const o=t("./handlers"),s=t("./accelon3handler/img"),a=t("./accelon3handler/format");var u={article:o.article,articlegroup:o.articlegroup,p:a.p,lb:o.lb,head:o.head,div:o.div,img:s};const c={div:o.div,head:o.head,article:o.article,articlegroup:o.articlegroup,img:s},l=t("./onerror"),f=function(t,e,n,r){t.openhandlers=Object.assign(t.openhandlers,e),t.closehandlers=Object.assign(t.closehandlers,n),t.otherhandlers=Object.assign(t.otherhandlers,r)},h=function(t,e,o){r=n.parser(!0),r.tagstack=[];var s="",a=0,u=this;r.filename=u.filename,r.log=i,u.content=t;const c=function(){s=s.replace(/\r?\n/g,"");const t=u.tokenizer.tokenize(s);u.addTokens(t),s=""};r.ontext=function(t){a||(s+=t)},r.oncdata=function(t){c.call(this),u.putArticleField("cdata",t)},r.onopentag=function(t){if(!a||"lb"!=t.name){c.call(this);var e={tag:t,kpos:u.kPos,tpos:u.tPos,position:this.position};this.tagstack.push(e);const n=u.openhandlers[t.name];u.position=this.position,n&&n.call(u,t,!1)&&(a++,e.capturing=!0)}},r.onclosetag=function(t){if(!a||"lb"!=t){const e=this.tagstack.pop(),n=e.tag,r=e.kpos,i=e.tpos,s=e.position,l=u.closehandlers[t],f=this.position-t.length-3;a||c.call(this),o.applyRend&&n.attributes.rend&&r<u.kPos&&u.putArticleField("rend",n.attributes.rend,u.makeRange(r,u.kPos)),l?l.call(u,n,!0,r,i,s,f):u.otherhandlers.onclosetag&&u.otherhandlers.onclosetag.call(u,n,!0,r,i,s,f),e.capturing&&a--}},r.onerror=l,r.write(t)},p=function(e,n){const r=t("fs"),i=n.encoding||"utf8";var o=r.readFileSync(e,i).replace(/\r?\n/g,"\n").trim();this.filename=e,h.call(this,o,e,n)},g=function(){return r.line},d=function(t){i=t},v=function(t){t._divdepth=0,t.openhandlers=u,t.closehandlers=c},m=function(t){o.head_finalize.call(t)};e.exports={addFile:p,addContent:h,setHandlers:f,setLog:d,line:g,initialize:v,finalize:m}},{"./accelon3handler/format":7,"./accelon3handler/img":8,"./handlers":16,"./onerror":22,fs:void 0,sax:4}],28:[function(t,e){const n="<",r=function(t,e,r){var i=t.id,o=r.attributes.to;const s=o.match(/(.+)@(.+)/);s&&(i=s[1],o=s[2]);const a=t.parseRange(o,i!==t.id?i:null),u=r.name+n+i;t.putGlobalField(u,a.range?a.range:o,t.makeRange(e,t.kPos)),i!==t.id&&t.markBilink(u)},i=function(t,e,n){for(var r={},i=0;i<e.length;i++)if("string"==typeof e[i]){const o=e[i].split("	");var s=this.parseRange(o[0]).range,a=this.findArticle(s);if(0>a)this.log("ERROR","invalid address "+o[0]);else{r[a]=!0;var u=o[1];parseInt(u,10).toString(10)==u&&(u=parseInt(u,10));const c=this.parseRange(u,n);c&&c.range&&(u=c.range),this.putGlobalField(t,u,s)}}return Object.keys(r).map(function(t){return parseInt(t,10)}).sort(function(t,e){return t-e})};e.exports={add:r,importLinks:i,BILINKSEP:n}},{}],29:[function(t,e){const n=t("ksana-corpus/ksanapos"),r=t("ksana-corpus/bsearch"),i=t("./externalmarkup").importAFields,o=t("./externalmarkup").importKFields,s=t("./externalmarkup").importFields;var a=console.log;const u=function(t){t=t||{};var e={},u={},c={},l=[],f={},h=0;const p=function(t,e,n,r){"undefined"!=typeof r?(u[t]||(u[t]={}),u[t][r]||(u[t][r]=[]),u[t][r].push([n,e])):(u[t]||(u[t]=[]),u[t].push([n,e]))},g=function(t,n,r){e[t]||(e[t]=[]),e[t].push([r,n])},d=function(t,e){h++,m=null,g("article",t,e)},v=function(t,e,n,r){f[t]||(f[t]=[]),f[t].push([e,n,r])};var m=null,b=null;const y=function(t){var i=t;const o=this.addressPattern;"string"==typeof t&&(i=n.parse(t,o));const s=n.breakRange(i,o);m||(m=[],b=[],e.article.forEach(function(t){m.push(t[0]),b.push(t[1])}));var a=r(m,s.start+1,!0)-1;return a},E=function(e,r,i,o){var s=o;if(s||"number"==typeof s||(s=h-1),!(0>s)){c[s]||(c[s]={}),c[s][e]||(c[s][e]=[]);const u=c[s][e].length;u&&c[s][e][u-1][0]==i&&a("warning same kpos, field "+e+" kpos "+n.stringify(i,t.addressPattern)),c[s][e].push([i,r])}},k=function(t,e){return"undefined"!=typeof e?u[t][e]:u[t]},A=function(t){return u[t]},T=function(t,e){return"undefined"!=typeof e?u[t][e]:u[t]},F=function(){return c},w=function(t,e){var r=n.unpack(e,this.addressPattern);const i=r[0]-1,o=r[1],s=r[2];l[i]||(l[i]=[]),l[i][o]||(l[i][o]=[]);const a=r[1];for(var u=a-1;u>=0&&!l[i][u];)l[i][u--]=[" "];t||s||(t=" ");for(var c=s-1;c>=0&&!l[i][o][c];)l[i][o][c]=" ",c--;l[i][o][s]=t},x=function(){for(var t=0;t<l.length;t++){const e=l[t];if(!e)throw"empty book"+(t+1);for(var n=0;n<e.length;n++)for(const r=e[n];r.length>1&&""==r[r.length-1].trim();)r.pop()}return l},C=function(t){if(0==Object.keys(f).length)return null;const e={};for(var n in f){const r=f[n];r.sort(function(t,e){return t[0]==e[0]?0:t[0]>e[0]?1:-1});var i=!1;const s=[],u=[],c=[];for(var l=0;l<r.length;l++)s.push(r[l][0]),r[l][1]&&(i=!0),u.push(r[l][1]),c.push(r[l][2]);e[n]={key:s,kpos:c},i&&(e[n].value=u)}var h={};if(t){h=o.call(this,t);for(var s in h)e[s]?a("duplicate kfield",s):e[s]=h[s]}return e},P=function(t){for(u in c){var e=c[u];for(name in e){const n=e[name];var r=[],o=[];for(hasvalue=null!==n[0][1],n.sort(function(t,e){return t[0]===e[0]?t[1]-e[1]:t[0]-e[0]}),j=0;j<n.length;j++)r.push(n[j][0]),hasvalue&&o.push(n[j][1]);e[name]={pos:r},o.length&&(e[name].value=o)}}var s={};if(t){s=i.call(this,t);for(var u in s){c[u]||(c[u]={});for(var n in s[u])c[u][n]?a("duplicate afield",n):c[u][n]=s[u][n]}}return c},I=function(t,e){var n,r,i,o,u;for(n in t){var c=[],l=[],f=t[n];if(f instanceof Array){for(u=null!==f[0][1],f.sort(function(t,e){return t[0]===e[0]?t[1]-e[1]:t[0]-e[0]}),r=0;r<f.length;r++)c.push(f[r][0]),u&&l.push(f[r][1]);t[n]={pos:c},l.length&&(t[n].value=l)}else for(i in f){for(o=f[i],c=[],l=[],u=null!==o[0][1],o.sort(function(t,e){return t[0]===e[0]?t[1]-e[1]:t[0]-e[0]}),r=0;r<o.length;r++)c.push(o[r][0]),u&&l.push(o[r][1]);f[i]={pos:c},l.length&&(f[i].value=l)}}var h={};if(e){h=s.call(this,e);for(var p in h)t[p]?a("duplicate field",p):t[p]=h[p]}return t},_=function(t,n,r){const i=P.call(this,r.afields),o=C.call(this,r.kfields),s=I.call(this,u,r.fields),a=I.call(this,e,r.gfields),c=x(),l={meta:t,texts:c};if(n&&(l.inverted=n.finalize()),o&&Object.keys(f).length&&(l.kfields=o),Object.keys(s).length&&(l.fields=s),l.gfields=a,Object.keys(i).length&&(l.afields=i),!e.article)throw"missing article";if(n&&!l.inverted.book2tpos)throw"missing pb";return l},O=function(t){a=t};return{putLine:w,putArticle:d,addressPattern:t.addressPattern,setLog:O,articleCount:function(){return h},putField:p,putAField:E,putGField:g,putKField:v,getAField:T,getAFields:F,getField:k,getGField:A,buildROM:_,findArticle:y}};e.exports=u},{"./externalmarkup":14,"ksana-corpus/bsearch":48,"ksana-corpus/ksanapos":60}],30:[function(t,e){const n=function(t){return t.depth-(t.subtree||0)+"	"+t.text+"	"+t.kpos.toString(36)},r=function(t){const e=t.split("	");return{depth:e[0],text:e[1],kpos:parseInt(e[2],36)}};e.exports={encodeTreeItem:n,decodeTreeItem:r}},{}],31:[function(t,e){function n(t){console.error("Error: "+t.name+" "+t.message)}var r=function(t,e){var n=new FileReader;n.onload=function(){e(n.result.length)},n.readAsDataURL(t)},i=function(t,e){var n=new XMLHttpRequest;const r=0==t.indexOf("http")?"?"+(new Date).getTime():"";n.open("HEAD",t+r,!0),n.onload=function(t){var r=parseInt(n.getResponseHeader("Content-Length"));isNaN(r)&&(r=t.total),setTimeout(function(){this.status>200?e(1,"invalid url"):e(0,r)}.bind(this),0)},n.send()},o=function(){},s=function(){throw"not implement yet"},a=function(){throw"not implement yet"},u=function(t,e){var n={};n.url=URL.createObjectURL(t),n.fn=t.name.substr(t.name.indexOf("#")+1),n.file=t,e(n)},c=function(t,e){var n={};n.url=t.replace(/#.*/,"");const r=t.match(/#(.+)\*(\d+)/);n.fn=r[1],n.blobsize=parseInt(r[2]),e(n)},l=function(t,e){var n={};n.url=t,n.fn=t.substr(t.lastIndexOf("/")+1),e(n)},f=function(t,e){var n={};if(0==t.indexOf("filesystem:"))n.url=t,n.fn=t.substr(t.lastIndexOf("/")+1);else{n.fn=t;var r=b.files.filter(function(e){return e[0]==t});r.length?n.url=r[0][1]:e(null)}e(n)},h=function(t,e){return"undefined"!=typeof File&&t.constructor===File?void u.call(this,t,e):0==t.indexOf("blob:")?void c.call(this,t,e):0==t.indexOf("http")||0==t.indexOf("chrome-extension:")?void l.call(this,t,e):void(b.initialized?f.apply(this,[t,e]):d(1048576,function(n,r){return r?void f.apply(this,[t,e]):void e(null)},this))},p=function(t,e){var n=b.fs.root.createReader(),r=[];n.readEntries(function(n){if(n.length)for(var i,o=0;i=n[o];++o)i.isFile&&r.push([i.name,i.toURL?i.toURL():i.toURI()]);b.files=r,t&&t.apply(e,[r])},function(){t&&t.apply(e,[null])})},g=function(t,e,r){webkitRequestFileSystem(PERSISTENT,t,function(n){b.fs=n,b.quota=t,p(function(){b.initialized=!0,e.apply(r,[t,n])},r)},n)},d=function(t,e,r){return navigator.webkitPersistentStorage?void navigator.webkitPersistentStorage.requestQuota(t,function(t){g(t,e,r)},n):void e.apply(r,[0,null])},v=t("./xhr_read").read,m=t("./xhr_read").xhr_read,b={read:v,readdir:p,open:h,close:o,fstatSync:s,fstat:a,getFileSize:r,xhr_read:m,xhr_getFileSize:i};e.exports=b},{"./xhr_read":37}],32:[function(t,e){e.exports={open:t("./kdb")}},{"./kdb":33}],33:[function(t,e){var n=null;try{var r=t("react-native"),i=r.Platform.OS;n=t("android"==i?"./kdbfs_rn_android":"./kdbfs_ios")}catch(o){n=t("./kdbfs")}var s={uint8:"1",int32:"4",utf8:"8",ucs2:"2",bool:"^",blob:"&",utf8arr:"*",ucs2arr:"@",uint8arr:"!",int32arr:"$",vint:"`",pint:"~",array:"",object:""},a=0,u=function(t,e){console.log(t,e,"bytes")};a&&(readLog=u);var c="￿",l=function(t,e,r){const i=function(t){const e=t.handle&&t.handle.url&&0==t.handle.url.indexOf("http://127.0.0.1"),n=t.handle&&t.handle.file;return!(!e&&!n)};var o=function(){if("undefined"!=typeof Window&&this===Window)throw"should add new before calling Create";"function"==typeof e&&(r=e,e={});var o=this;new n(t,e,function(t){return t?(setTimeout(function(){r(t,0)},0),null):(o.size=this.size,o.fs=this,o.local=i(this),o.fs&&(o.url=o.fs.handle.url),P.call(o),void 0)})},u=null,l={},f={},h=function(t,e,n,r){var i=this;this.fs.readBuf_packedint(t.cur,e,n,!0,function(e){t.cur+=e.adv,r.call(i,e.data,t.key)})},p=function(t,e){var n=this;h.apply(this,[t,6,1,function(r){e.call(n,r[0],t.key)}])},g=function(t,e,n,r){var i=this;this.fs.readBuf_packedint(t.cur,e,n,!1,function(e){t.cur+=e.adv,r.call(i,e.data,t.key)})},d=function(t,e){var n=this,r=0;this.fs.readUI8(t.cur,function(i){var o=4294967296*i;t.cur++,n.fs.readUI32(t.cur,function(i){t.cur+=4,r=t.cur,o+=i,t.cur+=o,p.apply(n,[t,function(i){h.apply(n,[t,6*i,i,function(t){e({count:i,sz:t,offset:r})}])}])})})},v=function(t,e,n){var r=this;d.apply(this,[t,function(e){var i=[],o=t.cur;if(t.cur=e.offset,t.lazy)for(var s=e.offset,a=0;a<e.sz.length;a++){var u=e.sz[a];i[i.length]=c+s.toString(16)+c+u.toString(16),s+=u}else{for(var l=[],a=0;a<e.count;a++)l.push(function(e){return function(n){"object"==typeof n&&n.__empty||i.push(n),t.blocksize=e,A.apply(r,[t,l.shift()])}}(e.sz[a]));l.push(function(e){i.push(e),t.cur=o,n.apply(r,[i])})}t.lazy?n.call(r,i,t.key):l.shift()({__empty:!0})}])},m=function(t,e,n){var r=this,i=t.cur;d.apply(this,[t,function(o){t.blocksize=e-t.cur+i,A.apply(r,[t,function(e){t.keys&&e.map(function(e){t.keys.push(e)});var i={},s=t.cur;if(t.cur=o.offset,t.lazy)for(var u=o.offset,l=0;l<o.sz.length;l++)i[e[l]]=c+u.toString(16)+c+o.sz[l].toString(16),u+=o.sz[l];else{for(var f=[],l=0;l<o.count;l++)f.push(function(e,n){return function(o){"object"==typeof o&&o.__empty||(i[n]=o),t.blocksize=e,a&&readLog("key",n),setTimeout(function(){A.apply(r,[t,f.shift()])},0)}}(o.sz[l],e[l-1]));f.push(function(o){i[e[e.length-1]]=o,t.cur=s,n.apply(r,[i,t.key])})}t.lazy?n.apply(r,[i],t.key):f.shift()({__empty:!0})}])}])},b=function(t,e,n,r){var i=this;this.fs.readStringArray(t.cur,e,n,function(n){t.cur+=e,r.apply(i,[n],t.key)})},y=function(t,e,n,r){var i=this;p.apply(this,[t,function(e){i.fs.readFixedArray(t.cur,e,n,function(o){t.cur+=e*n,r.apply(i,[o],t.key)})}])},E=function(t){var e=this.fs.readBuf(this.cur,t);return this.cur+=t,e},k=function(t,e,n){var r=t.blocksize||this.fs.size;t.cur+=this.fs.signature_size;var i=r-this.fs.signature_size;if(e===s.int32)t.cur+=4,this.fs.readI32(t.cur-4,n);else if(e===s.uint8)t.cur++,this.fs.readUI8(t.cur-1,n);else if(e===s.utf8){var o=t.cur;t.cur+=i,this.fs.readString(o,i,"utf8",n)}else if(e===s.ucs2){var o=t.cur;t.cur+=i,this.fs.readString(o,i,"ucs2",n)}else e===s.bool?(t.cur++,this.fs.readUI8(t.cur-1,function(t){n(!!t)})):e===s.blob?E(i,n):e===s.vint?h.apply(this,[t,i,i,n]):e===s.pint?g.apply(this,[t,i,i,n]):e===s.utf8arr?b.apply(this,[t,i,"utf8",n]):e===s.ucs2arr?b.apply(this,[t,i,"ucs2",n]):e===s.uint8arr?y.apply(this,[t,i,1,n]):e===s.int32arr?y.apply(this,[t,i,4,n]):e===s.array?v.apply(this,[t,i,n]):e===s.object?m.apply(this,[t,i,n]):(console.error("unsupported type",e,t),n.apply(this,[null]))},A=function(t,e){t=t||{},t.cur=t.cur||0;var n=this;return this.fs.readSignature(t.cur,function(r){k.apply(n,[t,r,e])}),this},T=function(t){u?t.call(this):A.apply(this,[{cur:0,lazy:!0},function(e){u=e,t.call(this)}])},F=function(t,e){if(0==t.length)return!0;var n=t.pop(),r=this;x.apply(this,[t,!1,function(){if(!t.join(c))return!!l[n];var i=l[t.join(c)];t.push(n),i?e.apply(r,[i.indexOf(n)>-1]):e.apply(r,[!1])}])},w=function(t){if(!u)return void 0;for(var e=u,n=0;n<t.length;n++){if("object"!=typeof e)return null;var r=e[t[n]];if("undefined"==typeof r)return null;e=r}return e},x=function(t,e,n,r){"undefined"==typeof t&&(t=[]),"string"==typeof t&&(t=[t]),"function"==typeof e&&(r=n,n=e,e={}),e=e||{};var r=r||this,i=this;const o=w(t);return(null!==o&&"undefined"!=typeof o||"function"!=typeof n)&&("string"==typeof o&&o[0]!==c||"string"!=typeof o)?(!e.syncable&&n&&n.call(r,o),o):void T.apply(this,[function(){var o=u;if(0==t.length)return void(e.address?n.apply(r,[[0,i.fs.size]]):n.apply(r,[Object.keys(u)]));for(var s="",a=[],h={},p=null,g="",d=0;d<t.length;d++){var v=function(u,d){return function(v){if("object"==typeof v&&v.__empty?(v=o[u],p=v):("string"==typeof o[g]&&o[g][0]==c&&(o[g]={}),o[g]=v,o=o[g],p=v[u],l[s]=e.keys),"undefined"==typeof p)a=null,n.apply(r,[p]);else if(parseInt(d)&&(s+=c),s+=u,"string"==typeof p&&p[0]==c){var m=p.substring(1).split(c).map(function(t){return parseInt(t,16)}),b=m[0],y=m[1];h.lazy=!e.recursive||d<t.length-1,h.blocksize=y,h.cur=b,h.keys=[],h.key=u,g=u,e.address&&1==a.length?(f[s]=[b,y],a.shift()(null,f[s])):A.apply(i,[h,a.shift()])}else e.address&&1==a.length?a.shift()(null,f[s]):a.shift().call(i,p,u)}}(t[d],d);a.push(v)}0==a.length?n.apply(r,[o]):(a.push(function(i,a){if(e.address)n.apply(r,[a]);else{var u=t[t.length-1];o[u]=i,l[s]=e.keys,n&&n.apply(r,[i])}}),a.shift()({__empty:!0}))}])},C=function(t,e){t||(t=[]);var n=this;x.apply(this,[t,!1,function(){t&&t.length?e.apply(n,[l[t.join(c)]]):e.apply(n,[Object.keys(u)])}])},P=function(){this.load=A,this.cache=function(){return u},this.key=function(){return l},this.free=function(){u=null,l=null,this.fs.free()},this.setCache=function(t){u=t},this.keys=C,this.get=x,this.exists=F,this.DT=s;var t=this,e=0;r&&setTimeout(function(){r(e,t)},0)};return o.call(this)};l.datatypes=s,e&&(e.exports=l)},{"./kdbfs":34,"./kdbfs_ios":35,"./kdbfs_rn_android":36,"react-native":void 0}],34:[function(t,e){var n,r,i;const o=function(){n=t("./html5read"),r=function(){return""},i=!0};try{const s="fs",a="buffer";n=t(s),r=t(a).Buffer}catch(u){o()}"undefined"!=typeof window&&window.node_modules&&window.node_modules.fs?(n=window.node_modules.fs,r=window.node_modules.buffer.Buffer,console.log("fs by node webkit")):n.existsSync||o();var c=1,l=0,f=function(){},h=function(t,e){console.log(t,e)};l&&(f=h);

var p=function(t,e,n){e=e||t.length;var r=[],i=0,o=0;do{var s=1;do o+=t[i]%128*s,s=128*s;while(t[++i]%256>=128);r.push(o),n&&(o=0),e--}while(i<t.length&&e);return{data:r,adv:i}},g=function(t,e,o){e=e||{};var s=this,a=function(){if(i){if(e.webStorage);else if(window){var r=window.location.href.lastIndexOf("/"),a=window.location.href.substr(0,r+1);0==window.location.protocol.indexOf("http")?"string"==typeof t&&"blob:"!==t.substr(0,5)&&(t.indexOf("/")>-1&&(a=window.location.origin+"/"),-1==t.indexOf("http")&&(t=a+t)):0==window.location.protocol.indexOf("chrome-extension:")&&(-1==t.indexOf("chrome-extension:"),t=a+t)}n.open(t,function(e){return e?(s.handle=e,s.html5fs=!0,u.call(s),s.opened=!0,void 0):void o("file not found:"+t)})}else{if(!n.existsSync||!n.existsSync(t))return o("file not found:"+t),null;this.handle=n.openSync(t,"r"),this.opened=!0,u.call(this)}return this},u=function(){var e=this;if(this.readSignature=l,this.readI32=E,this.readUI32=y,this.readUI8=k,this.readBuf=A,this.readBuf_packedint=T,this.readFixedArray=w,this.readString=d,this.readStringArray=b,this.signature_size=c,this.free=x,this.read=n.read,i){var r=t;this.handle.file?(this.size=this.handle.file.size,this.read=n.xhr_read,o.call(this)):this.handle.blobsize?(this.read=n.xhr_read,this.size=this.handle.blobsize,o.call(this)):n&&n.fs&&n.fs.root?(0==t.indexOf("filesystem:")&&(r=t.substr(t.lastIndexOf("/"))),n.fs.root.getFile(r,{},function(t){t.getMetadata(function(t){e.size=t.size,o&&setTimeout(function(){o.call(e)}.bind(e),0)})})):this.handle.url&&n.xhr_getFileSize(this.handle.url,function(t,r){t?o&&o.call(e,"cannot open file"):(e.size=r,e.read=n.xhr_read,e.handle.filesize=r,o&&setTimeout(o.bind(e),0))})}else{var s=n.fstatSync(this.handle);this.stat=s,this.size=s.size,o&&setTimeout(o.bind(this,0),0)}},l=function(t,e){var n=r.alloc?r.alloc(c):new r(c),o=this;this.read(this.handle,n,0,c,t,function(t,n,r){if(i)var s=String.fromCharCode(new Uint8Array(r)[0]);else var s=r.toString("utf8",0,c);f("signature",s.charCodeAt(0)),e.apply(o,[s])})},h=function(t){for(var e="",n=0,r=0,i=0,o=0,n=0;n<t.length&&!(t.charCodeAt(n)>127);n++);if(n>=t.length)return t;for(;n<t.length;)r=t.charCodeAt(n),128>r?(e+=t[n],n++):r>191&&224>r?(i=t.charCodeAt(n+1),e+=String.fromCharCode((31&r)<<6|63&i),n+=2):(i=t.charCodeAt(n+1),o=t.charCodeAt(n+2),e+=String.fromCharCode((15&r)<<12|(63&i)<<6|63&o),n+=3);return e},g=function(t){if("undefined"!=typeof TextDecoder){var e=new TextDecoder("utf-16le");return e.decode(t)}return String.fromCharCode.apply(null,new Uint16Array(t))},d=function(t,e,n,o){n=n||"utf8";var s=new r(e),a=this;this.read(this.handle,s,0,e,t,function(t,e,r){if(f("string",e),i){if("utf8"==n)var s=h(String.fromCharCode.apply(null,new Uint8Array(r)));else var s=g(r);o.apply(a,[s])}else o.apply(a,[r.toString(n)])})},m=function(t,e){if("undefined"!=typeof TextDecoder){"ucs2"===e&&(e="utf-16le");var n=new TextDecoder(e);return n.decode(t).split("\x00")}if("utf8"==e)var r=new Uint8Array(t);else var r=new Uint16Array(t);for(var i=0,o=[],s=[],a="";i<r.length;)r[i]?o[o.length]=r[i]:(a=String.fromCharCode.apply(null,o),s[s.length]="utf8"==e?h(a):a,o=[]),i++;return a=String.fromCharCode.apply(null,o),s[s.length]="utf8"==e?h(a):a,s},b=function(t,e,n,o){var s=this,a=null;if(0==e)return[];n=n||"utf8";var u=new r(e);this.read(this.handle,u,0,e,t,function(t,e,r){i?(f("stringArray",r.byteLength),a="utf8"==n?m(r,"utf8"):m(r,"ucs2")):(f("stringArray",r.length),a=r.toString(n).split("\x00")),o.apply(s,[a])})},y=function(t,e){var n=new r(4),o=this;this.read(this.handle,n,0,4,t,function(n,r,s){if(i){var a=new DataView(s).getUint32(0,!1);f("ui32",a+" at"+t),e(a)}else e.apply(o,[s.readInt32BE(0)])})},E=function(t,e){var n=new r(4),o=this;this.read(this.handle,n,0,4,t,function(t,n,r){if(i){var s=new DataView(r).getInt32(0,!1);f("i32",s),e(s)}else e.apply(o,[r.readInt32BE(0)])})},k=function(t,e){var n=new r(1),o=this;this.read(this.handle,n,0,1,t,function(t,n,r){if(i){var s=new Uint8Array(r)[0];f("ui8",s),e(s)}else e.apply(o,[r.readUInt8(0)])})},A=function(t,e,n){var i=this,o=new r(e);this.read(this.handle,o,0,e,t,function(r,o,s){f("buf pos "+t+" len "+o+" blocksize "+e);var a=new Uint8Array(s);n.apply(i,[a])})},T=function(t,e,n,r,i){var o=this;A.apply(this,[t,e,function(t){i.apply(o,[p(t,n,r)])}])},F=function(t,e,n,r){var i=null;if(1===n)i="getUint8";else if(2===n)i="getUint16";else{if(4!==n)throw"unsupported integer size";i="getUint32"}this.read(this.handle,null,0,n*e,t,function(t,e,o){f("fix array",e);var a=[];if(1==n)a=new Uint8Array(o);else for(var u=0;e/n>u;u++)a.push(v=new DataView(o)[i](u,!1));r.apply(s,[a])})},w=function(t,e,n,o){var s=null,a=this;if(n*e>this.size&&this.size)return void console.log("array size exceed file size",this.size);if(i)return F.apply(this,[t,e,n,o]);var u=new r(n*e);if(1===n)s=u.readUInt8;else if(2===n)s=u.readUInt16BE;else{if(4!==n)throw"unsupported integer size";s=u.readUInt32BE}this.read(this.handle,u,0,n*e,t,function(t,e){f("fix array",e);for(var r=[],i=0;i<u.length/n;i++)r.push(s.apply(u,[i*n]));o.apply(a,[r])})},x=function(){n.closeSync&&n.closeSync(this.handle)};return a()};e.exports=g},{"./html5read":31}],35:[function(require,module,exports){"use strict";var kfs=require("react-native").NativeModules.KsanaFileSystem,verbose=0,async=!!kfs.async,readSignature=function(t,e){if(verbose&&ksanagap.log("read signature at "+t),async){var n=this;kfs.readUTF8String(this.handle,t,1,function(t){e.call(n,t)})}else{var r=kfs.readUTF8String(this.handle,t,1);verbose&&ksanagap.log(r+" "+r.charCodeAt(0)),e.apply(this,[r])}},readI32=function(t,e){if(async){var n=this;kfs.readInt32(this.handle,t,function(t){e.call(n,t)})}else{verbose&&ksanagap.log("read i32 at "+t);var r=kfs.readInt32(this.handle,t);verbose&&ksanagap.log(r),e.apply(this,[r])}},readUI32=function(t,e){if(async){var n=this;kfs.readUInt32(this.handle,t,function(t){e.call(n,t)})}else{verbose&&ksanagap.log("read ui32 at "+t);var r=kfs.readUInt32(this.handle,t);verbose&&ksanagap.log(r),e.apply(this,[r])}},readUI8=function(t,e){if(async){var n=this;kfs.readUInt8(this.handle,t,function(t){e.call(n,t)})}else{verbose&&ksanagap.log("read ui8 at "+t);var r=kfs.readUInt8(this.handle,t);verbose&&ksanagap.log(r),e.apply(this,[r])}},readBuf=function(t,e,n){if(async){var r=this;kfs.readBuf(this.handle,t,e,function(t){n.call(r,t)})}else{verbose&&ksanagap.log("read buffer at "+t);var i=kfs.readBuf(this.handle,t,e);verbose&&ksanagap.log("buffer length"+i.length),n.apply(this,[i])}},readBuf_packedint=function(pos,blocksize,count,reset,cb){if(async){var that=this;kfs.readBuf_packedint(this.handle,pos,blocksize,count,reset,function(buf){"string"==typeof buf.data&&(buf.data=eval("["+buf.data.substr(0,buf.data.length-1)+"]")),cb.call(that,buf)})}else{verbose&&ksanagap.log("read packed int fast, blocksize "+blocksize+" at "+pos);var t=new Date,buf=kfs.readBuf_packedint(this.handle,pos,blocksize,count,reset);verbose&&ksanagap.log("return from packedint, time"+(new Date-t)),"string"==typeof buf.data&&(buf.data=eval("["+buf.data.substr(0,buf.data.length-1)+"]")),verbose&&ksanagap.log("unpacked length"+buf.data.length+" time"+(new Date-t)),cb.apply(this,[buf])}},readString=function(t,e,n,r){verbose&&ksanagap.log("readstring at "+t+" blocksize "+e+" "+n);var i=new Date;if("ucs2"==n){if(async){var o=this;return void kfs.readULE16String(this.handle,t,e,function(t){r.call(o,t)})}var s=kfs.readULE16String(this.handle,t,e)}else{if(async){var o=this;return void kfs.readUTF8String(this.handle,t,e,function(t){r.call(o,t)})}var s=kfs.readUTF8String(this.handle,t,e)}verbose&&ksanagap.log(s+" time"+(new Date-i)),r.apply(this,[s])},readFixedArray=function(t,e,n,r){if(async){var i=this;kfs.readFixedArray(this.handle,t,e,n,function(t){r.call(i,t)})}else{verbose&&ksanagap.log("read fixed array at "+t);var o=new Date,s=kfs.readFixedArray(this.handle,t,e,n);verbose&&ksanagap.log("array length "+s.length+" time"+(new Date-o)),r.apply(this,[s])}},readStringArray=function(t,e,n,r){if(n=n||"utf8",async){var i=this;kfs.readStringArray(this.handle,t,e,n,function(t){"string"==typeof t&&(t=t.split("\x00")),r.call(i,t)})}else{verbose&&ksanagap.log("read string array at "+t);var o=new Date,s=kfs.readStringArray(this.handle,t,e,n);"string"==typeof s&&(s=s.split("\x00")),verbose&&ksanagap.log("string array length"+s.length+" time"+(new Date-o)),r.apply(this,[s])}},mergePostings=function(positions,cb){if(kfs.async)kfs.mergePostings(this.handle,positions,function(buf){"string"==typeof buf&&(buf=eval("["+buf.substr(0,buf.length-1)+"]")),cb(buf)});else{var buf=kfs.mergePostings(this.handle,positions,cb);"string"==typeof buf&&(buf=eval("["+buf.substr(0,buf.length-1)+"]")),cb(buf)}},free=function(){kfs.close(this.handle,function(){})},Open=function(t,e,n){e=e||{};var r=1,i=function(){if(this.readSignature=readSignature,this.readI32=readI32,this.readUI32=readUI32,this.readUI8=readUI8,this.readBuf=readBuf,this.readBuf_packedint=readBuf_packedint,this.readFixedArray=readFixedArray,this.readString=readString,this.readStringArray=readStringArray,this.signature_size=r,this.mergePostings=mergePostings,this.free=free,1==kfs.getFileSize.length)this.size=kfs.getFileSize(this.handle),n&&n.call(this);else{var t=this;kfs.getFileSize(this.handle,function(e){t.size=e,n&&n.call(t)})}};if(1==kfs.open.length)return this.handle=kfs.open(t),this.opened=!0,i.call(this),this;var o=this;this.async=!0,kfs.open(t,function(e){return e?(o.opened=!0,o.handle=e,void i.call(o)):void n.call(null,"File not file:"+t)})};module.exports=Open},{"react-native":void 0}],36:[function(t,e){var n=t("react-native").NativeModules.KsanaFileSystem,r=0,i=function(t,e){r&&console.debug("read signature"),n.readUTF8String(this.handle,t,1,function(t){r&&console.debug(t,t.charCodeAt(0)),e.apply(this,[t])})},o=function(t,e){r&&console.debug("read i32 at "+t),n.readInt32(this.handle,t,function(t){r&&console.debug(t),e.apply(this,[t])})},s=function(t,e){r&&console.debug("read ui32 at "+t),n.readUInt32(this.handle,t,function(t){r&&console.debug(t),e.apply(this,[t])})},a=function(t,e){r&&console.debug("read ui8 at "+t),n.readUInt8(this.handle,t,function(t){r&&console.debug(t),e.apply(this,[t])})},u=function(t,e,i){r&&console.debug("read buffer at "+t+" blocksize "+e),n.readBuf(this.handle,t,e,function(t){r&&console.debug("buffer length"+t.length),i.apply(this,[t])})},c=function(t,e,i,o,s){r&&console.debug("read packed int at "+t+" blocksize "+e+" count "+i),n.readBuf_packedint(this.handle,t,e,i,o,function(t){var e=parseInt(t),n=JSON.parse(t.substr(t.indexOf("[")));r&&console.debug("packedInt length "+n.length+" first item="+n[0]),s.apply(this,[{data:n,adv:e}])})},l=function(t,e,i,o){if(r&&console.debug("readstring at "+t+" blocksize "+e+" enc:"+i),"ucs2"==i)var s=n.readULE16String;else var s=n.readUTF8String;s(this.handle,t,e,function(t){r&&console.debug(t),o.apply(this,[t])})},f=function(t,e,i,o){r&&console.debug("read fixed array at "+t+" count "+e+" unitsize "+i),n.readFixedArray(this.handle,t,e,i,function(t){var e=JSON.parse(t);r&&console.debug("array length"+e.length),o.apply(this,[e])})},h=function(t,e,i,o){r&&console.log("read String array at "+t+" blocksize "+e+" enc "+i),i=i||"utf8",n.readStringArray(this.handle,t,e,i,function(t){r&&console.debug("read string array");var e=t.split("￿");r&&console.debug("array length"+e.length),o.apply(this,[e])})},p=function(t,e){n.mergePostings(this.handle,JSON.stringify(t),function(t){return e(t&&0!=t.length?JSON.parse(t):[])})},g=function(){n.close(this.handle,function(){})},d=function(t,e,d){e=e||{};var v=1,m=function(){this.readSignature=i,this.readI32=o,this.readUI32=s,this.readUI8=a,this.readBuf=u,this.readBuf_packedint=c,this.readFixedArray=f,this.readString=l,this.readStringArray=h,this.signature_size=v,this.mergePostings=p,this.free=g,n.getFileSize(this.handle,function(t){this.size=t}.bind(this)),r&&console.log("filesize  "+this.size),d&&d.call(this)};return n.open(t,function(e){return e?(this.handle=e,this.opened=!0,void m.call(this)):void d.call(null,"File not found:"+t)}.bind(this)),this};e.exports=d},{"react-native":void 0}],37:[function(t,e){var n={},r=65536,i=function(t,e,n){for(var r=e;n>=r;r++)if(!t[r])return!1;return!0},o=function(t,e,n){var i=Math.floor(e/r),o=Math.floor((e+n)/r);if(i===o){var s=e+n-i*r;return s>=t[i].byteLength&&(s=t[i].byteLength),t[i].slice(e-i*r,s)}for(var a=new Uint8Array(n),u=0,c=i;o>=c;c++){var l;if(c==i)l=new Uint8Array(t[i].slice(e-i*r,t[i].byteLength)),a.set(l,0),u=t[i].byteLength-(e-i*r);else if(c==o){var s=e+n-o*r;s>=t[o].byteLength&&(s=t[o].byteLength),l=new Uint8Array(t[o].slice(0,s)),a.set(l,u)}else l=new Uint8Array(t[c]),a.set(l,u),u+=t[c].byteLength}return a.buffer},s=function(t,e,s,u,c,l){n[t.url]||(n[t.url]=[]);var f=n[t.url],h=Math.floor(c/r),p=Math.floor((c+u)/r);if(i(f,h,p)){var g=o(f,c,u);return void l(0,g.byteLength,g)}a(t,null,0,(p-h+1)*r,h*r,function(t,e,n){for(var i=0;p-h>=i;i++){var s=(i+1)*r;s>=n.byteLength&&(s=n.byteLength),f[i+h]=n.slice(i*r,s)}var a=o(f,c,u);l(0,a.byteLength,a)})},a=function(t,e,n,r,i,o){var s=new XMLHttpRequest,a=t.url;-1==a.indexOf("blob:")&&(a+="?"+(new Date).getTime()),s.open("GET",a,!0);var u=[i,r+i-1];u[1]+1>t.filesize&&(u[1]=t.filesize-1),s.setRequestHeader("Range","bytes="+u[0]+"-"+u[1]),s.responseType="arraybuffer",s.onload=function(){var t=this;setTimeout(function(){o(0,t.response.byteLength,t.response)},0)},s.send()};e.exports={read:a,xhr_read:s}},{}],38:[function(t,e){const n=t("ksana-corpus/bsearch"),r=50,i=1.1,o=50,s=1.5,a=t("./utils").postingToKPos,u=function(t,e,r,i){var o=[],s={};return r.forEach(function(i,a){const u=n(t,i);if(u>-1&&(s[i]||(o.push([u,e[u],i]),s[i]=!0)),a){const c=r[a-1]+i,l=n(t,c);l>-1&&t[l]==c&&(s[c]||(o.push([l,e[l],c]),s[c]=!0))}}),o=o.filter(function(t){return-1!==t[0]}),o.length>i&&(o.length=i),o},c=function(t){var e=[].concat.apply([],t);return e.sort(function(t,e){return t-e})},l=function(t,e,n,r){for(var i=[],o=(new Date,0);o<t.length;o++){for(var s=1,a=0;e>s&&t[o+s]-t[o]<e;)a++,s++;a>=n&&i.push([t[o],a])}return i.sort(function(t,e){return e[1]-t[1]}),i.length>r&&(i.length=r),i},f=function(t,e,r,o){for(var s=0;s<t.length;s++){var a=0,u=0;const c=t[s][0]+e,l=Math.pow(i,r.length)+o.reduce(function(t,e){return t+e},0);for(var f=0;f<r.length;f++){const h=r[f],p=n(h,c,!0);c-h[p-1]<=e&&(a++,u+=o[f])}var g=(Math.pow(i,a)+u)/l;t[s][1]=g}return t},h=function(t){const e=Math.max.apply(null,t.map(function(t){return t[1]}));return t.map(function(t){return[t[0],Math.sqrt(Math.sqrt(t[1]/e))]})},p=function(t,e){new Date;const n=t.reduce(function(t,e){return t+e.length},0),i=n/t.length,o=c(t);if(e=e||{},!e.postingweight){e.postingweight=[];for(var s=0;s<t.length;s++)e.postingweight[s]=Math.log(2+Math.log(2+i/t[s].length))}const a=e.maxcandidate||r,u=e.windowsize||t.length,p=e.threshold||t.length/2;var g=l(o,u,p,a);return g=t.length>1?f(g,u,t,e.postingweight):h(g),g.sort(function(t,e){return e[1]-t[1]}),g},g=function(t,e,n,r){const i=t.tokenizer.tokenize(e),c=i.map(function(t){return t[0]});var l={},f=new Date,h=f;const g=n.maxtoken||o;t.get([["inverted","tokens"],["inverted","posting_length"]],function(e){const i=e[0],o=e[1];var d=u(i,o,c,g);const v=d.reduce(function(t,e){return t+e[1]},0),m=v/d.length,b=Math.floor(d.length/2),y=Math.floor(c.length*(n.windowsize||s));d.sort(function(t,e){return e[1]-t[1]});for(var E=0;E<d.length&&!(d[0][1]<2*m);E++)d.shift();const k=d.map(function(t){return["inverted","postings",t[0]]}),A=d.map(function(t){return t[2]}).join(" ");t.get(k,function(e){l.loadposting=new Date-h,h=new Date;var i={maxcandidate:n.maxcandidate,timer:l,windowsize:y,threshold:b};const o=p(e,i);l.reduceposting=new Date-f;const s=e.map(function(t,e){return{postings:t,lengths:A[e].length,phrase:A[e]}});n.kpos?(h=new Date,a(t,o,function(t){l.tokpos=new Date-h,r&&r({matches:t,phrasepostings:s,terms:A,timer:l,unit:"kpos"})})):r&&r({matches:o,terms:A,phrasepostings:s,timer:l})})})};e.exports={convolutionSearch:g,reducePostings:p,postingToKPos:a}},{"./utils":46,"ksana-corpus/bsearch":48}],39:[function(t,e){const n=t("./plist"),r=(t("ksana-corpus").bsearch,function(t,e,r){t.fromTPos(e.tpos,{line:e.line||1},function(i){if(!i)return void(r&&r(null));const o=i.linekrange,s=(i.kpos,i.linetpos);t.getText(o,function(i){for(var a=[],u=0;u<i.length;u++){var c=[];const l=t.parseRange(o[u]).start,f=t.layoutText(i[u],l,null,s[u]);e.phrasepostings&&e.phrasepostings.forEach(function(e){var r=s[u][0];const i=s[u][s[u].length-1];for(;!r&&u<s.length;)r=s[++u][0];const o=n.trim(e.postings,r,i),a=t.fromTPos(o,{linetext:f.lines,linetpos:f.linetpos}).kpos,l=o.map(function(t,n){return t+(e.lengths[n]||e.lengths)}),h=t.fromTPos(l,{linetext:f.lines,linetpos:f.linetpos}).kpos;c.push({phrase:e.phrase,hits:a,hitsend:h,lengths:e.lengths})}),a.push({rawtext:i[u],text:f.lines.join("\n"),linebreaks:f.linebreaks,linetpos:f.linetpos,phrasehits:c})}r(a)})})});e.exports={fetchExcerpts:r}},{"./plist":44,"ksana-corpus":58}],40:[function(t,e){const n=t("ksana-corpus").bsearch,r=t("./plist"),i=function(t,e){return r.groupStat(t,e)},o=function(t,e,r){if(!t)return[];if(!r)return e;for(var i=e.slice(),o=0;o<r.length;o++)if(r[o]){const s=t.groupTRange(o),a=n(i,s[0],!0),u=n(i,s[1],!0);i.splice(a,u-a)}return i};e.exports={groupStat:i,filterMatch:o}},{"./plist":44,"ksana-corpus":58}],41:[function(t,e){const n=t("./plist"),r=t("ksana-corpus/bsearch"),i=function(t,e){for(var r=[],i=0;i<t.length;i++)postings=t[i].postings,postings&&(r=r.concat(n.trim(postings,e.tstart,e.tend)));return r},o=function(t,e){const o=t.searchresult;if(!o||!o.phrasepostings)return void e([]);const s=t.cor,a=t.linebreaks,u=(t.pagebreaks,t.lines),c=t.article;var l=[];if(!o.phrasepostings)return void e(null);const f=i(o.phrasepostings,c);s.fromTPos(f,{},function(t){return t&&t.kpos?(o.phrasepostings.forEach(function(t,e){if(t.postings){const i=n.trim(t.postings,c.tstart,c.tend),o=s.fromTPos(i,{});for(var f,h=[],p=0;p<o.kpos.length;p++){var g=r(a,o.kpos[p]);-1==g&&(g=a.length-1),0==p&&(f=a[g]),h.push(u[g])}const d=s.fromTPos(i,{linetext:h,linetpos:o.linetpos}).kpos,v=i.map(function(e){return e+(t.lengths[p]||t.lengths)}),m=s.fromTPos(v,{});for(var f,b=[],p=0;p<m.kpos.length;p++){var y=r(a,m.kpos[p]);-1==y&&(y=a.length-1),0==p&&(f=a[y]),b.push(u[y])}const E=s.fromTPos(v,{linetext:b,linetpos:m.linetpos}).kpos;l.push({phrase:t.phrase,hits:d,hitsend:E,lengths:t.lengths,idx:e})}}),void e(l)):void e(null)})};e.exports={getArticleHits:o}},{"./plist":44,"ksana-corpus/bsearch":48}],42:[function(t,e){const n=(t("ksana-corpus").bsearch,t("./convolution").convolutionSearch),r=t("./strstr").indexOf,i=(t("./convolution").reducePostings,t("./utils").postingToKPos,t("./hits").getArticleHits),o=t("./phrasesearch"),s=t("./plist"),a=t("./excerpt"),u=t("./grouping"),c=function(t){const e=t.split(/(".+?")/g);for(var n=[],r=0;r<e.length;r++){var i=e[r].replace(/[ \+!]+/g," ");'"'==i[0]?n.push(i.substr(1,i.length-2)):n=n.concat(i.split(" "))}return n=n.filter(function(t){return t.trim().length})},l=function(t,e){var n=c(e);return n},f=function(t,e){const n=t.tokenizer.TokenTypes;var r=t.tokenizer.tokenize(e);for(const i=n.PUNC;r.length&&r[0]&&r[0][2]==i;)r.shift();for(;r.length&&r[r.length-1]&&r[r.length-1][2]==i;)r.pop();const s=r.filter(function(t){return t[2]==i}).length;return s||r.length>=15?o.fuzzyPhrase:o.simplePhrase},h=function(t,e,n,r){"function"==typeof n&&(r=n);const i=l(t,e);for(var o=[],a=[],u=[],c=new Date,h=c,p={},g=0;g<i.length;g++){const d=f(t,i[g]);a.push(function(e,n){return function(r){"object"==typeof r&&r.__empty||u.push(r),e(t,n,a.shift())}}(d,i[g]))}a.push(function(t){if(p.postings=new Date-h,h=new Date,t.__empty)return void r({matches:[],count:0,phrasepostings:[],timer:{}});if(t.fuzzy)return void r(t);u.push(t);if(u.length>1){const e=u.map(function(t){return t.postings});o=s.plmerge(e,100),count=o.length}else u.length&&u[0].postings?(count=u[0].postings.length,o=u[0].postings):count=0;p.reduce=new Date-h,h=new Date,r({matches:o,count:count,phrasepostings:u,timer:p})}),a.shift()({__empty:!0})};e.exports={search:h,convolutionSearch:n,breakIntoPhrases:c,excerpt:a,strstr:r,groupStat:u.groupStat,filterMatch:u.filterMatch,getArticleHits:i}},{"./convolution":38,"./excerpt":39,"./grouping":40,"./hits":41,"./phrasesearch":43,"./plist":44,"./strstr":45,"./utils":46,"ksana-corpus":58}],43:[function(t,e){const n=t("./convolution").convolutionSearch,r=t("./plist"),i=t("ksana-corpus/diacritics").normalize,o=function(t,e,n){var r=t.expandVariant(e),i=t.expandVariant(n),o=[];r==e&&(r=[e]),i==n&&(i=[n]);for(var s=0;s<r.length;s++)for(var a=0;a<i.length;a++)o.push(r[s]+i[a]);return o};var s=function(t,e){const n=t.tokenizer.TokenTypes,s=n.PUNC,a=n.LATIN,u=n.SPACE;for(var c=t.get(["inverted","tokens"])||[],l=t.tokenizer.tokenize(e);l.length&&l[0]&&l[0][2]==s;)l.shift();for(;l.length&&l[l.length-1]&&l[l.length-1][2]==s;)l.pop();for(var f=0;f<l.length;f++)l[f][2]===a&&(l[f][0]=i(l[f][0]).toLowerCase());l=l.filter(function(t){return t[2]!==s&&t[2]!==u});for(var h=[],p=[],g=0,d=function(e){var n=t.expandVariant(e);n instanceof Array&&(n=n.filter(function(t){const e=r.indexOfSorted(c,t);return e>-1&&c[e]==t}),1==n.length&&(n=n[0])),h.push(n),p.push(1)};g+1<l.length;){var v=l[g][0],m=l[g+1][0];const b=o(t,v,m),y=[];for(var E=0;E<b.length;E++){var f=r.indexOfSorted(c,b[E]);c[f]===b[E]&&y.push(b[E])}y.length?(h.push(1==y.length?y[0]:y),p.push(2),g++):d(v),g++}for(var k=p.reduce(function(t,e){return t+e},0);k<l.length;)v=l[g][0],d(v),g++,k++;return{tokens:h,lengths:p,tokenlength:l.length}};var a=function(t,e){"string"==typeof e&&(e=[e]);const n=t.get(["inverted","tokens"]);for(var i=[],o=0;o<e.length;o++){const s=r.indexOfSorted(n,e[o]);s>-1&&n[s]==e[o]&&i.push(s)}return i.map(function(t){return["inverted","postings",t]})};const u=function(t,e,n){var i=[];const o=[];for(var s=0;s<e.length;s++){const u=e[s],c=a(t,u);if(1==c.length)o.push([u,1]),i.push(c[0]);else{const l=t.cachedPostings[u];l?o.push([u,l]):(o.push([u,c.length]),i=i.concat(c))}}t.get(i,function(e){for(var i=0,s=0,s=0;s<o.length;s++){const a=o[s][1];if(!(a instanceof Array)){const u=[];for(var c=0;a>c;c++)u.push(e[i]),i++;const l=r.combine(u),f=o[s][0];u.length>1&&(t.cachedPostings[f.join(",")]=l),o[s][1]=l}}const h=o.map(function(t){return t[0]}),p=o.map(function(t){return t[1]});n(h,p)})},c=function(t,e,n){const i=s(t,e.trim());if(t.mergePostings){var o=a(t,i.tokens);return void nativeMergePosting(t,o,n)}u(t,i.tokens,function(o,s){for(var a=s[0],u=i.lengths[0],c=1;c<s.length;c++){var l=s[c];a=r.pland(a,l,u),u+=i.lengths[c]}t.cachedPostings[e]=a,n({phrase:e,postings:a,lengths:i.tokenlength})})},l=function(t,e,r){e=e.replace(/[　 ]/g,""),n(t,e,{},function(t){const n=t.matches.map(function(t){return t[0]}),i=t.matches.map(function(t){return t[1]});r({scores:i,matches:n,phrasepostings:t.phrasepostings,count:t.matches.length,phrase:e,lengths:0,fuzzy:!0})})};e.exports={simplePhrase:c,fuzzyPhrase:l}},{"./convolution":38,"./plist":44,"ksana-corpus/diacritics":51}],44:[function(t,e){var n=function(t){var e=[],n=0,r=0;do{var i=0;do r+=(127&t[n])<<i,i+=7;while(128&t[++n]);e[e.length]=r}while(n<t.length);return e},r=function(t,e){if(t.length!=e.length+1)return null;for(var n=[],r=new Array(e.length),i=0;i<e.length;i++)r[i]=0;for(var i=1;i<t.length;i++){if(n.length>e[i-1])for(;n.length>e[i-1];)n.pop();n.push(i-1);for(var o=0;o<n.length;o++)r[n[o]]+=t[i]}return r},i=function(t,e){if(!e.length)return[t.length];for(var n=[],r=0;r<e.length;r++)n[r]=0;n[e.length]=0;for(var i=0,r=0;r<t.length&&i<e.length;){if(t[r]<=e[i])for(;i<e.length&&r<t.length&&t[r]<=e[i];)n[i]++,r++;i++}return n[e.length]=t.length-r,n},o=function(t,e){if(!e.length)return[t.length];for(var n=[],r=0;r<=e.length;r++)n[r]=[];for(var i=0,r=0;r<t.length&&i<e.length;){if(t[r]<e[i])for(;i<e.length&&r<t.length&&t[r]<e[i];){var o=0;i>0&&(o=e[i-1]),n[i].push(t[r++]-o)}i++}for(;r<t.length;)n[n.length-1].push(t[r++]-e[e.length-1]);return n},s=function(t,e){if(!t||!t.length)return[];if(!e||!e.length)return[t.length];for(var n=[],r=0;r<=e.length;r++)n[r]=[];for(var i=0,r=0;r<t.length&&i<e.length;){if(t[r]<e[i])for(;i<e.length&&r<t.length&&t[r]<e[i];){var o=0;i>0&&(o=e[i-1]),n[i].push(t[r++])}i++}for(;r<t.length;)n[n.length-1].push(t[r++]);return n},a=function(t,e,n,r){if(!t.length)return[{},{}];n=n||16;var i=Math.pow(2,n),o=0,s={},a={},u=0;do{var c=Math.floor(t[o]/i);s[c]||(s[c]=[],a[c]=[],u++),s[c].push(t[o]%i),a[c].push(e[o]),o++}while(o<t.length);return r&&(r.groupcount=u),[s,a]},u=function(t,e,n){if(!t.length)return{};e=e||16;var r=Math.pow(2,e),i=0,o={},s=0;do{var a=Math.floor(t[i]/r);o[a]||(o[a]=[],s++),o[a].push(t[i]%r),i++}while(i<t.length);return n&&(n.groupcount=s),o},c=function(t,e){for(var n=0,r=t.length-1;r>n;){var i=n+r>>1;t[i]<e?n=i+1:r=i}return n},l=function(t,e,n){n=n||{},n.max=n.max||1;var r=[];if(e.length<t.length)for(var i=0;i<e.length&&(k=c(t,e[i]),!(k>-1&&k<t.length&&t[k]==e[i]&&(r[r.length]=e[i],r.length>=n.max)));i++);else for(var i=0;i<t.length&&(k=c(e,t[i]),!(k>-1&&k<e.length&&e[k]==t[i]&&(r[r.length]=e[k],r.length>=n.max)));i++);return r},f=function(t,e,n,r){for(var i=[],o=0;o<t.length;){var s=c(e,t[o]+n),a=e[s]>=t[o]+n&&e[s]<=t[o]+r?s:-1;if(a>-1)i[i.length]=t[o],o++;else{if(s>=e.length)break;var u=c(t,e[s]-r);if(!(u>o))break;var a=e[s]>=t[o]+n&&e[s]<=t[o]+r?s:-1;a>-1&&(i[i.length]=t[u]),o=u}}return i},h=function(t,e,n,r){for(var i=[],o=0,s=0;o<t.length;){var a=c(e,t[o]-r);s=Math.abs(e[a]-t[o]);var u=s>=n&&r>=s?a:-1;if(u>-1)i[i.length]=t[o],o++;else{if(a>=e.length)break;var l=c(t,e[a]-r);if(!(l>o))break;s=Math.abs(e[a]-t[l]);var u=s>=n&&r>=s?a:-1;u>-1?(i[i.length]=t[l],o=l+1):o=l}}return i},p=function(t,e,n,r){for(var i=[],o=0;o<t.length;){var s=c(e,t[o]+n),a=e[s]>=t[o]+n&&e[s]<=t[o]+r?s:-1;if(a>-1)o++;else{if(s>=e.length){i=i.concat(t.slice(o));break}var u=c(t,e[s]-r);if(!(u>o))break;i=i.concat(t.slice(o,u)),o=u}}return i},g=function(t,e,n){for(var r=[],i=0;i<t.length;){var o=c(e,t[i]+n),s=e[o]===t[i]+n?o:-1;if(s>-1)r.push(t[i]),i++;else{if(o>=e.length)break;var a=c(t,e[o]-n);if(!(a>i))break;s=e[o]===t[a]+n?o:-1,s>-1&&(r.push(t[a]),a++),i=a}}return r},d=function(t,e,n){for(var r=[],r=[],i=0;i<t.length;){var o=c(e,t[i]+n),s=e[o]===t[i]+n?o:-1;if(s>-1)i++;else{if(o>=e.length){r=r.concat(t.slice(i));break}var a=c(t,e[o]-n);if(!(a>i))break;r=r.concat(t.slice(i,a)),i=a}}return r},v=function(t,e,n){var r=[],i=0;if(t.length>e.length){var o=e;e=t,t=o,i=n,n=-n}for(var s=0;s<t.length;s++){var a=c(e,t[s]+n),o=e[a]===t[s]+n?a:-1;o>-1&&r.push(t[s]-i)}return r},m=function(t){if(1==t.length)return t[0];var e=[];for(var n in t)e=e.concat(t[n]);return e.sort(function(t,e){return t-e}),e},b=function(t){if(!t||!t.length)return[];for(var e={},n=[],r=0,i=t.length;i>r;++r)e.hasOwnProperty(t[r])||(n.push(t[r]),e[t[r]]=1);return n},y=function(t,e){var n=[];e=e||[];for(var r=0;r<t.length;r++){if(!t[r])return[];n=0===r?t[0]:"andnot"==e[r]?d(n,t[r],r):v(n,t[r],r)}return n},E=function(t,e,n,r){n=n||0,r=r||-1,-1==r&&(r=Math.pow(2,53));var i=0,o=j=0,s=0,a=[],u=[];if(!t)return{docs:[],freq:[]};for(;o<t.length&&j<e.length;)t[o]<e[j]?(i++,s=t[o],o++):(i&&s>=n&&r>s&&(a.push(j),u.push(i)),j++,i=0);if(i&&j<e.length&&s>=n&&r>s)a.push(j),u.push(i),i=0;else{for(;j==e.length&&o<t.length&&t[o]>=e[e.length-1];)o++,i++;s>=n&&r>s&&(a.push(j),u.push(i))}return{docs:a,freq:u}};const A=function(t,e){if(!t||!t.length)return[];if(t.length<2)return t[0];t.sort(function(t,e){return t.length-e.length});for(var n=t[0],r=1;r<t.length;)n=h(n,t[r],1,e),r++;return n};var T=function(t,e,n){var r=c(t,e),i=c(t,n);return e<t[i]&&n>t[i]&&i++,t.slice(r,i)};const F=function(t,e){if(!e.length)return[t.length];for(var n=[],r=0;r<=e.length;r++)n[r]=0;for(var i=0,r=0;r<t.length&&i<e.length;){if(t[r]<e[i])for(;i<e.length&&r<t.length&&t[r]<e[i];){var o=0;i>0&&(o=e[i-1]),n[i]++,r++}i++}for(;r<t.length;)n[n.length-1]++,r++;return n};var w={};w.unpack=n,w.plphrase=y,w.pland=v,w.plhead=l,w.plfollow2=f,w.plnotfollow2=p,w.plfollow=g,w.plnotfollow=d,w.unique=b,w.indexOfSorted=c,w.matchPosting=E,w.trim=T,w.groupbyslot=u,w.groupbyblock2=a,w.countbyposting=i,w.groupbyposting=o,w.groupbyposting2=s,w.groupStat=F,w.groupsum=r,w.combine=m,w.plmerge=A,e.exports=w},{}],45:[function(t,e){const n=1.3,r=function(t,e,n,r,i){for(var o=0,s=[],a=0;r>a;a++){var u=t[a];i&&(u=u[0]),e[u]&&o++}for(var a=r;a<t.length;a++){var c=t[a],l=t[a-r];if(i&&(c=c[0],l=l[0]),e[c]&&o++,a-r>=0&&e[l]&&o--,!(n>o)){var f=a-r;0>f&&(f=0);const h=s[s.length-1];h&&f-h[0]<r?o>h[1]&&(s[s.length-1][0]=f,s[s.length-1][1]=o):s.push([f,o])}}if(!s.length)return s;s.sort(function(t,e){return e[1]-t[1]});const p=s[0][1];for(var a=1;a<s.length&&!(p>1.1*s[a][1]);a++);return s.slice(0,a)},i=function(t,e,n,r){const i=[];for(var o=0;o<t.length;o++){const s=t[o];for(var a=s[0]-1,u=s[0]+r+1;!n[e[a][0]]&&a;)a++;for(;!n[e[u][0]]&&u;)u--;i.push([e[a][2],e[u][2]+1,s[1]])}return i},o=function(t,e,n,r){const i=[];for(var o=0;o<t.length;o++){const s=t[o];for(var a=s[0]-1,u=s[0]+r+1;!n[e[a]]&&a;)a++;for(;!n[e[u]]&&u;)u--;i.push([a,u+1,s[1]])}return i},s=function(t,e,n){for(var r=0;r<t.length;r++){const i=t[r],o=i[0],s=i[1],a=e.substring(o,s);var u=0;for(var c in n){const l=c.charCodeAt(0);13312>l||l>40959||-1===a.indexOf(c)&&u--}u&&(t[r][2]+=u)}return t.sort(function(t,e){return e[2]-t[2]})},a=function(t,e,a){a=a||{};const u={};var c,l;a.tokenizer?(l=a.tokenizer.tokenize(t),c=a.tokenizer.tokenize(e)):(l=t,c=e.split(""));const f=a.win_expand||n;c.forEach(function(t){u[t[0]]=!0});const h=Math.floor(c.length*f)+1,p=Math.floor(c.length/2);var g=r(l,u,p,h,a.tokenizer);const d=a.tokenizer?i:o;var v=d(g,l,u,h);return v=s(v,t,u,a.tokenizer)};e.exports={indexOf:a}},{}],46:[function(t,e){const n=function(t,e,n){var r={},i=[],o=t.map(function(t,n){return[e[n],t[1]]});o.forEach(function(t){const e=t[0];r[e]||(r[e]=0),t[1]>r[e]&&(r[e]=t[1])});for(var s in r)i.push([parseInt(s,10),r[s]]);return n||i.sort(function(t,e){return e[1]-t[1]}),i},r=function(t,e,r){var i=e,o=e,s=!1;"number"!=typeof o[0]?o=e.map(function(t){return t[0]}):(i=e.map(function(t){return[t,1]}),s=!0),t.fromTPos(o,function(t){const e=n(i,t,s);r(e)})};e.exports={postingToKPos:r}},{}],47:[function(t,e){const n=t("./ksanapos"),r=t("./bsearch"),i=function(t){const e=this.get(["inverted","article2tpos"]);var n=0,r=0;return e&&t>=0&&t<=e.length&&(n=e[t],r=e[t+1],n&&!r&&(r=this.meta.endtpos)),{start:n,end:r}},o=function(t){var e=t;const o=this.addressPattern;"string"==typeof t&&(e=n.parse(t,o));const s=n.breakRange(e,o),u=this.get(["gfields","article","pos"]),c=this.get(["gfields","article","value"]);if(!u)return null;var l=r(u,s.start+1,!0),f=u[l-1];f||(l=1,f=u[0]);var h=u[l];const p=a.call(this,f,h),g=i.call(this,l-1);return{at:l-1,articlename:c[l-1],tstart:g.start,tend:g.end,start:p.start,startH:this.stringify(p.start),end:p.end,endH:this.stringify(p.end)}},s=function(t){const e=this.get(["gfields","article","value"]);return e[t]},a=function(t,e){const r=this.addressPattern;if("undefined"==typeof e&&(e=this.meta.endpos),this.bookOf(e)>this.bookOf(t)){const i=n.makeKPos([this.bookOf(e),0,0,0],r);i==e?e=n.makeKPos([this.bookOf(t),r.maxpage-1,r.maxline-1,0],r):t=i}return{start:t,end:e}},u=function(t,e){const n=this.get(["gfields","article","pos"]),r=this.get(["gfields","article","value"]);if(!n)return null;if("string"==typeof id_name&&(t=r.indexOf(id_name)),0>t)return null;t+=e||0;var o=n[t],s=n[t+1];if(!o)return null;"undefined"==typeof s&&(s=this.meta.endpos);const u=a.call(this,o,s),c=i.call(this,t);return{at:t,articlename:r[t],end:u.end,start:u.start,tstart:c.start,tend:c.end,startH:this.stringify(u.start),end:u.end,endH:this.stringify(u.end)}},c=function(){const t=this.get(["gfields","article","value"]);return t.length},l=function(t,e){const n=r(t.pos,e.start,!0),i=r(t.pos,e.end,!0);return{pos:t.pos.slice(n,i+1),value:t.value.slice(n,i+1)}};e.exports={getArticle:u,articleOf:o,articleCount:c,getArticleName:s,adjustArticleRange:a,trimArticleField:l}},{"./bsearch":48,"./ksanapos":60}],48:[function(t,e){
"use strict";var n=function(t,e,n){for(var r,i=0,o=t.length;o>i;){if(r=i+o>>1,t[r]===e)return r;t[r]<e?i=r+1:o=r}return n?i:t[i]===e?i:-1},r=function(t,e,n){for(var r=0,i=t.length;i>r;){var o=r+i>>1;if(t[o]===e)return o;t[o]<e?r=o+1:i=o}return n?r:t[r]===e?r:-1},i=function(t,e,i){var o=n;return"string"==typeof t[0]&&(o=r),o(t,e,i)};e.exports=i},{}],49:[function(e,n){const r=e("./bsearch"),i=e("./textutil"),o=function(t,e,n,r){for(var i=this.bookLineOf(e)-this.bookLineOf(n),o=0,s=this.bookLineOf(n)-t;i;){const a=r(s);if(!a)break;s++,o+=a.length,i--}return o},s=function(t,e,n,s){if("string"==typeof e){const a=i.parseRange.call(this,e);e=a.start}const u=r(t,e+1,!0)-1,c=t[u],l=this.charOf(c),f=this.bookLineOf(t[0]),h=o.call(this,f,e,c,n);var p=this.bookLineOf(e)-f;const g=n(p);var d=0;if(h)for(var v=h,m=p,b=g;v>0&&(d+=this.tokenizer.isConcatable(b)?0:1,m--,b=n(m));)v-=b.length;var y=i.trimRight.call(this,g,this.charOf(e),s).length;const E=n(this.bookLineOf(c)-f);var k=i.trimRight.call(this,E,l).length;return{line:u,ch:y+h-k+d}},a=function(t,e,n){var r=i.parseRange.call(this,e),o=s.call(this,t,r.start,n,!0,!0);if(r.end>r.start){var a=s.call(this,t,r.end,n,!1);r.start==r.end&&(o=a),a.line==o.line&&a.ch<o.ch&&(a.ch=o.ch)}else a=o;return{start:o,end:a}},u=function(e,n,r,o,s,a){const u=this.bookLineOf(r)||0;var c=s(u-o),l=n.ch;if(!c)return 1;var f=this.charOf(r)?i.trimRight.call(this,c,this.charOf(r),!0).length:0;if(c.length-f>=l||a){const h=r+this.kcount(e.substr(0,l));return h}c=c.substr(f);for(var p=u;l>c.length;)if(l-=c.length,++p,c=s(p-o),"undefined"==typeof c)return r;return t=c.substr(0,l),i.advanceLineChar.call(this,r,p-u,t)};n.exports={toLogicalPos:s,toLogicalRange:a,fromLogicalPos:u}},{"./bsearch":48,"./textutil":63}],50:[function(t,e){const n=(t("./bsearch"),t("./ksanapos")),r=t("./ksanacount"),i=t("./tokenizer").createTokenizer,o=t("./textutil"),s=t("./coordinate"),a=t("./toc"),u=t("./gettext"),c=t("./getfield"),l=t("./tpos"),f=t("./article"),h=t("./group"),p=t("./filterkey"),g=function(t){return o.parseRange.call(this,t,this.addressPattern)},d=function(t,e){const r=this.addressPattern;return e?n.stringify(n.makeRange(t,e,r),r,!0):n.stringify(t,r)},v=function(t,e){return n.makeRange(t,e,this.addressPattern)},m=function(t){return n.makeKPos(t,this.addressPattern)},b=function(t){return"number"==typeof t?n.isRange(t,this.addressPattern):n.isRange(n.parse(t,this.addressPattern),this.addressPattern)},y=function(t,e){return t.indexOf(c.BILINKSEP+e.id)>0},E=function(t){t.addressPattern=n.buildAddressPattern(t.meta.bits,t.meta.column),t.tokenizer=i(t.meta.versions.tokenizer),t.getArticle=f.getArticle,t.getField=c.getField,t.getGField=c.getGField,t.getGlobalField=c.getGField,t.getKeyField=c.getKeyField,t.getBookField=c.getBookField,t.getArticleField=c.getArticleField,t.getArticleFields=c.getArticleFields,t.trimField=c.trimField,t.trimRangeField=c.trimRangeField,t.getFieldNames=c.getFieldNames,t.findAField=c.findAField,t.getPages=u.getPages,t.getText=u.getText,t.articleOf=f.articleOf,t.bookOf=o.bookOf,t.filterKey=p,t.pageOf=o.pageOf,t.pageStart=o.pageStart,t.lineOf=o.lineOf,t.charOf=o.charOf,t.stringify=d,t.makeRange=v,t.makeKPos=m,t.parseRange=g,t.isRange=b,t.getArticleText=u.getArticleText,t.getArticleTextTag=u.getArticleTextTag,t.getArticleName=f.getArticleName,t.articleCount=f.articleCount,t.extractKPos=o.extractKPos,t.toLogicalRange=s.toLogicalRange,t.toLogicalPos=s.toLogicalPos,t.fromLogicalPos=s.fromLogicalPos,t.layoutText=o.layoutText,t.getParagraphBreaks=o.getParagraphBreaks,t.bookLineOf=o.bookLineOf,t.getTOC=a.getTOC,t.addressRegex=/@([\dpabcd]+-[\dabcd]+);?/g,t.kcount=r.getCount(t.tokenizer),t.koffset=r.getOffset(t.tokenizer),t.kskiptoken=r.getSkipToken(t.tokenizer,t.meta.removePunc),t.tPosToKRange=l.tPosToKRange,t.groupNames=h.groupNames,t.groupKPoss=h.groupKPoss,t.groupTPoss=h.groupTPoss,t.groupKRange=h.groupKRange,t.groupTRange=h.groupTRange,t.groupArticles=h.groupArticles,t.getTitle=h.getTitle,t.getGroupName=h.getGroupName,t.groupOf=h.groupOf,t.getGroupTOC=a.getGroupTOC,t.cachedSubTOC={},t.cachedTOC=[],t.fromTPos=l.fromTPos,t.cachedPostings={},t.url=t.kdb.url,t.linkingTo=y};e.exports={init:E}},{"./article":47,"./bsearch":48,"./coordinate":49,"./filterkey":53,"./getfield":55,"./gettext":56,"./group":57,"./ksanacount":59,"./ksanapos":60,"./textutil":63,"./toc":64,"./tokenizer":65,"./tpos":68}],51:[function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(){function t(){n(this,t)}return i(t,null,[{key:"normalize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!e)return e;if("string"!=typeof e)throw new TypeError("Invalid type "+("undefined"==typeof e?"undefined":r(e))+". Only value of type String is allowed");for(var n=t.diacritics,i=n.length,o=e,s=0;i>s;s+=1)o=o.replace(n[s].diacritics,n[s].letter);return o}},{key:"diacritics",get:function(){return[{letter:" ",diacritics:/[\u00A0]/g},{letter:"0",diacritics:/[\u07C0]/g},{letter:"A",diacritics:/[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F]/g},{letter:"AA",diacritics:/[\uA732]/g},{letter:"AE",diacritics:/[\u00C6\u01FC\u01E2]/g},{letter:"AO",diacritics:/[\uA734]/g},{letter:"AU",diacritics:/[\uA736]/g},{letter:"AV",diacritics:/[\uA738\uA73A]/g},{letter:"AY",diacritics:/[\uA73C]/g},{letter:"B",diacritics:/[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181]/g},{letter:"C",diacritics:/[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E]/g},{letter:"D",diacritics:/[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779]/g},{letter:"Dh",diacritics:/[\u00D0]/g},{letter:"DZ",diacritics:/[\u01F1\u01C4]/g},{letter:"Dz",diacritics:/[\u01F2\u01C5]/g},{letter:"E",diacritics:/[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E]/g},{letter:"F",diacritics:/[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B]/g},{letter:"G",diacritics:/[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E]/g},{letter:"H",diacritics:/[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D]/g},{letter:"I",diacritics:/[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197]/g},{letter:"J",diacritics:/[\u004A\u24BF\uFF2A\u0134\u0248]/g},{letter:"K",diacritics:/[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2]/g},{letter:"L",diacritics:/[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780]/g},{letter:"LJ",diacritics:/[\u01C7]/g},{letter:"Lj",diacritics:/[\u01C8]/g},{letter:"M",diacritics:/[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C]/g},{letter:"N",diacritics:/[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4]/g},{letter:"NJ",diacritics:/[\u01CA]/g},{letter:"Nj",diacritics:/[\u01CB]/g},{letter:"O",diacritics:/[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C]/g},{letter:"OE",diacritics:/[\u0152]/g},{letter:"OI",diacritics:/[\u01A2]/g},{letter:"OO",diacritics:/[\uA74E]/g},{letter:"OU",diacritics:/[\u0222]/g},{letter:"P",diacritics:/[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754]/g},{letter:"Q",diacritics:/[\u0051\u24C6\uFF31\uA756\uA758\u024A]/g},{letter:"R",diacritics:/[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782]/g},{letter:"S",diacritics:/[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784]/g},{letter:"T",diacritics:/[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786]/g},{letter:"Th",diacritics:/[\u00DE]/g},{letter:"TZ",diacritics:/[\uA728]/g},{letter:"U",diacritics:/[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244]/g},{letter:"V",diacritics:/[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245]/g},{letter:"VY",diacritics:/[\uA760]/g},{letter:"W",diacritics:/[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72]/g},{letter:"X",diacritics:/[\u0058\u24CD\uFF38\u1E8A\u1E8C]/g},{letter:"Y",diacritics:/[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE]/g},{letter:"Z",diacritics:/[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762]/g},{letter:"a",diacritics:/[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250]/g},{letter:"aa",diacritics:/[\uA733]/g},{letter:"ae",diacritics:/[\u00E6\u01FD\u01E3]/g},{letter:"ao",diacritics:/[\uA735]/g},{letter:"au",diacritics:/[\uA737]/g},{letter:"av",diacritics:/[\uA739\uA73B]/g},{letter:"ay",diacritics:/[\uA73D]/g},{letter:"b",diacritics:/[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253]/g},{letter:"c",diacritics:/[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184]/g},{letter:"d",diacritics:/[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A]/g},{letter:"dh",chars:/[\u00F0]/g},{letter:"dz",diacritics:/[\u01F3\u01C6]/g},{letter:"e",diacritics:/[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD]/g},{letter:"f",diacritics:/[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C]/g},{letter:"ff",diacritics:/[\uFB00]/g},{letter:"fi",diacritics:/[\uFB01]/g},{letter:"fl",diacritics:/[\uFB02]/g},{letter:"ffi",diacritics:/[\uFB03]/g},{letter:"ffl",diacritics:/[\uFB04]/g},{letter:"g",diacritics:/[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F]/g},{letter:"h",diacritics:/[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265]/g},{letter:"hv",diacritics:/[\u0195]/g},{letter:"i",diacritics:/[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131]/g},{letter:"j",diacritics:/[\u006A\u24D9\uFF4A\u0135\u01F0\u0249]/g},{letter:"k",diacritics:/[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3]/g},{letter:"l",diacritics:/[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747]/g},{letter:"lj",diacritics:/[\u01C9]/g},{letter:"m",diacritics:/[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F]/g},{letter:"n",diacritics:/[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5]/g},{letter:"nj",diacritics:/[\u01CC]/g},{letter:"o",diacritics:/[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275]/g},{letter:"oe",diacritics:/[\u0153]/g},{letter:"oi",diacritics:/[\u01A3]/g},{letter:"ou",diacritics:/[\u0223]/g},{letter:"oo",diacritics:/[\uA74F]/g},{letter:"p",diacritics:/[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755]/g},{letter:"q",diacritics:/[\u0071\u24E0\uFF51\u024B\uA757\uA759]/g},{letter:"r",diacritics:/[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783]/g},{letter:"s",diacritics:/[\u0073\u24E2\uFF53\u00DF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B]/g},{letter:"ss",diacritics:/[\xDF]/g},{letter:"t",diacritics:/[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787]/g},{letter:"th",diacritics:/[\u00FE]/g},{letter:"tz",diacritics:/[\uA729]/g},{letter:"u",diacritics:/[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289]/g},{letter:"v",diacritics:/[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C]/g},{letter:"vy",diacritics:/[\uA761]/g},{letter:"w",diacritics:/[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73]/g},{letter:"x",diacritics:/[\u0078\u24E7\uFF58\u1E8B\u1E8D]/g},{letter:"y",diacritics:/[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF]/g},{letter:"z",diacritics:/[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763]/g}]}}]),t}();e.exports={diacritics:o.diacritics,normalize:o.normalize}},{}],52:[function(t,e){const n=t("ksana-corpus-rom"),r=t("./corpus"),i=t("./regcor");var o="",s={};const a=function(t){var e=s[t];e&&(e.kdb.free(),delete s[t])},u=function(e,n,o,s){"function"==typeof o&&(s=o,o={});var a={kdb:n};a.get=t("./get"),a.local=n.local,a.expandVariant=o.expandVariant||function(t){return t},n.fs.mergePostings&&(a.mergePostings=n.fs.mergePostings.bind(n.fs)),o.preload=o.preload||[];var u=[["meta"],["gfields"],["kfields"],["fields","tocrange"]];o.textOnly||u.push(["inverted","book2tpos"],["inverted","article2tpos"],["inverted","tokens"],["inverted","posting_length"],["inverted","group2tpos"]),"undefined"!=typeof console&&console.time&&(console.log("loading "+e),console.time("preload")),o.preload.forEach(function(t){u.push(t)}),a.get(u,{recursive:!0},function(t){"undefined"!=typeof console&&console.time&&console.timeEnd("preload"),a.meta=t[0],a.meta.displayOptions||(a.meta.displayOptions={}),a.id=e,a.registered=!!i[a.id],r.init(a),s(0,a)})},c=function(t,e,n,r){u(t,e,n,function(e,n){o="",e?r(e):n&&n.meta?(s[t]=n,r&&r(0,n)):r&&r(t+" is invalid")})},l=function(t,e,n){"function"==typeof e&&(n=e,e={});var r=0,i=s[t];return i?(n&&n(0,i),i):o?void(r=setInterval(function(){o||(clearInterval(r),h(t,e,n))},200)):h(t,e,n)},f=function(){return"undefined"!=typeof process&&process.versions&&process.versions.node},h=function(t,e,r){var i=s[t];if(i)return r&&r(0,i),i;var a,u=t;o=t,e=e||{};const l="undefined"!=typeof window&&window.location&&"chrome-extension:"==window.location.protocol;if("string"==typeof u&&"blob:"!==u.substr(0,5)){if(-1==u.indexOf(".cor")&&(u+=".cor"),!l)if("undefined"!=typeof window&&window.node_modules||f())a="../"+t+"-corpus/"+u;else{const h=u;u=t+"-corpus/"+u,a=h}o=t}else u.name?(t=u.name.replace(/\..+$/,""),o=t):o=u.lastIndexOf?u.substr(u.lastIndexOf("/")+1):u;new n.open(u,function(i,s){i?"string"==typeof a&&new n.open(a,function(n,i){n?(o="",r&&r(n)):c(t,i,e,r)}):c(t,s,e,r)})},p=function(){return!!o};e.exports={open:l,close:a,isBusy:p}},{"./corpus":50,"./get":54,"./regcor":62,"ksana-corpus-rom":32}],53:[function(t,e){const n=t("./bsearch"),r=function(t,e){const r=this.getKeyField(t);if(!r)return null;const i=[],o=n(r.key,e,!0);for(var s=o;s<r.key.length;s++)r.key[s].substr(0,e.length)==e&&i.push([r.key[s],r.kpos[s],r.value[s]]);return i};e.exports=r},{"./bsearch":48}],54:[function(t,e){var n=function(t,e,n){if(t){"string"==typeof t&&(t=[t]);var r=this,i=[],o=[];e.syncable&&(e.syncable=!1);for(var s=function(t){return function(n){n&&"object"==typeof n&&n.__empty||i.push(n),r.get(t,e,o.shift())}},a=0;a<t.length;a++)"null"==typeof t[a]?i.push(null):o.push(s(t[a]));o.push(function(e){i.push(e),n.apply(r.context||r,[i,t])}),o.shift()({__empty:!0})}},r=function(t,e,r){var i=this;return"function"==typeof e&&(context=r,r=e,e={recursive:!1}),e=e||{},t?"function"!=typeof r?"object"==typeof t[0]?t.map(function(t){return i.kdb.get(t,e)}):i.kdb.get(t,e):("string"==typeof t&&(t=[t]),"string"==typeof t[0]?i.kdb.get(t,e,function(e){r(e,i,t)}):"object"==typeof t[0]?n.call(i,t,e,function(e){r(e,i,t)}):void i.kdb.get([],e,function(t){r(t,i)})):(r&&r([null]),null)};e.exports=r},{}],55:[function(t,e){const n=t("./bsearch"),r="<",i=function(t,e){return"object"==typeof t?o.call(this,"fields",t,e):this.get(["fields",t],{recursive:!0},e)},o=function(t,e){const n=t.map(function(t){return["fields",t]});return this.get(n,{recursive:!0},e)},s=function(t,e){return this.get(["gfields",t],{recursive:!0},e)},a=function(t,e){return this.get(["kfields",t],{recursive:!0},e)},u=function(t,e,n){return"object"==typeof t?c.call(this,t,e,n):this.get(["fields",t,e],{recursive:!0},n)},c=function(t,e,n){const r=t.map(function(t){return["fields",t,e]});return this.get(r,{recursive:!0},n)},l=function(t,e,n){var r=t;"number"==typeof t&&(r=this.getArticle(t));var i=e;"string"==typeof e&&(i=[e]);const o=i.map(function(t){return["afields",r.at,t]});return this.get(o,{recursive:!0},n)},f=function(t,e){var n=t;"number"==typeof t&&(n=this.getArticle(t));const i=this.get("gfields");var o={};for(var s in i)s.indexOf(r)>0&&(o[s]=g.call(this,i[s],n.start,n.end));return this.get(["afields",n.at],{recursive:!0},function(t){e(Object.assign(o,t))}.bind(this))},h=function(t){const e=this.get(["fields"],function(e){return t(Object.keys(e))});return e?Object.keys(e):[]},p=function(t,e,r){var i={};const o=n(t.pos,e+1,!0),s=n(t.pos,r,!0);for(var a in t)i[a]=t[a].slice(o,s);return i},g=function(t,e,r){var i={};const o=this.makeRange(e,e),s=this.makeRange(r,r),a=n(t.pos,o+1,!0),u=n(t.pos,s,!0);for(var c in t)i[c]=t[c].slice(a,u);return i};e.exports={getField:i,getFields:o,getGField:s,getKeyField:a,getBookFields:c,getBookField:u,getArticleField:l,getArticleFields:f,getFieldNames:h,BILINKSEP:r,trimField:p,trimRangeField:g}},{"./bsearch":48}],56:[function(t,e){const n=t("./ksanapos"),r=t("./textutil"),i=function(t,e){return["texts",e[0]-1]},o=function(t,e,n,r){var i,o=[],s=t[0]-1,a=t[1],u=e[1];for(e[0]>t[0]&&(u=r),i=a;u>=i&&!(i>=r);i++)o.push(["texts",s,i]);return o},s=function(t,e,n){var i,o=[];const s=r.parseRange.call(this,t,this.addressPattern,!0),a=this.addressPattern;var u=s.startarr[1],c=s.endarr[1];const l=s.startarr[2];for(s.endarr[0]>s.startarr[0]&&(c=u+e.length),i=u;c>=i;i++)if("undefined"!=typeof e[i-u]){var f=JSON.parse(JSON.stringify(e[i-u]));if(i!=c)for(;f.length<a.maxline;)f.push("");const h=!!this.get("meta").removePunc;i==c&&(s.endarr[2]+1<f.length&&(f.length=s.endarr[2]+1),f.length-1==s.endarr[2]&&(f[f.length-1]=r.trimRight.call(this,f[f.length-1],s.endarr[3],h))),i==u&&(f=f.slice(l),s.startarr[3]&&(f[0]=r.trimLeft.call(this,f[0],s.startarr[3],!1))),o=o.concat(f)}for(;o.length&&!o[o.length-1];)o.pop();return n&&n(o),o},a=function(t,e){const n=r.parseRange.call(this,t,this.addressPattern,!0),s=this.addressPattern.column,a=i(n.startarr,n.endarr,s),u=function(t){if(!t)return void(e&&e([]));const r=t.length;var i=o(n.startarr,n.endarr,s,r),a=!1;1==i.length&&(a=!0,i=i[0]);var u=function(t){e(a?[t]:t)};e||(u=null);const c=this.get(i,{recursive:!0,syncable:!0},u);return a?[c]:c},c=this.get(a,{syncable:!0},function(t){u.call(this,t)}.bind(this));return c?u.call(this,c):c},u=function(t,e){if("object"==typeof t)return f.call(this,t,e);var n=null,r=function(r){n=setTimeout(function(){s.call(this,t,r,e)}.bind(this),1)}.bind(this);e||(r=null);var i=a.call(this,t,r);return"undefined"!=typeof i&&"string"!=typeof i&&"undefined"!=typeof i[0]?(clearTimeout(n),s.call(this,t,i,e)):void 0},c=function(t,e){const r=this.getArticle(t);if(!r)return e(null),null;var i=n.makeRange(r.start,r.end,this.addressPattern);return u.call(this,i,e)},l=function(t,e){const r=this.getArticle(t);if(!r)return e(null),null;var i=n.makeRange(r.start,r.end,this.addressPattern);u.call(this,i,function(t){return t?void this.getArticleFields(r.at,function(n){e({text:t,fields:n})}):(e(null),null)}.bind(this))},f=function(t,e){if(!t||!t.length)return void e([]);var n=[],r=JSON.parse(JSON.stringify(t));const i=function(t){u.call(this,t,function(t){n.push(t),r.length?i.call(this,r.shift()):e(n)}.bind(this))};i.call(this,r.shift())};e.exports={getText:u,getArticleText:c,getArticleTextTag:l,getPages:a}},{"./ksanapos":60,"./textutil":63}],57:[function(t,e){const n=t("./bsearch"),r=function(){return this.get(["gfields","group","value"])||this.get(["gfields","article","value"])},i=function(){return this.get(["gfields","group","pos"])||this.get(["gfields","article","pos"])},o=function(){return this.get(["inverted","group2tpos"])||this.get(["inverted","article2tpos"])},s=function(t){const e=i.call(this),n=this.meta.endpos,r=e[t],o=e[t+1];return r?o?[r,o]:[r,n]:[0,n]},a=function(t){const e=o.call(this),n=this.meta.endtpos,r=e[t],i=e[t+1];return r?i?[r,i]:[r,n]:[0,n]},u=function(t){var e;if("number"==typeof t)e=t;else{const r=this.parseRange(t);e=r.start}{const i=this.groupKPoss.call(this),o=n(i,e+10,!0)-1,s=this.groupKRange.call(this,o),a=this.get(["gfields","article","pos"]);this.get(["gfields","article","value"])}for(var u=[],c=0;c<a.length;c++){const l=a[c];l>=s[0]&&l<s[1]&&u.push(this.getArticle(c))}return u},c=function(t,e){const n=l.call(this,t),r=this.articleOf(t);return n+(e||"-")+r.articlename},l=function(t,e){const n=this.groupNames();if(!n)return"";const r=f.call(this,t);var i=n[r]||"";return i=e?i.substr(0,i.indexOf(";")):i.substr(i.indexOf(";")+1)},f=function(t){const e=this.parseRange(t),r=e.start,i=this.groupKPoss.call(this);const o=i?n(i,r+10,!0)-1:0;return o};e.exports={groupNames:r,groupKPoss:i,groupTPoss:o,groupKRange:s,groupTRange:a,groupArticles:u,getTitle:c,getGroupName:l,groupOf:f}},{"./bsearch":48}],58:[function(t,e){const n=t("./engine"),r=t("./bsearch"),i=t("./article").trimArticleField,o=function(t){n.close(t)},s=function(t,e,r){if("function"==typeof e&&(r=e,e={}),!(t instanceof Array))return n.open(t,e,r);for(var i=0;i<t.length;i++)n.open(t[i],e);const o=setInterval(function(){n.isBusy()||(clearInterval(o),r&&r())},100)},a=t("./parselink"),u=t("./textutil"),c=t("./ksanapos"),l=t("./regcor"),f=function(t,e){return"string"==typeof e&&(e=l[e]),e?u.parseRange(t,e):null},h=function(t,e){return"string"==typeof e&&(e=l[e]),e?c.stringify(t,e):""},p=t("./diacritics");e.exports={openCorpus:s,closeCorpus:o,bsearch:r,parseLink:a,diacritics:p,trimArticleField:i,parseRange:f,stringifyRange:h,regcor:l}},{"./article":47,"./bsearch":48,"./diacritics":51,"./engine":52,"./ksanapos":60,"./parselink":61,"./regcor":62,"./textutil":63}],59:[function(t,e){const n=t("./tokenizer").concreteToken,r=t("./tokentypes").TokenTypes.PUNC,i=function(t){return"「"==t||"《"==t||"『"==t||"（"==t||"〔"==t||"【"==t||"〈"==t},o=function(t){return function(e){const r=t.tokenize(e);for(var i=0,o=0;o<r.length;o++)n[r[o][2]]&&i++;return i}},s=function(t,e){return function(i,o){const s=t.tokenize(i);for(var a=0,u=0;o&&a<s.length;){const c=s[a];n[c[2]]&&(u++,o--),e||c[2]!=r||o--,a++}return u}},a=function(t){return function(e,r,o){if(!e)return 0;const s=t.tokenize(e);var a=0;if(r)for(;a<s.length&&!n[s[a][2]];)a++;for(;r&&a<s.length;)n[s[a][2]]&&r--,a++;for(;o&&a<s.length&&!n[s[a][2]]&&!i(s[a][0]);)a++;return a<s.length?s[a][1]:s[s.length-1]?s[s.length-1][1]+s[s.length-1].length:0}};e.exports={getCount:o,getOffset:a,getSkipToken:s}},{"./tokenizer":65,"./tokentypes":67}],60:[function(t,e){var n=function(){var t=Array.prototype.slice.call(arguments);"error"==t[0]?(t.shift(),console.error.apply(null,t)):"warn"==t[0]?console.warn.apply(null,t):console.log.apply(null,t)};const r=function(t){n=t},i=function(t,e){const r=t[0],i=t[1],o=t[2],s=t[3];if(2*s+2*o+2*i+r>53)throw"address has more than 53 bits";if(o>8||s>8)throw n("error",o,s),"max line/char bits is 8 and 8";const a=1<<s,u=1<<o,c=1<<i,l=1<<r;var f=s+o+i;const h=1<<f,p=[r,i,o,s],g=r+i+o+s;return{maxbook:l,maxpage:c,maxline:u,maxchar:a,maxrange:h,bits:p,kposbits:g,bookbits:r,pagebits:i,linebits:o,charbits:s,rangebits:f,column:e}};var o=function(t,e){return t[3]>=e.maxchar?0:t[2]>=e.maxline?0:t[1]>=e.maxpage?0:t[0]>=e.maxbook?0:1},s=function(t,e){var r,i=1,s=0;for(r=0;r<t.length;r++)if(t[r]<0)return n("error","makeKPos:","negative value",t[r],JSON.stringify(t)),-1;var a=!1;return o(t,e)||(a=!0,t[2]>=e.maxline&&(t[2]=e.maxline-1),t[3]>=e.maxchar&&(t[3]=e.maxchar-1)),s=t[3],i*=Math.pow(2,e.charbits),s+=t[2]*i,i*=Math.pow(2,e.linebits),s+=t[1]*i,i*=Math.pow(2,e.pagebits),s+=t[0]*i,a&&n("error","kpos trimmed",l(s,e),JSON.stringify(t)),s};const a=function(t,e,n){if(n||f(t,e)){var r=Math.pow(2,e.rangebits),i=Math.floor(t%r);return start=Math.floor(t/r),end=start+i,{start:start,end:end}}return{start:t,end:t}},u=function(t,e,n){if(isNaN(t)||isNaN(e))return 0;if(t>e){const r=t;t=e,e=r}var i=e-t;i>n.maxrange&&(i=n.maxrange-1);const o=Math.pow(2,n.rangebits);return i>=o&&(i=o-1),t*o+i};var c=function(t,e){var n=t%e.maxchar,r=Math.floor(t/e.maxchar%e.maxline),i=Math.floor(t/Math.pow(2,e.charbits+e.linebits)%e.maxpage),o=Math.floor(t/Math.pow(2,e.charbits+e.linebits+e.pagebits)%e.maxbook),s=[o,i,r,n];return s};const l=function(t,e){const n=c(t,e);var r=n[0]+"p";return e.column?(r+=Math.floor(n[1]/e.column)+1,r+=String.fromCharCode(n[1]%e.column+97)):(r+=n[1]+1,r+="."),line=e.linebits>6?"0"+(n[2]+1).toString(16).toUpperCase():"0"+(n[2]+1),r+=line.substr(line.length-2),ch=e.charbits>6?"0"+n[3].toString(16).toUpperCase():"0"+n[3],r+=ch.substr(ch.length-2)},f=function(t,e){return t/Math.pow(2,e.kposbits)>1},h=function(t,e){if(f(t,e)){const n=a(t,e);var r=l(n.end,e),i=r.indexOf("p");r=r.substr(i+1);const o=l(n.start,e),s=c(n.start,e),u=c(n.end,e);return s[1]!==u[1]?e.column&&Math.floor(s[1]/e.column)==Math.floor(u[1]/e.column)?o+"-"+r.substr(r.length-5):o+"-"+r:s[2]!==u[2]?o+"-"+r.substr(r.length-4):s[3]!==u[3]?o+"-"+r.substr(r.length-2):o}return l(t,e)},p=function(t,e,n,r){if(e.length<3){var i=10;n&&r.charbits>6?i=16:r.linebits>6&&(i=16),t[n?3:2]=parseInt(e,i)-(n?0:1)}else t[2]=parseInt(e.substr(0,2),r.linebits>6?16:10)-1,t[3]=parseInt(e.substr(2,2),r.charbits>6?16:10)},g=/(\d+)([a-d\.])([A-F\d]+)/,d=/([a-d])([A-F\d]+)/,v=/([A-F\d]+)/,m=function(t,e,r){var i=t.match(g),o=s(r,e);if(i)r[1]=parseInt(i[1],10)-1,e.column&&(r[1]=r[1]*e.column+(parseInt(i[2],36)-10)),p(r,i[3],!1,e);else if(i=t.match(d))r[1]=Math.floor(r[1]/3),r[1]=r[1]*e.column+(parseInt(i[1],36)-10),p(r,i[2],!0,e);else{if(i=t.match(v),!i)return o;p(r,i[1],!0,e)}var a=s(r,e);return o>a?(n("error","end bigger than start",JSON.stringify(r)),o+1):a},b=/(\d+)p(\d+)([a-d\.])([A-F\d]+)/,y=/(\d+)p(\d+)([a-d]?)/,E=function(t,e){var n=t.match(b);if(n||(n=t.match(y)),!n)return null;var r=[0,0,0,0];if(r[0]=parseInt(n[1],10),r[1]=parseInt(n[2],10)-1,e.column){var i="."!=n[3]&&n[3]?n[3]:"a";r[1]=r[1]*e.column+(parseInt(i,36)-10)}n.length>4&&p(r,n[4],!1,e);var o=s(r,e),a=o;const c=t.indexOf("-");return c>-1&&(remain=t.substr(c+1),a=m(remain,e,r)),u(o,a,e)},k=function(t,e){var n=c(t,e);return n[2]=0,n[3]=0,s(n,e)};e.exports={parse:E,buildAddressPattern:i,makeKPos:s,isRange:f,makeRange:u,breakRange:a,unpack:c,stringify:h,bookStartPos:k,setLog:r}},{}],61:[function(t,e){const n=t("./engine").open,r=function(t,e){const r=t.split("@");if(2!==r.length)return e&&e(null),null;if("Taisho"!=r[0]){const i={corpus:r[0],address:r[1]};return e&&e(i),i}return n(r[0].toLowerCase(),function(t){if(t)return e&&e(null),null;const n=r[1].split("p");console.log("taisho number",n[0],"number",n[1])}),null};e.exports=r},{"./engine":52}],62:[function(t,e){const n=t("./ksanapos"),r=n.buildAddressPattern,i=r([7,10,5,8]);var o={"default":i,manual:i,demo:i,pts:r([7,10,6,6]),yinshun:r([7,11,5,6]),taisho:r([6,13,5,5],3),nanchuan:r([7,10,5,6]),taixu:r([5,12,6,6]),j13zs:r([4,13,5,6],4),j13:r([4,9,5,6]),mpps:r([2,12,6,6]),swjzz:r([4,9,4,6]),test:i,fgdict:r([3,12,5,6],3),bhscjeq:i,yogacara:i};e.exports=o},{"./ksanapos":60}],63:[function(t,e){const n=t("./ksanapos"),r=t("./tokentypes"),i=r.TokenTypes,o=function(t){const e=this.tokenizer.code2TokenType;return e[t]===i.PUNC||e[t]===i.SPACE},s=function(t,e,n){if(!t)return"";var r,i=e,o=0,s=t;return r=this.koffset(s,i,n),o+=r,t.substr(0,o)},a=function(t,e,n){if(!t)return"";var r,i=e,o=0,s=t;return r=this.koffset(s,i,n),o+=r,t.substr(o)},u=function(t,e,n,r){for(var i,o=0,a=0,u=[],c="",f=[],h=[],p=[],g=e,d=0,v=0;v<t.length;v++){if(i=l.call(this,e,v+1),o=this.pageOf(g)-1,a!==o){for(;u.length>0&&!u[u.length-1].trim();)h.pop(),u.pop(),f.length&&f.pop();p.push(g)}if(n){for(var m=0,b=(t[v],0);d<n.length&&i>n[d];){m++;const y=s.call(this,t[v],n[d]-g,!0);u.push(c+y.substr(b)),b=y.length,c="",d++}if(m)c=t[v].substr(b);else{const E=this.tokenizer.isConcatable(t[v])?"":" ";c+=E+t[v]}}else u.push(t[v].replace(/\r?\n/g," ")),r&&f.push(r[v]),h.push(g);a=o,g=i}return n&&(h=n,h.unshift(e),u.push(c)),r&&f.push(r[r.length-1]),{linebreaks:h,pagebreaks:p,lines:u,linetpos:f}},c=function(t){var e={},r=this.addressPattern,i=this.articleOf.bind(this);return t.replace(this.addressRegex,function(t,o){const s=n.parse(o,r);if("undefined"!=typeof s){var a=i(s);if(!a.articlename)return;e[a.articlename]||(e[a.articlename]=[]),e[a.articlename].push(s)}}),e},l=function(t,e,r){const i=this.addressPattern;if(t+=e*i.maxchar,r){var o=n.unpack(t,i);return o[3]=this.kcount(r),n.makeKPos(o,i)}return t},f=function(t,e){"undefined"==typeof e&&(e=this.addressPattern),"string"==typeof t&&(t=n.parse(t,e));const r=n.breakRange(t,e),i=n.unpack(r.start,e);var o=n.unpack(r.end,e);return{startarr:i,endarr:o,start:r.start,end:r.end,range:t}},h=function(t,e){e=e||this.addressPattern;const r=n.unpack(t,e);return r},p=function(t){const e=f(t,this.addressPattern),n=h.call(this,e.start);return n[0]},g=function(t){const e=f(t,this.addressPattern),n=h.call(this,e.start);return n[1]},d=function(t){const e=f(t,this.addressPattern),n=h.call(this,e.start);return n[1]*this.addressPattern.maxline+n[2]},v=function(t){const e=f(t,this.addressPattern),n=h.call(this,e.start);return n[2]},m=function(t){const e=f(t,this.addressPattern),n=h.call(this,e.start);return n[3]},b=function(t){const e=f(t,this.addressPattern),r=h.call(this,e.start),i=this.addressPattern;return r[2]=0,r[3]=0,n.makeKPos(r,i)},y=function(t){var e=[];if(t.head){const n=t.head.pos.map(function(t){const e=this.parseRange(t);return e.start}.bind(this));e=e.concat(n)}return t.p&&(e=e.concat(t.p.pos)),e.sort(),e};e.exports={trimLeft:a,trimRight:s,parseRange:f,bookOf:p,pageOf:g,lineOf:v,charOf:m,pageStart:b,bookLineOf:d,layoutText:u,isPunc:o,extractKPos:c,advanceLineChar:l,getParagraphBreaks:y}},{"./ksanapos":60,"./tokentypes":67}],64:[function(t,e){const n=function(t,e,n,r){const i=n>=t&&e>=r||t>=n&&r>t||e>n&&r>=e;return i},r=function(t,e,n,r){var o=t.getField("tocrange"),s=-1;for(i=0;i<o.value.length;i++)if(o.value[i]>e){s=i;break}if(-1==s)return void r(e);var a=[];a.push(["fields","toc","value",s]),s<o.value.length-1&&a.push(["fields","toc","value",s+1]),t.get(a,function(t){for(i=0;i<t.length;i++)for(j=0;j<t[i].length;j++){var o=t[i][j].split("	"),s=parseInt(o[2],36);if(s>=e&&n>s)return void r(s)}r(e)})},o=function(t,e){if(t=parseInt(t)||0,0>t)return void(e&&e([]));const i=this.groupKRange(t),o=this.getGField("article").value,s=this.getField("tocrange");return s?void r(this,i[0],i[1],function(r){for(var a=[],u=[],c=0;c<s.value.length;c++){const l=c==s.value.length-1;var f=s.value[c];!l&&s.value[c]>s.pos[c+1]&&(f=s.pos[c+1]),
n(s.pos[c],f,r,i[1],l)&&(u.push("0	"+o[c]+"	"+s.pos[c].toString(36)),a.push(["fields","toc","value",c]))}console.log(a),this.get(a,function(n){var r=[],o=this.groupNames()[t];o||(o=""),o=o.substr(o.indexOf(";")+1),r.push("0	"+o+"	"+i[0].toString(36));for(var s=0;s<n.length;s++)r=r.concat(n[s]);console.log(r.length),e(r)}.bind(this))}.bind(this)):void(e&&e([]))},s=function(t,e){const n=this.getField("tocrange");if(!n)return[];for(var r=[],i=[],o=!1,s=0;s<n.pos.length;s++){const a=n.pos[s],u=n.value[s];t>=a&&u>t&&(this.cachedTOC[s]?i.push(this.cachedTOC[s]):(o=!0,r.push(["fields","toc","value",s])))}if(!o)return e&&e(i),i;const c=function(t){for(var e=[],n=0;n<t.length;n++){const r=t[n].split("	");e.push({d:parseInt(r[0],10),t:r[1],p:parseInt(r[2],36)})}return e};this.get(r,{recursive:!0},function(t){for(var n=0;n<r.length;n++){const o=r[n][3];this.cachedTOC[o]=c(t[n]),i.push(this.cachedTOC[o])}e(i)}.bind(this))};e.exports={getTOC:s,getGroupTOC:o}},{}],65:[function(t,e){const n=t("./tokentypes"),r=n.TokenTypes;var i=function(t){for(var e=0,n=0;1!==e&&n<t.length;){var r=t.charCodeAt(n);r>=12272&&12283>=r?(e--,(12274===r||12275===r)&&e--):e++,n++}return n};const o=function(t){const e=this.code2TokenType;for(var n,o=0,s=[];o<t.length;){n="","\n"==t[o]&&(s.push([t[o],o,r.SPACE]),o++);var a=e[t.charCodeAt(o)];if(a!=r.SURROGATE)if(a!==r.IDC)if(a!==r.CJK&&a!==r.PUNC)if(a!==r.TIBETAN&&a!==r.LATIN&&a!==r.NUMBER){if(a=r.SPACE,a===r.SPACE){for(var u=o;o<t.length;){n+=t.substr(o,1),o++;var c=t.charCodeAt(o),a=e[c];if(a!==r.SPACE||"\n"==t[o])break}n&&s.push([n,u,r.SPACE])}}else{n=t.substr(o,1),s.push([n,o,a]),o++;for(var l=a;o<t.length;){var c=t.charCodeAt(o),a=e[c];if(a!=l)break;n+=t.substr(o,1),o++}s[s.length-1][0]=n}else n=t.substr(o,1),s.push([n,o,a]),o++;else{var f=i(t.substr(o));n=t.substr(o,f),s.push([n,o,a]),o+=f}else n=t.substr(o,2),s.push([n,o,a]),o+=2}return s},s=function(t){const e=n.getCode2TokenTypeMap(t),i=function(t){if(!t)return!0;const n=e[t.charCodeAt(0)];return n==r.CJK||n==r.TIBETAN||n==r.IDC||n==r.PUNC||n==r.SPACE};return{tokenize:o,TokenTypes:r,version:t,code2TokenType:e,isConcatable:i}},a={};a[r.SURROGATE]=!0,a[r.CJK]=!0,a[r.NUMBER]=!0,a[r.TIBETAN]=!0,a[r.LATIN]=!0,a[r.IDC]=!0,e.exports={createTokenizer:s,parseIDS:i,latest:2,concreteToken:a}},{"./tokentypes":67}],66:[function(t,e){e.exports="48 10N7 26A6 26A69 23A1 31A1 136A3488 20N12 128T3648 256A256 112P3600 352C16 15I2 63P192C768 27648C14336 257S8191 512P1025 1P6 2P2 1P1 1P11 2P3 1P65 1P2 2P154 "},{}],67:[function(t,e){const n={SPACE:" ",LINEBREAK:"B",SURROGATE:"S",CJK:"C",NUMBER:"N",TIBETAN:"T",LATIN:"A",IDC:"I",PUNC:"P"};var r=[];const i=function(t){var e=0,n="";return t.replace(/(\d+)(.)/g,function(t,r,i){for(e=0;e<parseInt(r,10);e++)n+=i}),n},o=function(){const e=i(t("./tokentypemap"));if(65536!==e.length)throw"token map unpack error";r=e.split(""),Object.freeze(r)},s=function(){return r.length||o(),r};e.exports={TokenTypes:n,getCode2TokenTypeMap:s}},{"./tokentypemap":66}],68:[function(t,e){const n=t("./bsearch"),r=t("./ksanapos"),i=(t("./tokentypes").TokenTypes,function(t,e,n,i){for(var o=r.unpack(t,this.addressPattern);i;){if(o[2]>0)o[2]--,n>0&&n--;else{for(n>0&&n--;n>0&&e[n]==e[n-1];)n--;const s=n%this.addressPattern.maxline;o[1]>0&&o[1]--,o[2]=s}i--}const a=r.makeKPos(o,this.addressPattern);return{kpos:a,at:n}}),o=function(t,e,n,i){for(var o=r.unpack(t,this.addressPattern);i>0;){for(;n<e.length-1&&e[n]==e[n+1];)n++;n++;const s=n%this.addressPattern.maxline;s<o[2]&&o[1]++,o[2]=s,i--}const a=r.makeKPos(o,this.addressPattern);return{kpos:a,at:n}},s=function(t,e,n,r){return t*r+e*n},a=function(t,e,n){const r=n%this.addressPattern.maxline,i=n+(this.addressPattern.maxline-r)-1;if(t[n]==t[i])for(;n>0&&t[n-1]==t[n];)n--;return n},u=function(t,e,r,u,c,l){const f=Math.pow(2,this.addressPattern.charbits),h=Math.pow(2,this.addressPattern.rangebits),p=(!!this.get("meta").removePunc,function(t){if(u[0]instanceof Array)for(var e=0;e<u.length&&!(t>=u[e][0]&&t<=u[e][1]);e++);else{for(var e=0;e<u.length&&!(u[e]>t);e++);e&&e--}const n=r[e];return n});for(var g=[],d=[],v=[],m=0;m<t.length;m++){const b=c[l[m]];if(b){var y=n(b,t[m],!0);b[y]>t[m]&&y--;var E=b[y+1];if(y=a.call(this,b,l[m],y,f,h),!(0>y)){d.push([b,y]);var k=s(l[m],y,f,h);if(r){const A=t[m]-b[y],T=(r instanceof Array?p(t[m],b):r)||"";k+=this.kskiptoken(T,A)}g.push(k),v.push([b[y],E])}}}var F={kpos:g,linetpos:v};if(e){var w=[];e>2&&(v=[]);for(var m=0;m<g.length;m++){var x=g[m],C=x;const b=d[m][0],y=d[m][1];if(e>2){var P=Math.floor((e-1)/2);P>2&&(P=2);var I=i.call(this,x,b,y,P);const _=o.call(this,x,b,y,P);x=I.kpos,C=_.kpos;for(var O=[],S=I.at;S<=_.at;S++)O.push(b[S]);O.push(b[_.at+1]),v.push(O)}const D=C+this.addressPattern.maxchar-1,B=this.makeRange(x,D);w.push(B)}F={kpos:g,linekrange:w,line:e,linetpos:v}}return F},c=function(t,e){for(var n=[],i=0;t>i;i++){const o=r.unpack(kpos,this.addressPattern),s=e[o[0]],a=o[1]*this.addressPattern.maxline+o[2];n.push(s[a])}return n},l=function(t,e){t instanceof Array||(t=[t]);for(var n=[],i=[],o={},s=0;s<t.length;s++){const a=r.unpack(t,this.addressPattern),u=a[0];bookof.push(a[0]),o[u]=!0}for(u in o)n.push(["inverted","line2tpos",u]),i.push(u);var l={};if(!e){const f=this.get(n);if(!f)return console.error("async get fail , kpos",t,"keys",n),null;for(var s=0;s<f.length;s++)l[i[s]]=f[s];return c.call(this,t,l)}this.get(n,function(n){for(var r=0;r<n.length;r++)l[i[r]]=n[r];e&&e(c.call(this,t,l))}.bind(this))},f=function(t,e,r){var i=t;if("function"==typeof e&&(r=e,e={}),e=e||{},"number"==typeof t&&(i=[t]),!i.length)return r&&r(),{kpos:[]};const o=this.get(["inverted","book2tpos"]);for(var s={},a=[],c=[],l=[],f={},h=0;h<i.length;h++){var p=n(o,i[h],!0);a.push(p),f[p]=!0}for(var p in f)c.push(["inverted","line2tpos",p]),l.push(p);if(!r){const g=this.get(c);if(!g||!g[0])return{kpos:[]};for(var h=0;h<g.length;h++)s[l[h]]=g[h];return u.call(this,i,e.line,e.linetext,e.linetpos,s,a)}this.get(c,function(t){for(var n=0;n<t.length;n++)s[l[n]]=t[n];r&&r(u.call(this,i,e.line,e.linetext,e.linetpos,s,a))}.bind(this))},h=function(t,e,n){var r=[];"function"==typeof e&&(n=e,e={});const i=f.call(this,t,e,function(){n&&n(r)}.bind(this));return n?void 0:i};e.exports={fromTPos:f,tPosToKRange:h,toTPos:l}},{"./bsearch":48,"./ksanapos":60,"./tokentypes":67}]},{},[5]);